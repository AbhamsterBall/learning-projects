<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="main.css" rel="stylesheet"/>
    <script src="marked.min.js"></script>
<!--    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/darkula.min.css">-->
    <script src="highlight.min.js"></script>
    <link href="hljs.css" rel="stylesheet">
    <meta property="og:title" content="mybatis逆向工程">
    <script>
        hljs.initHighlightingOnLoad();
    </script>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
</head>
<body>
<div class="main-title">MYBATIS-2 BY HYH <a href="#" onclick="hideAll()" class="expand">代码全部收起</a></div>
<div class="text"  style="border-radius: 0px 0px 20px 20px;">
        <h3>MyBatisGenerator</h3><br>
    <a href="https://mybatis.org/generator/index.html">https://mybatis.org/generator/index.html</a>
    <br></br>代码见：<a href="https://github.com/AbhamsterBall/mybatis-learning-projects">https://github.com/AbhamsterBall/mybatis-learning-projects</a>
<pre class="preText">

    翻译与总结：HYH，只记录关键词，只有关键代码
    MBG定义：
        mybatis代码生成器 检测表来生成 减少设置对象和配置文件的工作量 生成简单的增删查改 join查询和存储对象还是要自己写
    灵活性：根据不同的配置和语言生成不同风格的代码
        配置：the "targetRuntime" attribute of a &lt;context&gt; element.
        eg: Java or Kotlin code   MyBatis3 compatible XML
                - Java or Kotlin code可能生成4个类：
                    PK + 除了BLOB以外的non-PK + BLOB + 增删查改的动态SQL
                    = 它会自动生成相应的继承关系：层级关系可以设置 eg:一个表一个对象(domain object)
                        domain object: represents a real-world entity or concept within a specific domain or problem space.
                - XML
                    基础的增删查改语句包含：
                        insert
                        update by primary key
                        update by example (using a dynamic where clause)
                        delete by primary key
                        delete by example (using a dynamic where clause)
                        select by primary key
                        select by example (using a dynamic where clause)
                        count by example
                    灵活可变：eg:如果没有主键，就没有根据主键更新的语句
                - 可选：生成使用以上语句（对象）的类/接口
        最新的配置不再需要xml
    可用性：用于不同生产环境：an Ant task, or a Maven plugin, in a continuous build environment.
        注意：
        - 它会自动和旧文件合并，并且不覆盖原来的配置，所以你可以多次生成，只会覆盖之前自动生成的元素。
        - 不会合并JAVA文件：可能覆盖旧的/用另外的名字生成新的，必须手动合并，除非是用了Eclipse插件
        - 不会合并Kotlin文件：同上，但不支持Eclipse插件

    Eclipse插件
        可以自动合并并保存用户修改内容，需要要Eclipse编译器和AST walker
            官方文档：<a href="https://marketplace.eclipse.org/content/mybatis-generator"> https://marketplace.eclipse.org/content/mybatis-generator</a>

    依赖：getColumns and getPrimaryKeys methods依赖于JDBC包
    生成代码的依赖：
        Mybatis / Mybatis dynamic sql

</pre>
    <table><tr class="a">

        <th>Runtime</th>

        <th>MyBatis Generator Version</th>

        <th>MyBatis Version</th>

        <th>MyBatis Dynamic SQL Version</th>
    </tr>

    <tr class="b">

        <td align="left">MyBatis3, MyBatis3Simple</td>

        <td>Any</td>

        <td>3.0+</td>

        <td>N/A</td>
    </tr>

    <tr class="a">

        <td align="left">MyBatis3DynamicSQL</td>

        <td>1.3.6 - 1.3.7</td>

        <td>3.4.2+</td>

        <td>1.1.0 - 1.2.1</td>
    </tr>

    <tr class="b">

        <td align="left">MyBatis3DynamicSQL, MyBatis3Kotlin</td>

        <td>1.4.0</td>

        <td>3.4.2+</td>

        <td>1.1.3+</td>
    </tr>

    <tr class="a">

        <td align="left">MyBatis3DynamicSQL</td>

        <td>1.4.1+</td>

        <td>3.4.2+</td>

        <td>1.3.1+</td>
    </tr>

    <tr class="b">

        <td align="left">MyBatis3Kotlin</td>

        <td>1.4.1+</td>

        <td>3.4.2+</td>

        <td>1.4.0+</td>
    </tr>
    </table>
<pre class="preText">

    支持与帮助：<a href="http://groups.google.com/group/mybatis-user">http://groups.google.com/group/mybatis-user</a>
    bug提交与需求上传：<a href="https://github.com/mybatis/generator/issues">https://github.com/mybatis/generator/issues</a>
</pre>
    <br><h3>1.4.1更新</h3><br>
<pre class="preText">
    - AliasableSqlTable将原本以对象为底层改为了以类为底层
    - AliasableSqlColumn从二级字段变为一级字段
        import foo.BarDynamicSqlSupport.Bar(对象).id -> import foo.BarDynamicSqlSupport.id(类)
</pre>
    <br><h3>快速导航</h3><br>
<pre class="preText">
    1.创建并generator配置文件
    2.保存.xml文件
    3.运行这样的cmd：
         java -jar mybatis-generator-core-x.x.x.jar -configfile \temp\generatorConfig.xml -overwrite
            = 如果你想要保存之前的文件，不要写-overwrite
            = 没有该参数，新同名文件会生成独一无二的新名字
    4.修改mybatis配置文件
</pre>
    <br>
<pre class="preText">
<h3>MyBatis3DynamicSql: 以cmd方式启动 *里面有注意事项</h3>
- 配置文件见 +myBatisGenerator/src/resources/MyBatis3DynamicSql.xml
<pre class="markdown">
<textarea>
```
<generatorConfiguration>
    <context id="dsql" targetRuntime="MyBatis3DynamicSql">
        <jdbcConnection driverClass="oracle.jdbc.driver.OracleDriver"
                        connectionURL="jdbc:oracle:thin:@localhost:1521:orcl"
                        userId="scott"
                        password="123456"/>
        <javaModelGenerator targetPackage="example.model" targetProject="src/main/java"/>
        <javaClientGenerator targetPackage="example.mapper" targetProject="src/main/java"/>
        <table schema="scott" tableName="EMP" /> <!--name the user(schema) for emp or it might match multiple tables-->
    </context>
</generatorConfiguration>
```
</textarea>
</pre>
- 测试见Tests.testMyBatis3DynamicSQL()
<pre class="markdown">
<textarea>
```
Emp emp = EmpDynamicSqlSupport.emp;
SelectStatementProvider ssp = SqlBuilder.select(emp.allColumns()).from(emp).build().render(RenderingStrategies.MYBATIS3);
List<example.model.Emp> emps = mapper.selectMany(ssp);
emps.forEach(System.out::println);
```
</textarea>
</pre>

<h3>MyBatis3DynamicSql: 以JAVA方式启动</h3>
- 除了用JAVA启动外，MyBatis不仅可以使用XML配置，而且还可以使用全JAVA配置
    - 内容模型结构：ModelType: 具有树状或者多层结构的为Hierarchical，没有层级叫Flat，自动识别叫Conditional
        - 该模型来自于org.mybatis.generator.config.ModelType
全JAVA配置(最简配置)
<pre class="markdown">
<textarea>
```
Context c = new Context(ModelType.CONDITIONAL); //模型结构

c.setId("configContextForMybatis3DynamicSQL"); //必须设置ID否则报错

c.setJdbcConnectionConfiguration(configJDBCConnection()); //可看github搜索，实际是创建需要的类并设置基础属性：driver url等

...new JavaClientGeneratorConfiguration(): setPackage & Project
c.setJavaClientGeneratorConfiguration(jcgc); //定义生成接口位置
...new SqlMapGeneratorConfiguration(): Package
c.setSqlMapGeneratorConfiguration(sqlMapper); //生成mapper
...new JavaModelGeneratorConfiguration(): setPackage & Project
c.setJavaModelGeneratorConfiguration(jmgc); //model

...new TableConfiguration(c): setSchema & table
c.addTableConfiguration(table);
```
</textarea>
</pre>

<h4>以XML的方式配置如何启动</h4>
<pre class="markdown">
<textarea>
```
Configuration config = new ConfigurationParser(PROPERTIES, LIST).parseConfiguration(new File("FILE LOCATION")); // 用解析器返回warning list
DefaultShellCallback callback = new DefaultShellCallback(BOOLEAN); // 回调的时候是否覆盖旧文件
MyBatisGenerator myBatisGenerator = new MyBatisGenerator(config, callback, warnings);
myBatisGenerator.generate([VERBOSE]PROGRESSCALLBACK); // 过程回调函数，VERBOSE回调函数可以返回调用过程
```
</textarea>
</pre>

· 执行的顺序为：
    <h5 class="simi-mark">connect DB -> Introspect table -> generate record(table) class -> generate mapper interface -> save emp.java-empMapper.java-empDynamicSqlSupport.java</h5>

- ConfigurationParser可以加载属性文件，这些属性可以用在xml文件里，以${}的形式调用。
    - 如果${}没有找到属性，就会以原样（包含${}）的方式传入值

<h4>以JAVA的方式配置如何启动</h4>
<pre class="markdown">
<textarea>
```
List<String> warnings = new ArrayList<String>();
boolean overwrite = true;
Configuration config = new Configuration();

config.addContext(configContextForMybatis3DynamicSQL()); //这里面的设置在前面全JAVA配置MBG

DefaultShellCallback callback = new DefaultShellCallback(overwrite);
generator = new MyBatisGenerator(config, callback, warnings);
generator.generate(new VerboseProgressCallback());
```
</textarea>
</pre>

<h3>MyBatis3: 以JAVA方式启动</h3>
- 配置文件与MyBatis3DynamicSql基本相同，特证句如下，完整代码在resources/MyBatis3.xml:

<pre class="markdown">
<textarea>
```
<javaClientGenerator type="XMLMAPPER" targetPackage="exampleM3.mapper" targetProject="src/main/java"/>
```
</textarea>
</pre>

也就是说，它的特点是：生成的是xml mapper，而不是DynamicSqlSupport。

- 使用该自动生成的例子如下：
<pre class="markdown">
<textarea>
```
EmpExampleM3 eem = new EmpExampleM3();
EmpExampleM3.Criteria c = eem.createCriteria();
c.andSalLessThan(new BigDecimal(10000));

List<EmpM3> empM3s = mapperM3.selectByExample(eem);
```
</textarea>
</pre>

** 唯一需要注意的是在maven结构下，使用xml构建只能使用mapper resources/url到文件的方式，其它方式maven根本不会动用resources下面的文件。

<h3>MyBatis3Simple: 以JAVA方式启动</h3>
- 特点是：不生成接口实现，通过注解的方式实现功能，但是方法很少，但相对前面两种，它生成的方法使用起来也更简单。

<pre class="markdown">
<textarea>
```
<javaClientGenerator type="ANNOTATEDMAPPER" targetPackage="exampleSimple.mapper" targetProject="src/main/java"/>
```
</textarea>
</pre>


</pre>
    </div>

<script src="jquery.js"></script>
<script src="main.js"></script>
</body>
</html>