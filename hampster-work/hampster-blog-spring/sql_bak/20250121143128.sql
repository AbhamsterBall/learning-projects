/*
MySQL Backup
Database: hampster
Backup Time: 2025-01-21 14:31:36
*/

SET FOREIGN_KEY_CHECKS=0;
DROP TABLE IF EXISTS `hampster`.`blog`;
DROP TABLE IF EXISTS `hampster`.`blog_type`;
DROP TABLE IF EXISTS `hampster`.`user`;
CREATE TABLE `blog` (
  `b_id` int unsigned NOT NULL AUTO_INCREMENT,
  `b_type` int unsigned NOT NULL,
  `b_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `b_content` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `b_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`b_id`),
  KEY `b_type` (`b_type`),
  CONSTRAINT `blog_ibfk_1` FOREIGN KEY (`b_type`) REFERENCES `blog_type` (`bt_id`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
CREATE TABLE `blog_type` (
  `bt_id` int unsigned NOT NULL AUTO_INCREMENT,
  `bt_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT '',
  PRIMARY KEY (`bt_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
CREATE TABLE `user` (
  `u_id` int unsigned NOT NULL AUTO_INCREMENT,
  `u_name` varchar(24) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `u_pass` varchar(80) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `u_mail` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL,
  `u_phone` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL,
  `u_token` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  PRIMARY KEY (`u_id`,`u_token`),
  UNIQUE KEY `uniq_token` (`u_token`),
  UNIQUE KEY `uniq_mail` (`u_mail`),
  UNIQUE KEY `uniq_phone` (`u_phone`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;
BEGIN;
LOCK TABLES `hampster`.`blog` WRITE;
DELETE FROM `hampster`.`blog`;
INSERT INTO `hampster`.`blog` (`b_id`,`b_type`,`b_name`,`b_content`,`b_time`) VALUES (1, 1, 'Mybatis Generator', '## Mybatis Generator\r\n<pre class=\"preText\">\r\n    ç¿»è¯‘ä¸æ€»ç»“ï¼šHYHï¼Œåªè®°å½•å…³é”®è¯ï¼Œåªæœ‰å…³é”®ä»£ç \r\n    MBGå®šä¹‰ï¼š\r\n        mybatisä»£ç ç”Ÿæˆå™¨ æ£€æµ‹è¡¨æ¥ç”Ÿæˆ å‡å°‘è®¾ç½®å¯¹è±¡å’Œé…ç½®æ–‡ä»¶çš„å·¥ä½œé‡ ç”Ÿæˆç®€å•çš„å¢åˆ æŸ¥æ”¹ joinæŸ¥è¯¢å’Œå­˜å‚¨å¯¹è±¡è¿˜æ˜¯è¦è‡ªå·±å†™\r\n    çµæ´»æ€§ï¼šæ ¹æ®ä¸åŒçš„é…ç½®å’Œè¯­è¨€ç”Ÿæˆä¸åŒé£æ ¼çš„ä»£ç \r\n        é…ç½®ï¼šthe \"targetRuntime\" attribute of a &lt;context&gt; element.\r\n        eg: Java or Kotlin code   MyBatis3 compatible XML\r\n                ğŸ”¥ Java or Kotlin codeå¯èƒ½ç”Ÿæˆ4ä¸ªç±»ï¼š\r\n                    PK + é™¤äº†BLOBä»¥å¤–çš„non-PK + BLOB + å¢åˆ æŸ¥æ”¹çš„åŠ¨æ€SQL\r\n                    = å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„ç»§æ‰¿å…³ç³»ï¼šå±‚çº§å…³ç³»å¯ä»¥è®¾ç½® eg:ä¸€ä¸ªè¡¨ä¸€ä¸ªå¯¹è±¡(domain object)\r\n                        domain object: represents a real-world entity or concept within a specific domain or problem space.\r\n                ğŸ”¥ XML\r\n                    åŸºç¡€çš„å¢åˆ æŸ¥æ”¹è¯­å¥åŒ…å«ï¼š\r\n                        insert\r\n                        update by primary key\r\n                        update by example (using a dynamic where clause)\r\n                        delete by primary key\r\n                        delete by example (using a dynamic where clause)\r\n                        select by primary key\r\n                        select by example (using a dynamic where clause)\r\n                        count by example\r\n                    çµæ´»å¯å˜ï¼šeg:å¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œå°±æ²¡æœ‰æ ¹æ®ä¸»é”®æ›´æ–°çš„è¯­å¥\r\n                ğŸ”¥ å¯é€‰ï¼šç”Ÿæˆä½¿ç”¨ä»¥ä¸Šè¯­å¥ï¼ˆå¯¹è±¡ï¼‰çš„ç±»/æ¥å£\r\n        æœ€æ–°çš„é…ç½®ä¸å†éœ€è¦xml\r\n    å¯ç”¨æ€§ï¼šç”¨äºä¸åŒç”Ÿäº§ç¯å¢ƒï¼šan Ant task, or a Maven plugin, in a continuous build environment.\r\n        æ³¨æ„ï¼š\r\n        ğŸ”¥ å®ƒä¼šè‡ªåŠ¨å’Œæ—§æ–‡ä»¶åˆå¹¶ï¼Œå¹¶ä¸”ä¸è¦†ç›–åŸæ¥çš„é…ç½®ï¼Œæ‰€ä»¥ä½ å¯ä»¥å¤šæ¬¡ç”Ÿæˆï¼Œåªä¼šè¦†ç›–ä¹‹å‰è‡ªåŠ¨ç”Ÿæˆçš„å…ƒç´ ã€‚\r\n        ğŸ”¥ ä¸ä¼šåˆå¹¶JAVAæ–‡ä»¶ï¼šå¯èƒ½è¦†ç›–æ—§çš„/ç”¨å¦å¤–çš„åå­—ç”Ÿæˆæ–°çš„ï¼Œå¿…é¡»æ‰‹åŠ¨åˆå¹¶ï¼Œé™¤éæ˜¯ç”¨äº†Eclipseæ’ä»¶\r\n        ğŸ”¥ ä¸ä¼šåˆå¹¶Kotlinæ–‡ä»¶ï¼šåŒä¸Šï¼Œä½†ä¸æ”¯æŒEclipseæ’ä»¶\r\n\r\n    Eclipseæ’ä»¶\r\n        å¯ä»¥è‡ªåŠ¨åˆå¹¶å¹¶ä¿å­˜ç”¨æˆ·ä¿®æ”¹å†…å®¹ï¼Œéœ€è¦è¦Eclipseç¼–è¯‘å™¨å’ŒAST walker\r\n            å®˜æ–¹æ–‡æ¡£ï¼š<a href=\"https://marketplace.eclipse.org/content/mybatis-generator\"> https://marketplace.eclipse.org/content/mybatis-generator</a>\r\n\r\n    ä¾èµ–ï¼šgetColumns and getPrimaryKeys methodsä¾èµ–äºJDBCåŒ…\r\n    ç”Ÿæˆä»£ç çš„ä¾èµ–ï¼š\r\n        Mybatis / Mybatis dynamic sql\r\n    <table><tr class=\"thead\">\r\n\r\n        <th>Runtime</th>\r\n\r\n        <th>MyBatis Generator Version</th>\r\n\r\n        <th>MyBatis Version</th>\r\n\r\n        <th>MyBatis Dynamic SQL Version</th>\r\n    </tr>\r\n\r\n    <tr class=\"b\">\r\n\r\n        <td align=\"left\">MyBatis3, MyBatis3Simple</td>\r\n\r\n        <td>Any</td>\r\n\r\n        <td>3.0+</td>\r\n\r\n        <td>N/A</td>\r\n    </tr>\r\n\r\n    <tr class=\"a\">\r\n\r\n        <td align=\"left\">MyBatis3DynamicSQL</td>\r\n\r\n        <td>1.3.6 - 1.3.7</td>\r\n\r\n        <td>3.4.2+</td>\r\n\r\n        <td>1.1.0 - 1.2.1</td>\r\n    </tr>\r\n\r\n    <tr class=\"b\">\r\n\r\n        <td align=\"left\">MyBatis3DynamicSQL, MyBatis3Kotlin</td>\r\n\r\n        <td>1.4.0</td>\r\n\r\n        <td>3.4.2+</td>\r\n\r\n        <td>1.1.3+</td>\r\n    </tr>\r\n\r\n    <tr class=\"a\">\r\n\r\n        <td align=\"left\">MyBatis3DynamicSQL</td>\r\n\r\n        <td>1.4.1+</td>\r\n\r\n        <td>3.4.2+</td>\r\n\r\n        <td>1.3.1+</td>\r\n    </tr>\r\n\r\n    <tr class=\"b\">\r\n\r\n        <td align=\"left\">MyBatis3Kotlin</td>\r\n\r\n        <td>1.4.1+</td>\r\n\r\n        <td>3.4.2+</td>\r\n\r\n        <td>1.4.0+</td>\r\n    </tr>\r\n    </table>\r\n    æ”¯æŒä¸å¸®åŠ©ï¼š<a href=\"http://groups.google.com/group/mybatis-user\">http://groups.google.com/group/mybatis-user</a>\r\n    bugæäº¤ä¸éœ€æ±‚ä¸Šä¼ ï¼š<a href=\"https://github.com/mybatis/generator/issues\">https://github.com/mybatis/generator/issues</a>\r\n</pre>\r\n ### 1.4.1æ›´æ–°\r\n- AliasableSqlTableå°†åŸæœ¬ä»¥å¯¹è±¡ä¸ºåº•å±‚æ”¹ä¸ºäº†ä»¥ç±»ä¸ºåº•å±‚\r\n- AliasableSqlColumnä»äºŒçº§å­—æ®µå˜ä¸ºä¸€çº§å­—æ®µ  \r\n        import foo.BarDynamicSqlSupport.Bar(å¯¹è±¡).id -> import foo.BarDynamicSqlSupport.id(ç±»)\r\n### å¿«é€Ÿå¯¼èˆª\r\n<pre class=\"preText\">\r\n    1.åˆ›å»ºå¹¶generatoré…ç½®æ–‡ä»¶\r\n    2.ä¿å­˜.xmlæ–‡ä»¶\r\n    3.è¿è¡Œè¿™æ ·çš„cmdï¼š\r\n         java -jar mybatis-generator-core-x.x.x.jar -configfile \\temp\\generatorConfig.xml -overwrite\r\n            = å¦‚æœä½ æƒ³è¦ä¿å­˜ä¹‹å‰çš„æ–‡ä»¶ï¼Œä¸è¦å†™-overwrite\r\n            = æ²¡æœ‰è¯¥å‚æ•°ï¼Œæ–°åŒåæ–‡ä»¶ä¼šç”Ÿæˆç‹¬ä¸€æ— äºŒçš„æ–°åå­—\r\n    4.ä¿®æ”¹mybatisé…ç½®æ–‡ä»¶\r\n</pre>\r\n### MyBatis3DynamicSql: ä»¥cmdæ–¹å¼å¯åŠ¨ *é‡Œé¢æœ‰æ³¨æ„äº‹é¡¹\r\n- é…ç½®æ–‡ä»¶è§ +myBatisGenerator/src/resources/MyBatis3DynamicSql.xml \r\n```\r\n<generatorConfiguration>\r\n    <context id=\"dsql\" targetRuntime=\"MyBatis3DynamicSql\">\r\n        <jdbcConnection driverClass=\"oracle.jdbc.driver.OracleDriver\"\r\n                        connectionURL=\"jdbc:oracle:thin:@localhost:1521:orcl\"\r\n                        userId=\"scott\"\r\n                        password=\"123456\"/>\r\n        <javaModelGenerator targetPackage=\"example.model\" targetProject=\"src/main/java\"/>\r\n        <javaClientGenerator targetPackage=\"example.mapper\" targetProject=\"src/main/java\"/>\r\n        <table schema=\"scott\" tableName=\"EMP\" /> <!--name the user(schema) for emp or it might match multiple tables-->\r\n    </context>\r\n</generatorConfiguration>\r\n```\r\n- æµ‹è¯•è§Tests.testMyBatis3DynamicSQL() \r\n<textarea>\r\n```\r\nEmp emp = EmpDynamicSqlSupport.emp;\r\nSelectStatementProvider ssp = SqlBuilder.select(emp.allColumns()).from(emp).build().render(RenderingStrategies.MYBATIS3);\r\nList<example.model.Emp> emps = mapper.selectMany(ssp);\r\nemps.forEach(System.out::println);\r\n```\r\n</textarea>\r\n\r\n### MyBatis3DynamicSql: ä»¥JAVAæ–¹å¼å¯åŠ¨\r\n- é™¤äº†ç”¨JAVAå¯åŠ¨å¤–ï¼ŒMyBatisä¸ä»…å¯ä»¥ä½¿ç”¨XMLé…ç½®ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨å…¨JAVAé…ç½®\r\n    - å†…å®¹æ¨¡å‹ç»“æ„ï¼šModelType: å…·æœ‰æ ‘çŠ¶æˆ–è€…å¤šå±‚ç»“æ„çš„ä¸ºHierarchicalï¼Œæ²¡æœ‰å±‚çº§å«Flatï¼Œè‡ªåŠ¨è¯†åˆ«å«Conditional\r\n        - è¯¥æ¨¡å‹æ¥è‡ªäºorg.mybatis.generator.config.ModelType\r\nå…¨JAVAé…ç½®(æœ€ç®€é…ç½®) + å…·ä½“Tests.configContextForMybatis3DynamicSQL\r\n<textarea>\r\n```\r\nContext c = new Context(ModelType.CONDITIONAL); //æ¨¡å‹ç»“æ„\r\n\r\nc.setId(\"configContextForMybatis3DynamicSQL\"); //å¿…é¡»è®¾ç½®IDå¦åˆ™æŠ¥é”™\r\n\r\nc.setJdbcConnectionConfiguration(configJDBCConnection()); //å¯çœ‹githubæœç´¢ï¼Œå®é™…æ˜¯åˆ›å»ºéœ€è¦çš„ç±»å¹¶è®¾ç½®åŸºç¡€å±æ€§ï¼šdriver urlç­‰\r\n\r\n...new JavaClientGeneratorConfiguration(): setPackage & Project\r\nc.setJavaClientGeneratorConfiguration(jcgc); //å®šä¹‰ç”Ÿæˆæ¥å£ä½ç½®\r\n...new SqlMapGeneratorConfiguration(): Package\r\nc.setSqlMapGeneratorConfiguration(sqlMapper); //ç”Ÿæˆmapper\r\n...new JavaModelGeneratorConfiguration(): setPackage & Project\r\nc.setJavaModelGeneratorConfiguration(jmgc); //model\r\n\r\n...new TableConfiguration(c): setSchema & table\r\nc.addTableConfiguration(table);\r\n```\r\n</textarea>\r\n#### ä»¥XMLçš„æ–¹å¼é…ç½®å¦‚ä½•å¯åŠ¨\r\n<textarea>\r\n```\r\nConfiguration config = new ConfigurationParser(PROPERTIES, LIST).parseConfiguration(new File(\"FILE LOCATION\")); // ç”¨è§£æå™¨è¿”å›warning list\r\nDefaultShellCallback callback = new DefaultShellCallback(BOOLEAN); // å›è°ƒçš„æ—¶å€™æ˜¯å¦è¦†ç›–æ—§æ–‡ä»¶\r\nMyBatisGenerator myBatisGenerator = new MyBatisGenerator(config, callback, warnings);\r\nmyBatisGenerator.generate([VERBOSE]PROGRESSCALLBACK); // è¿‡ç¨‹å›è°ƒå‡½æ•°ï¼ŒVERBOSEå›è°ƒå‡½æ•°å¯ä»¥è¿”å›è°ƒç”¨è¿‡ç¨‹\r\n```\r\n</textarea>\r\n\r\nÂ· æ‰§è¡Œçš„é¡ºåºä¸º\r\n```ï¼š\r\nğŸ”¥ connect DB -> Introspect table -> generate record(table) class -> generate mapper interface -> save emp.java-empMapper.java-empDynamicSqlSupport.java\r\n```\r\n- ConfigurationParserå¯ä»¥åŠ è½½å±æ€§æ–‡ä»¶ï¼Œè¿™äº›å±æ€§å¯ä»¥ç”¨åœ¨xmlæ–‡ä»¶é‡Œï¼Œä»¥${}çš„å½¢å¼è°ƒç”¨ã€‚\r\n    - å¦‚æœ${}æ²¡æœ‰æ‰¾åˆ°å±æ€§ï¼Œå°±ä¼šä»¥åŸæ ·ï¼ˆåŒ…å«${}ï¼‰çš„æ–¹å¼ä¼ å…¥å€¼\r\n\r\n#### ä»¥JAVAçš„æ–¹å¼é…ç½®å¦‚ä½•å¯åŠ¨\r\n```\r\nList<String> warnings = new ArrayList<String>();\r\nboolean overwrite = true;\r\nConfiguration config = new Configuration();\r\n\r\nconfig.addContext(configContextForMybatis3DynamicSQL()); //è¿™é‡Œé¢çš„è®¾ç½®åœ¨å‰é¢å…¨JAVAé…ç½®MBG\r\n\r\nDefaultShellCallback callback = new DefaultShellCallback(overwrite);\r\ngenerator = new MyBatisGenerator(config, callback, warnings);\r\ngenerator.generate(new VerboseProgressCallback());\r\n```\r\n\r\n### MyBatis3: ä»¥JAVAæ–¹å¼å¯åŠ¨\r\n- é…ç½®æ–‡ä»¶ä¸MyBatis3DynamicSqlåŸºæœ¬ç›¸åŒï¼Œç‰¹è¯å¥å¦‚ä¸‹ï¼Œå®Œæ•´ä»£ç åœ¨resources/MyBatis3.xml:\r\n```\r\n<javaClientGenerator type=\"XMLMAPPER\" targetPackage=\"exampleM3.mapper\" targetProject=\"src/main/java\"/>\r\n```\r\n\r\nä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼šç”Ÿæˆçš„æ˜¯xml mapperï¼Œè€Œä¸æ˜¯DynamicSqlSupportã€‚\r\n\r\n- ä½¿ç”¨è¯¥è‡ªåŠ¨ç”Ÿæˆçš„ä¾‹å­å¦‚ä¸‹ï¼š\r\n```\r\nEmpExampleM3 eem = new EmpExampleM3();\r\nEmpExampleM3.Criteria c = eem.createCriteria();\r\nc.andSalLessThan(new BigDecimal(10000));\r\n\r\nList<EmpM3> empM3s = mapperM3.selectByExample(eem);\r\n```\r\n\r\n** å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯åœ¨mavenç»“æ„ä¸‹ï¼Œä½¿ç”¨xmlæ„å»ºåªèƒ½ä½¿ç”¨mapper resources/urlåˆ°æ–‡ä»¶çš„æ–¹å¼ï¼Œå…¶å®ƒæ–¹å¼mavenæ ¹æœ¬ä¸ä¼šåŠ¨ç”¨resourcesä¸‹é¢çš„æ–‡ä»¶ã€‚\r\n\r\n### MyBatis3Simple: ä»¥JAVAæ–¹å¼å¯åŠ¨\r\n- ç‰¹ç‚¹æ˜¯ï¼šä¸ç”Ÿæˆæ¥å£å®ç°ï¼Œé€šè¿‡æ³¨è§£çš„æ–¹å¼å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯æ–¹æ³•å¾ˆå°‘ï¼Œä½†ç›¸å¯¹å‰é¢ä¸¤ç§ï¼Œå®ƒç”Ÿæˆçš„æ–¹æ³•ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´ç®€å•ã€‚\r\n\r\n```\r\n<javaClientGenerator type=\"ANNOTATEDMAPPER\" targetPackage=\"exampleSimple.mapper\" targetProject=\"src/main/java\"/>\r\n```\r\n\r\n### MBGè¯¦ç»†é…ç½®\r\n- tableæ ‡ç­¾å†…éƒ¨\r\n    - å±æ€§domainObjectNameæ˜¯å°†è¡¨åè½¬åŒ–ä¸ºåˆ«çš„åå­—æ¥ç”Ÿæˆç±»\r\n    - columnOverrideæ ‡ç­¾ç”¨äºè¦†ç›–åŸæœ¬çš„åˆ—åæˆ–è€…è¦†ç›–å…³é—­äº†useActualColumnNamesåè¢«è½¬æ¢æˆJAVAå¼é©¼å³°å‘½å\r\n    - ignoreColumnæ ‡ç­¾ç”¨äºå¿½ç•¥è¯¥åˆ—æ•°æ®ï¼Œä¸è¿›è¡ŒmodelåŠå…¶å®ƒå¯¹è±¡çš„ç”Ÿæˆ\r\n    - [propertyå±æ€§]useActualColumnNames: ä½¿ç”¨å®é™…åˆ—åç”Ÿæˆï¼Œå¦‚æœä¸ºfalseï¼Œmybatisä¼šå°è¯•ä½¿ç”¨JAVAå¼é©¼å³°å‘½åæ³•ï¼ˆä¾‹å¦‚å°†æ•°æ®åº“å¼é©¼å³°å‘½åa_Columnè½¬åŒ–ä¸ºaColumnï¼‰ï¼Œæ— è®ºå¦‚ä½•è®¾ç½®éƒ½å¯ä»¥è¢«columnOverrideè¦†ç›–\r\n    - generatedKeyæ ‡ç­¾: DB2çš„ç‰¹æ€§ï¼Œè¦æ±‚è¯¥åˆ—ä¸ºä¸»é”®ä¸”ä¸ºè‡ªåŠ¨ç”Ÿæˆåˆ—ï¼Œå¸®åŠ©db2ç”Ÿæˆinsertå®ç°\r\n    - [columnOverrideå±æ€§]jdbcType: å°†è¯¥åˆ—æˆæ˜ å°„æˆJAVAé‡Œé¢çš„ç±»å‹\r\n    - javaTypeResolveræ ‡ç­¾å†…éƒ¨\r\n    - forceBigDecimalså…³é—­ï¼šä¸å†å°†ä¾‹å¦‚mysqlä¸­decimalæˆ–numericè¿™ç§é«˜ç²¾åº¦ç±»å‹çš„æ•°æ®è½¬æ¢æˆBigDecimalï¼Œè€Œæ˜¯ç”¨Short, Integer, Longç­‰æ•´å‹æ›¿ä»£ï¼Œè¿™æ ·æœ¬æ¥æ˜¯decimalå’Œnumericçš„æ•°æ®æ›´å¥½å¤„ç†ã€‚\r\n- java...Generatorå†…éƒ¨\r\n    - enableSubPackages: ä»–ä¼šå°†åŒ…åæ·»åŠ .schemaï¼Œä¹Ÿå°±æ˜¯æ·»åŠ è¯¥è¡¨æ‰€å±çš„ç”¨æˆ·å\r\n    - trim: å®ƒä¼šå°†æ•°æ®åº“è¿”å›çš„å€¼è¿›è¡Œtrimï¼Œé¿å…æ²¡æœ‰å¿…è¦çš„ç©ºå­—ç¬¦å‡ºç°ã€‚\r\n    - ğŸ”¥ resources/MybatisDetailConfig.xml\r\n\r\n### MBGå…¶å®ƒé…ç½®-contextæ ‡ç­¾å‰\r\n- propertiesæ ‡ç­¾: æ·»åŠ å±æ€§æ–‡ä»¶\r\n- classPathEntryæ ‡ç­¾ï¼šå‘ç›®å½•é‡Œæ·»åŠ ç›®å½•å¤–æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šåœ¨ä»¥ä¸‹æ¡ä»¶åŠ è½½\r\n    - ä¸ºäº†æ£€æŸ¥æ•°æ®åº“è€Œäº§ç”Ÿçš„JDBCé©±åŠ¨åŠ è½½\r\n    - ä¸ºäº†æ£€æŸ¥è¢«é‡å†™çš„æ–¹æ³•æ˜¯ä»€ä¹ˆè€Œåœ¨MBGçš„æ ¹ç›®å½•ä¸‹æœç´¢æ—¶\r\n    - â˜‚ï¸ æ³¨æ„ï¼šå½“åœ¨åŠ è½½ç»§æ‰¿MBGå†…éƒ¨ç±»æˆ–ä½¿ç”¨MBGå†…éƒ¨æ¥å£çš„ç±»çš„æ—¶å€™ï¼Œè¿™äº›å¤–éƒ¨æ–‡ä»¶ä¸ä¼šåŠ è½½ï¼Œå¦‚æœè¦åœ¨è¿™ä¸¤ç§ç±»åŠ è½½çš„æ—¶å€™ä½¿ç”¨å¤–éƒ¨æ–‡ä»¶ï¼Œä½ å¿…é¡»å°†å®ƒä»¬ç›´æ¥å¼•å…¥ç›®å½•å†…ï¼Œå°±åƒå¼•å…¥ä½ çš„MBGæ–‡ä»¶ä¸€æ ·ï¼ˆä¾‹å¦‚ä½¿ç”¨java -cpï¼‰\r\n- commentGeneratoræ ‡ç­¾ï¼šè‡ªåŠ¨æ³¨é‡Šï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é‡Œé¢å®ç°è‡ªå·±çš„æ¥å£\r\n    - suppressAllComments: trueä¸äº§ç”Ÿä»»ä½•çš„æ³¨é‡Š\r\n    - suppressDate: trueä¸äº§ç”Ÿä»»ä½•æ—¥æœŸ\r\n    - addRemarkComments: trueäº§ç”Ÿæ•°æ®åº“è‡ªå¸¦çš„è¡¨æˆ–è€…åˆ—çš„æ³¨é‡Š\r\n    - dateFormat: å½“suppressDateä¸ºfalseæ—¶ï¼Œè¿™é‡Œå¯ä»¥ä»¥DateFormatç±»è§„å®šçš„æ ¼å¼å¡«å…¥æ—¥æœŸï¼Œä¾‹å¦‚MM-dd-yyyy mm:ss\r\n    - useLegacyGeneratedAnnotation: trueåˆ™ä½¿ç”¨javaxä¸‹çš„æ³¨è§£ï¼Œå¦åˆ™ä½¿ç”¨jakartaä¸‹çš„æ³¨è§£\r\n- plugin:\r\n    - å’ŒéMBGplugin(**éœ€è¦åœ¨mybatis-config.xmlé‡Œé¢å£°æ˜**)çš„åŒºåˆ«ï¼šç”ŸæˆMBGçš„æ—¶å€™æ‰§è¡Œï¼ˆä»æ¥å£çš„ç»“æ„å¯ä»¥çœ‹å‡ºï¼‰ | æ‰§è¡ŒSQLçš„æ—¶å€™æ‰§è¡Œ\r\n    - ğŸ”¥ ProductListMybatis.jsp\r\n- ğŸ”¥ resources/MyBatisExtra.xml\r\n\r\n### å¯¹äºcommentGeneratorçš„é¢å¤–è¯´æ˜\r\n1.addRemarkComments:\r\n    .é¦–å…ˆéœ€è¦åœ¨oracleé‡Œåˆ›å»ºè¡¨æˆ–è€…åˆ—æ³¨é‡Šï¼š\r\n```\r\ncomment on table emp is \'commentary\'; --è¡¨æ³¨é‡Š\r\ncomment on column emp.empno is \'eno comment\'; --åˆ—æ³¨é‡Š\r\n```\r\n> ..ç„¶åéœ€è¦åœ¨jdbcConnectionæ ‡ç­¾é‡Œæ‰“å¼€remarksReporting\r\n\r\n2.ä»¿ç…§åŸç”Ÿæ¥å£å®ç°è‡ªå·±çš„æ¥å£ï¼Œå¯ä»¥å¾—çŸ¥ï¼ŒåŸç”Ÿæ¥å£çš„é€»è¾‘å¤§æ¦‚å¦‚ä¸‹\r\n```\r\nif (!suppressAllComments) {\r\n    element.addJavaDocLine(\"/**\");\r\n    element.addJavaDocLine(suppressDate ? \"\" : (dateFormat != null ? dateFormat.format(new Date()) : new Date().toString()));\r\n    element.addJavaDocLine((element.getClass() == null ? \"NULL\" : element.getClass()) + \": \" + (table == null ? \"\" : table.getFullyQualifiedTable()) + \" \" +\r\n            (column == null ? \"\" : column.getActualColumnName()) + \" \" +\r\n            (b == null ? \"\" : \"deletable?\" + b.booleanValue())\r\n    ); //è¿™é‡Œçš„ä¸‰ç›®è¿ç®—ç¬¦å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šæ£€æŸ¥b.booleanValue()æ˜¯å¦å¯æ‰§è¡Œï¼Œæˆ–è€…è¯´æ²¡æœ‰æˆåŠŸè¯†åˆ«åˆ°ä¸‰ç›®è¿ç®—ç¬¦\r\n    if (set != null)\r\n        set.forEach(i -> element.addJavaDocLine(i.getFullyQualifiedName()));\r\n    if (addRemarkComments) {\r\n        element.addJavaDocLine(\"tables: \" + (table == null ? \"none\" : table.getRemarks()) + \" cols: \" + (column == null ? \"none\" : column.getRemarks()));\r\n    }\r\n\r\n    element.addJavaDocLine(\"*/\");\r\n}\r\n\r\nif (element.getClass().getName().equals(Method.class.getName()) ||\r\n    element.getClass().getName().equals(Field.class.getName())) {\r\n    set.add(useLegacyGeneratedAnnotation ? new FullyQualifiedJavaType(\"javax.annotation.Generated\") : new FullyQualifiedJavaType(\"jakarta.annotation.Generated\"));\r\n    StringBuilder sb = new StringBuilder();\r\n    element.getJavaDocLines().forEach(i -> sb.append(i));\r\n    if (sb.length() > 5) element.addAnnotation(this.getGeneratedAnnotation(sb.substring(3, sb.toString().length() - 2)));\r\n}\r\n\r\n```\r\n+ CommentsImpl.java\r\n\r\nALTER TABLE partition_by_range ENABLE ROW MOVEMENT;\r\n\r\n### MBGDynamicSQLå¯¹æ•°æ®çš„æ‰¹å¤„ç†: batchInsert\r\n```\r\nList<partition> records = Arrays.asList(new partition(...), new partition(...));\r\n\r\npartitionDynamicSqlSupport.partition par = partitionDynamicSqlSupport.partition;\r\nBatchInsert.Builder builder = new BatchInsert.Builder().withInsertStatement(SqlBuilder.insert(records).into(par).map(par.iiiddd).toProperty(\"iiiddd\").map(par.insertDate).toProperty(\"insertDate\").build().render(RenderingStrategies.MYBATIS3).getInsertStatement());\r\nbuilder = builder.withRecords(records);\r\nBatchInsert<partition> batchInsert = builder.build();\r\n\r\nbatchInsert.insertStatements().stream().forEach(mapperpartition::insert);\r\n\r\nsession.commit();\r\n```', '2024-05-22 21:58:24'),(2, 1, 'Mybatis Plus', '## Mybatis Plus\r\n### æ‰€ç”¨åŒ…\r\n```\r\n- æœç´¢mybatis-plus in IDEA maven library 3.5.0\r\njsqlparser | mybatis | mybatis-plus | mybatis-plus-annotation | mybatis-plus-core | mybatis-plus-extension\r\n```\r\n- ç‰ˆæœ¬å·ä¸ºï¼šmybatis-plus 3.5.0 æ—¶æ‰èƒ½è§£æBaseMapper\r\n    - æœ€æ–°ç‰ˆæœ¬ä¼šä¸€ç›´è®©ç»‘å®šMapperï¼Œ3.5.0ç‰ˆæœ¬ä¸ä¼šè®©ç»‘å®šmapper\r\n\r\n#### æ¶ˆé™¤ç¬›å¡å°”ç§¯\r\n- \"æ¶ˆé™¤ç¬›å¡å°”ç§¯\" æ˜¯ä¸€ç§æ•°æ®åº“æŸ¥è¯¢å’Œä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå‡å°æ•°æ®åº“æ“ä½œçš„å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šè¡¨æŸ¥è¯¢ä¸­ã€‚å®ƒæœ‰åŠ©äºæé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“å’Œå¤„ç†ï¼ŒåŒæ—¶å‡å°‘æ•°æ®åº“çš„è´Ÿè½½ã€‚\r\nä½¿ç”¨å†…è¿æ¥ï¼ˆINNER JOINï¼‰ï¼š å†…è¿æ¥åªè¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¡Œï¼Œè€Œä¸æ˜¯è¿”å›ä¸¤ä¸ªè¡¨çš„ç¬›å¡å°”ç§¯ã€‚è¿™æ ·å¯ä»¥é¿å…ç”Ÿæˆå¤§é‡çš„ä¸­é—´æ•°æ®ã€‚\r\n\r\n    - ä½¿ç”¨ç´¢å¼•ï¼š ç¡®ä¿æ‚¨çš„æ•°æ®åº“è¡¨ä¸Šæœ‰é€‚å½“çš„ç´¢å¼•ã€‚ç´¢å¼•å¯ä»¥åŠ é€Ÿè¿æ¥æ“ä½œï¼Œå‡å°æŸ¥è¯¢çš„æ‰§è¡Œæ—¶é—´ã€‚\r\n    - é™åˆ¶ç»“æœé›†å¤§å°ï¼š åªæ£€ç´¢æ‚¨å®é™…éœ€è¦çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰è¡Œã€‚å¯ä»¥ä½¿ç”¨WHEREå­å¥æ¥è¿‡æ»¤ç»“æœé›†ã€‚\r\n    - ä½¿ç”¨å­æŸ¥è¯¢ï¼š ä½¿ç”¨å­æŸ¥è¯¢æ¥é™åˆ¶æ¯ä¸ªè¡¨çš„æ•°æ®ï¼Œç„¶åå†è¿æ¥å®ƒä»¬ã€‚è¿™å¯ä»¥å‡å°‘è¿æ¥çš„æ•°æ®é‡ã€‚\r\n    - ä½¿ç”¨åˆ†é¡µå’Œåˆ†å—æŸ¥è¯¢ï¼š å¦‚æœå¯èƒ½ï¼Œåªæ£€ç´¢éƒ¨åˆ†æ•°æ®ï¼Œä»¥åˆ†æ‰¹å¤„ç†ã€‚\r\n\r\n### plusçš„æ³¨è§£\r\n\r\n- @Table(value=, scheme=, autoResultMap=, )\r\n- å¦‚æœç”Ÿæˆç±»å¯¹å­—æ®µåæœ‰ç›´æ¥ä¿®æ”¹ï¼Œæ¯”å¦‚æ·»åŠ äº†å‰åç¼€\r\n    - @TableField(value=)\r\n    - @TableId(value=)\r\n        - byIdå¿…è¦æ³¨è§£\r\n\r\n### BaseMapper\r\n\r\n- BaseMapperåŒ…å«çš„æ–¹æ³•ä¼šå’ŒMGBç”Ÿæˆçš„æ–¹æ³•é€ æˆä½¿ç”¨æ–¹æ³•çš„å†²çªï¼Œå¿…é¡»è¦åˆ†å¼€æˆä¸¤ä¸ªç±»\r\n\r\n### IPageä½¿ç”¨å‰æ\r\nåœ¨@Configurationæ–‡ä»¶å†…åŠ å…¥\r\n\r\n```\r\n@PostConstruct //é…ç½®interceptor\r\npublic void addMyInterceptor() {\r\n    MybatisPlusInterceptor interceptor = mybatisPlusInterceptor();\r\n    sessionFactory.getConfiguration().addInterceptor(interceptor);\r\n}\r\n\r\npublic MybatisPlusInterceptor mybatisPlusInterceptor() {\r\n    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();\r\n    interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.ORACLE));\r\n    return interceptor;\r\n}\r\n```\r\n\r\n### MGBå±æ€§\r\n```\r\n<textarea>\r\n<table tableName=\"emp\" schema=\"scott\">\r\n    <columnRenamingRule searchString=\"^\" replaceString=\"emp_\"/> <!--^å¼€å¤´æ·»åŠ  ä¼šè‡ªåŠ¨è½¬æ¢æˆempåå¤§å†™-->\r\n</table>\r\n</textarea>\r\n```\r\n- å–æ¶ˆbigdecimaldçš„ç”Ÿæˆå¿…é¡»ä½¿ç”¨columnOverrideï¼Œåªè®¾ç½®JDBCTypeResolver forceBigDecimalæ˜¯ä¸å¤Ÿçš„\r\n- MGBé‡Œç”Ÿæˆçš„insertMultipleæ–¹æ³•è¿”å›çš„è¯­å¥ä¸ç¬¦åˆORACLEè¯­æ³•ï¼Œè¯•ç”Ÿæˆ\r\n\r\n```\r\nString sql = empMultiRowInsertDSL.map(emp.empEmpno).toProperty(\"empEmpno\").\r\nmap(emp.empJob).toProperty(\"empJob\").\r\nmap(emp.empComm).toProperty(\"empComm\").\r\nmap(emp.empEname).toProperty(\"empEname\").\r\nmap(emp.empMgr).toProperty(\"empMgr\").\r\nmap(emp.empDeptno).toProperty(\"empDeptno\").\r\nmap(emp.empHiredate).toProperty(\"empHiredate\").\r\nmap(emp.empSal).toProperty(\"empSal\").build().render(RenderingStrategies.MYBATIS3).getInsertStatement();\r\n```\r\n\r\n*æ­¤æ—¶ç”Ÿæˆçš„è¯­æ³•ä¸ºinsert into xxx values (ROW), (ROW)..ï¼Œä½†æ­£ç¡®çš„è¯­æ³•åº”è¯¥ä¸ºinsert all into xxx values (ROW) into xxx values (ROW) select * from dual*\r\n    - ä½ å¯ä»¥è®¤ä¸ºoracleä¸æ˜¾å¼åœ°æ”¯æŒæ‰¹é‡æ’å…¥\r\n    - å¦‚æœä¸€å®šè¦ä½¿ç”¨ä¹Ÿä¸è¦ä½¿ç”¨åŒåçš„æ–¹æ³•ï¼Œè‡ªå®šä¹‰æ–°çš„æ–¹æ³•ï¼Œä¸ç„¶å¯èƒ½å†²çªæŠ¥é”™\r\n### è¿æ¥æ± è¡¥å……\r\nå…³é”®é…ç½®\r\n_ | DBCP | C3P0 | DRUID\r\n-------|-------|-------|-------\r\næœ€å°è¿æ¥æ•°|minldle(0)|miniPoolSize(3)|minldle(0)\r\nåˆå§‹åŒ–è¿æ¥æ•°|innitialSize(0)|initialPoolSize(3)|initialSize\r\næœ€å¤§è¿æ¥æ•°|maxTotal(8)|maxPoolSize(15)|maxActive(8)\r\næœ€å¤§ç­‰å¾…æ—¶é—´|maxWaitMillis(æ¯«ç§’)|maxIdleTime(0ç§’)|maxWait(æ¯«ç§’)\r\n\r\n<textarea>\r\n<https://blog.51cto.com/u_15553139/5205148>\r\n</textarea>\r\n- åŸºäºä¸Šè¡¨é‡æ–°æ€»ç»“ï¼šDBCPå’ŒC3P0å±æ€§ä¸Šçš„æœ€å¤§åŒºåˆ«åœ¨äºC3P0æ²¡æœ‰maxIdleå±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šæ‰‹åŠ¨è®¾ç½®æœ€å¤§ç©ºé—²æ•°ï¼ŒC3P0çš„ç©ºé—²æ•°æ˜¯è‡ªåŠ¨ç®¡ç†çš„ã€‚\r\n\r\n#### DRUIDå¸¸ç”¨å±æ€§ï¼šinitialSize maxActive maxIdle poolPreparedStatements maxOpenPreparedStatement\r\n    - poolPreparedStatementsï¼šç»è¿‡å®éªŒå‘ç°ï¼Œåªæœ‰è¿æ¥æ± æœ‰ç©ºé—²ï¼ˆæŒ‡current active < maxActiveï¼‰æ—¶æ‰ä¼šç”Ÿæˆï¼Œå¦åˆ™æ²¡æœ‰æœºä¼šç”Ÿæˆ\r\n\r\n### é‡åˆ°çš„é—®é¢˜äºæ€»ç»“\r\n\r\n- autowiredçš„æ•°æ®åœ¨ç¬¬ä¸€æ¬¡ç±»åŠ è½½çš„æ—¶å€™æ‹¿ä¸åˆ°ï¼Œè¦ç­‰appContextåŠ è½½å®Œï¼Œä¸‹ä¸€æ¬¡æ‰å¯ä»¥æ‹¿åˆ°å€¼\r\n- MBGç”Ÿæˆçš„åŠ¨æ€sqlå’Œmybatis xmlå¯èƒ½é€ æˆå†²çªï¼Œä¹Ÿå°±è¯´xmlçš„å†…å®¹æœ€å¥½è‡ªå·±å†™\r\n- @TableName(\"emp\") //com.baomidou.mybatisplus.core.exceptions.MybatisPlusException: com.hyh.pojo.Emp Not Found TableInfoCache.\r\n- LambdaQueryWrapperåªè¿è¡Œäºcom.baomidou.mybatisplus.spring.SqlSessionFactoryBeanä¸‹\r\n- propertiesæ–‡ä»¶æ— æ³•è¯†åˆ«ï¼šä¿®æ”¹æ–‡ä»¶ç±»å‹ä¸ºproperties\r\n\r\n### åŒ¿åå‡½æ•°çš„æ›¿ä»£å…³ç³»\r\n<textarea>\r\n```\r\nnew UnaryOperator<MultiRowInsertDSL<Emp>>() {\r\n    @Override\r\n    public MultiRowInsertDSL<Emp> apply(MultiRowInsertDSL<Emp> empMultiRowInsertDSL) {\r\n        return empMultiRowInsertDSL.map(emp.empEmpno).toProperty(\"empEmpno\").\r\n        map(emp.empJob).toProperty(\"empJob\").\r\n        map(emp.empComm).toProperty(\"empComm\").\r\n        map(emp.empEname).toProperty(\"empEname\").\r\n        map(emp.empMgr).toProperty(\"empMgr\").\r\n        map(emp.empDeptno).toProperty(\"empDeptno\").\r\n        map(emp.empHiredate).toProperty(\"empHiredate\").\r\n        map(emp.empSal).toProperty(\"empSal\");\r\n}\r\n```\r\n</textarea>\r\n\r\n=\r\n\r\n```\r\nc -> c.\r\nmap(emp.empEmpno).toProperty(\"empEmpno\").\r\nmap(emp.empJob).toProperty(\"empJob\").\r\nmap(emp.empComm).toProperty(\"empComm\").\r\nmap(emp.empEname).toProperty(\"empEname\").\r\nmap(emp.empMgr).toProperty(\"empMgr\").\r\nmap(emp.empDeptno).toProperty(\"empDeptno\").\r\nmap(emp.empHiredate).toProperty(\"empHiredate\").\r\nmap(emp.empSal).toProperty(\"empSal\")\r\n```\r\n\r\n### XML\r\n\r\n- å¦‚æœæ²¡æœ‰æŒ‡å®šæ¥å£ï¼Œcollectioné‡Œé¢å¯é€‰é¡¹æœ‰collection, list\r\n\r\n### LOG4J\r\n\r\n```\r\n# Global logging configuration\r\nlog4j.rootLogger=INFO, file\r\n# MyBatis logging configuration...\r\nlog4j.logger.com.hyh=TRACE, file\r\nlog4j.log4j.Run=INFO, file\r\n# File output...\r\nlog4j.appender.file=org.apache.log4j.DailyRollingFileAppender\r\nlog4j.appender.file.DatePattern=\'.\'yyyy-MM-dd_hh-mm-ss\'.log\'\r\nlog4j.appender.file.File=logs/MBP\r\nlog4j.appender.file.layout=org.apache.log4j.PatternLayout\r\nlog4j.appender.file.layout.ConversionPattern=%5p [%t] - %m%n\r\n# Console output...\r\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\r\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\r\nlog4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n\r\n```\r\n\r\n### SSM:(SPRING + MYBATIS + SPRING-SERVLET)\r\n- æ‰«åŒ…è¦åœ¨beanä¹‹åï¼Œå¦åˆ™ä¼šå› ä¸ºautowiredä¸å­˜åœ¨è€Œå¤±è´¥', '2024-05-22 20:09:39'),(3, 1, 'Ajax | Vue', '## Ajax | Vue\r\nAjaxï¼ˆAsynchronous JavaScript and XMLï¼‰æ˜¯ä¸€ç§ç”¨äºåˆ›å»ºå¼‚æ­¥Webåº”ç”¨ç¨‹åºçš„æŠ€æœ¯ï¼Œå®ƒå…è®¸åœ¨ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹å‘æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ã€‚ä¼ é€’å€¼æˆ–æ•°æ®ç»™æœåŠ¡å™¨æˆ–ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®çš„è¿‡ç¨‹é€šå¸¸éœ€è¦ä½¿ç”¨Ajaxæ¥å®ç°ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨Ajaxä¼ é€’å€¼çš„ä¸€èˆ¬æ­¥éª¤ï¼š\r\n\r\n1. åˆ›å»ºXMLHttpRequestå¯¹è±¡ï¼š\r\nåœ¨JavaScriptä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªXMLHttpRequestå¯¹è±¡æ¥ä¸æœåŠ¡å™¨é€šä¿¡ã€‚è¿™æ˜¯å®ç°Ajaxçš„åŸºæœ¬æ­¥éª¤ä¹‹ä¸€ã€‚\r\n\r\n```javascript\r\nvar xhr = new XMLHttpRequest();\r\n```\r\n\r\n2. è®¾ç½®è¯·æ±‚æ–¹æ³•å’ŒURLï¼š\r\nä½¿ç”¨`xhr.open()`æ–¹æ³•æ¥æŒ‡å®šHTTPè¯·æ±‚çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼ŒGETæˆ–POSTï¼‰å’Œè¦è¯·æ±‚çš„URLã€‚\r\n\r\n```javascript\r\nxhr.open(\"GET\", \"your_server_endpoint.php\", true);\r\n```\r\n\r\n3. è®¾ç½®å›è°ƒå‡½æ•°ï¼š\r\nä½ éœ€è¦å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨è¯·æ±‚å®Œæˆæ—¶å¤„ç†æœåŠ¡å™¨çš„å“åº”æ•°æ®ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸åœ¨`xhr.onload`äº‹ä»¶ä¸­å®šä¹‰ã€‚\r\n\r\n```javascript\r\nxhr.onload = function() {\r\nif (xhr.status === 200) {\r\n// åœ¨è¿™é‡Œå¤„ç†æœåŠ¡å™¨å“åº”æ•°æ®\r\nvar response = xhr.responseText;\r\nconsole.log(response);\r\n}\r\n};\r\n```\r\n\r\n4. å‘é€è¯·æ±‚ï¼š\r\nä½¿ç”¨`xhr.send()`æ–¹æ³•æ¥å‘é€è¯·æ±‚ã€‚å¦‚æœä½ éœ€è¦å‘æœåŠ¡å™¨ä¼ é€’æ•°æ®ï¼Œå¯ä»¥å°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™`send()`æ–¹æ³•ã€‚\r\n\r\n```javascript\r\nxhr.send();\r\n```\r\n\r\n5. ä¼ é€’å€¼ï¼š\r\nå¦‚æœä½ éœ€è¦å‘æœåŠ¡å™¨ä¼ é€’ç‰¹å®šçš„å€¼ï¼Œå¯ä»¥åœ¨`xhr.send()`æ–¹æ³•ä¸­ä¼ é€’æ•°æ®ï¼Œé€šå¸¸æ˜¯ä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆGETè¯·æ±‚ï¼‰æˆ–è¯·æ±‚ä½“ï¼ˆPOSTè¯·æ±‚ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼š\r\n\r\n```javascript\r\nvar data = \"param1=value1&param2=value2\";\r\nxhr.send(data);\r\n```\r\n\r\nåœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ éœ€è¦å¤„ç†è¿™äº›ä¼ é€’çš„å€¼å¹¶æ ¹æ®å®ƒä»¬æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å…·ä½“çš„æœåŠ¡å™¨ç«¯å¤„ç†æ–¹å¼å–å†³äºä½ ä½¿ç”¨çš„åç«¯æŠ€æœ¯ï¼Œå¦‚PHPã€Node.jsã€Pythonç­‰ã€‚\r\n\r\nè¿™æ˜¯ä½¿ç”¨Ajaxä¼ é€’å€¼çš„åŸºæœ¬æ­¥éª¤ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚å’Œåç«¯æŠ€æœ¯ï¼Œä½ å¯èƒ½éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„å®šåˆ¶å’Œå¤„ç†ã€‚\r\n\r\næ€»çš„æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨jqueryå°†ä¼šç®€å•å¾ˆå¤šï¼š\r\n```\r\n// function loadDoc() {\r\n//     var xhttp = new XMLHttpRequest();\r\n//     xhttp.onreadystatechange = function() {\r\n//         if (this.readyState == 4 && this.status == 200) {\r\n//             document.getElementById(\"demo\").innerHTML = this.responseText;\r\n//         }\r\n//     };\r\n//     xhttp.open(\"GET\", \"/values/text\", true);\r\n//     xhttp.send();\r\n// }\r\nfunction loadDoc() {\r\n    $.get(\"/values/text\", function(data) {\r\n        $(\"#demo\").html(data);\r\n    });\r\n}\r\n```\r\n### æ³¨æ„\r\n- å†…éƒ¨applicationçˆ†çº¢ï¼šè°ƒæ•´é¡¹ç›®è®¾ç½®\r\n- sessionå’Œrequestçš„åœ°å€æ°¸è¿œä¸ä¼šå˜ï¼Œå˜çš„æ˜¯é‡Œé¢çš„æ•°æ®\r\n\r\n### log4j\r\n- æ— æ³•set log file\r\n    - æ·»åŠ æ”¹æ–‡ä»¶å¤¹å¤¹çš„å†™å…¥æƒé™\r\n    - ä½¿ç”¨ç»å¯¹è·¯å¾„\r\n- tomcatå’Œæµ‹è¯•æ–‡ä»¶åŒæ—¶æ‰§è¡Œå¯èƒ½è®©æµ‹è¯•æ–‡ä»¶æ²¡æœ‰æƒé™ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶è¢«å ç”¨\r\n\r\n### åŸå­æ€§\r\nè¿™æ˜¯å› ä¸º AtomicBoolean ä½¿ç”¨äº†åº•å±‚çš„ CPU æŒ‡ä»¤æ¥å®ç°è¿™äº›æ“ä½œï¼Œè€Œä¸æ˜¯ç®€å•çš„ Java è¯­è¨€çº§åˆ«çš„åŒæ­¥ã€‚\r\n\r\nAtomicBoolean çš„åŸå­æ€§åŸºäº Java ä¸­çš„ java.util.concurrent åŒ…ï¼Œè¯¥åŒ…æä¾›äº†ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹çš„å·¥å…·å’Œç±»ã€‚å®ƒä½¿ç”¨äº†åº•å±‚çš„ç¡¬ä»¶æ”¯æŒï¼Œå¦‚ CASï¼ˆCompare and Swapï¼‰æ“ä½œï¼Œä»¥ç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€‚\r\n\r\nCAS æ˜¯ä¸€ç§åŸºæœ¬çš„åŸå­æ“ä½œï¼Œå®ƒå¯ä»¥ç”¨äºæ›´æ–°ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œä½†ä»…åœ¨è¯¥å˜é‡çš„å½“å‰å€¼ç­‰äºä¸€ä¸ªæœŸæœ›å€¼æ—¶æ‰æ‰§è¡Œæ›´æ–°æ“ä½œã€‚å¦‚æœå½“å‰å€¼ä¸ç­‰äºæœŸæœ›å€¼ï¼ŒCAS æ“ä½œä¼šå¤±è´¥ï¼Œå¹¶ä¸”ä¸ä¼šæ‰§è¡Œæ›´æ–°ã€‚è¿™ç¡®ä¿äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸæ›´æ–°å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé‡è¯•æˆ–ç­‰å¾…ã€‚\r\n\r\n### VUE\r\nåŠ¨æ€ç”Ÿæˆhtmlä¼¼ä¹ç”¨vueæ¯”jså’Œajaxå¿«ä¸€ä¸‡å€\r\n- vueä¸­çš„ç®­å¤´å‡½æ•°å¯ç”¨äºæ•è·çˆ¶åŸŸï¼Œå¿½ç•¥è‡ªå·±çš„åŸŸï¼Œä»è€Œä¿æŒå˜é‡çš„ä¸€è‡´æ€§ï¼Œå®ç°åŒæ­¥æ›´æ–°\r\n- :xxxè¯­æ³•ä¸º:xxx=\"\'expression\' + var + \'expression \'\"\r\n- htmlçˆ¶æ ‡ç­¾è¦æ­£ç¡®ï¼Œå¦åˆ™æ— æ³•æ˜ å°„ç›¸åº”å…³ç³»\r\n- html formä¼ å€¼ å¿…é¡»è¦æœ‰name\r\n- $(() => {}) é¡µé¢åŠ è½½åæ‰§è¡Œ\r\n#### VUEæ•°æ®å®šä¹‰\r\n- å¦‚æœå¤„ç†åˆ—è¡¨æˆ–æ•°ç»„ï¼Œå¯ä»¥å®šä¹‰ä¸ºç©ºæ•°ç»„\r\n- å¦‚æœå¤„ç†å•ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å®šä¹‰ä¸ºç©ºå¯¹è±¡\r\n- htmlé¡µé¢ä¸Šè¾“å‡ºçš„æ•°æ®è¦æ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºæ‰è¾“å‡ºï¼Œè¿™æ ·å¯ä»¥ç­‰å¾…æ•°æ®æ‹‰å–è€Œä¸æŠ¥é”™\r\n- è¡¨å•æäº¤åˆ°VUE: @submit.prevent=\"updateRow\"\r\n```', '2024-05-22 20:09:53'),(4, 2, 'ç»§æ‰¿', '## ç»§æ‰¿\r\n### é‡åˆ°çš„é—®é¢˜ä¸æ€»ç»“\r\n\r\n- çˆ¶å­ç»§æ‰¿\r\n    - å¯¹çˆ¶ç±»ç»§æ‰¿åœ¨super.__init__(å‚æ•°)åŠ å‚æ•°\r\n    - *ä¸èƒ½ç”¨é€—å·é—´éš”æ¥å£°æ˜å¤šä¸ªå˜é‡ï¼Œç”¨åˆ†å·*\r\n- chatGPTä»£ç æ’é”™\r\n    - 1.ç®€åŒ–åå¸®æ”¹ 2.æŸ¥çœ‹åŸå› ', '2024-05-22 20:10:18'),(5, 1, 'Vueè„šæ‰‹æ¶', '## Vueè„šæ‰‹æ¶\r\n### RESTfulé£æ ¼\r\n- èµ„æºï¼ˆResourcesï¼‰ï¼šåœ¨ REST ä¸­ï¼Œä¸€åˆ‡éƒ½è¢«è§†ä¸ºèµ„æºï¼Œä¾‹å¦‚æ–‡æ¡£ã€å›¾åƒã€è§†é¢‘ã€æ•°æ®ç­‰ã€‚æ¯ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯URLï¼‰ã€‚\r\n- è¡¨ç°å±‚ï¼ˆRepresentationï¼‰ï¼šèµ„æºçš„çŠ¶æ€å¯ä»¥ä»¥ä¸åŒçš„è¡¨ç°å½¢å¼å‘ˆç°ï¼Œå¦‚JSONã€XMLã€HTML ç­‰ã€‚å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é€‚å½“çš„è¡¨ç°å½¢å¼æ¥è®¿é—®å’Œæ“ä½œèµ„æºã€‚\r\n- çŠ¶æ€æ— å…³ï¼ˆStatelessï¼‰ï¼šæ¯ä¸ªè¯·æ±‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºçš„è¯·æ±‚éƒ½å¿…é¡»åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨èƒ½å¤Ÿç†è§£è¯¥è¯·æ±‚ã€‚æœåŠ¡å™¨ä¸åº”è¯¥ä¾èµ–äºå®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€ä¿¡æ¯ã€‚\r\n- ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰ï¼šRESTful ç³»ç»Ÿåº”è¯¥å…·æœ‰ä¸€è‡´çš„æ¥å£ï¼Œä»¥ç®€åŒ–å®¢æˆ·ç«¯çš„æ“ä½œã€‚è¿™åŒ…æ‹¬ä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰æ¥æ‰§è¡Œå„ç§æ“ä½œï¼Œå¹¶ä½¿ç”¨æ ‡å‡†çš„çŠ¶æ€ç æ¥è¡¨ç¤ºæ“ä½œç»“æœã€‚\r\n- å®¢æˆ·ç«¯-æœåŠ¡å™¨åˆ†ç¦»ï¼ˆClient-Server Separationï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”è¯¥æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ¼”åŒ–å’Œæ‰©å±•ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚\r\n- å±‚æ¬¡ç»“æ„ï¼ˆLayered Systemï¼‰ï¼šRESTful æ¶æ„æ”¯æŒåˆ†å±‚ç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸€å±‚æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚è¿™ç§åˆ†å±‚å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚\r\n- å¯ç¼“å­˜æ€§ï¼ˆCachingï¼‰ï¼šRESTful æ”¯æŒå“åº”çš„ç¼“å­˜ï¼Œä»è€Œå‡å°‘å¯¹æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œæé«˜æ€§èƒ½ã€‚\r\n- æ— çŠ¶æ€ï¼ˆStatelessï¼‰ï¼šæ¯ä¸ªè¯·æ±‚éƒ½åº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¸åº”è¯¥ä¿å­˜å®¢æˆ·ç«¯çš„ä¸Šä¸‹æ–‡ã€‚è¿™æœ‰åŠ©äºç®€åŒ–æœåŠ¡å™¨çš„å®ç°ï¼Œå¹¶æé«˜å¯ä¼¸ç¼©æ€§ã€‚\r\n    - HTTP æ–¹æ³•ä¸­çš„ \"PUT\" æ˜¯ä¸€ç§ç”¨äºæ›´æ–°æˆ–åˆ›å»ºèµ„æºçš„æ–¹æ³•ã€‚PUT è¯·æ±‚å…è®¸å®¢æˆ·ç«¯æŒ‡å®šè¦æ›´æ–°çš„èµ„æºçš„æ ‡è¯†ç¬¦ï¼Œå¹¶æä¾›æ–°çš„èµ„æºè¡¨ç¤ºï¼Œä»¥æ›¿ä»£ç°æœ‰èµ„æºæˆ–åˆ›å»ºä¸€ä¸ªæ–°èµ„æºã€‚è¿™æ˜¯RESTful APIä¸­å¸¸è§çš„æ“ä½œä¹‹ä¸€ã€‚\r\n```\r\n~/.vuerc\r\n\r\nè¢«ä¿å­˜çš„ preset å°†ä¼šå­˜åœ¨ç”¨æˆ·çš„ home ç›®å½•ä¸‹ä¸€ä¸ªåä¸º .vuerc çš„ JSON æ–‡ä»¶é‡Œã€‚å¦‚æœä½ æƒ³è¦ä¿®æ”¹è¢«ä¿å­˜çš„ preset / é€‰é¡¹ï¼Œå¯ä»¥ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚\r\n```\r\n### cliçš„å®‰è£…æ˜¯åˆ†å¼€çš„ï¼ŒåŒ…æ‹¬vue addï¼Œå¦‚æœè¦å®‰è£…ï¼Œè¦åœ¨ç‰¹å®šç›®å½•ä¸‹å®‰è£…ï¼Œä¸”ä¸é€‰æ‹©æƒé™é™åˆ¶å¤šçš„Cç›˜\r\n```\r\nPS F:\\> cd F:\\JAVA\\20231010\r\nPS F:\\JAVA\\20231010> vue create vue-hello\r\ndefault\r\nnpm\r\nPS F:\\JAVA\\20231010> cd vue-hello\r\nPS F:\\JAVA\\20231010\\vue-hello> npm run serve\r\n```\r\n- Polyfill: Polyfillï¼ˆå¤šæ•°ç”¨æ³•ä¸ºå¤æ•°å½¢å¼ï¼špolyfillsï¼‰æ˜¯ä¸€ç§ç”¨äºå¡«è¡¥æµè§ˆå™¨æˆ–JavaScriptå¼•æ“ä¸­åŠŸèƒ½ä¸æ”¯æŒæˆ–ä¸å®Œå…¨æ”¯æŒçš„ç¼ºé™·çš„ä»£ç ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åœ¨æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–ç¯å¢ƒä¸­æ¨¡æ‹Ÿæ–°çš„JavaScriptç‰¹æ€§ã€APIæˆ–æ–¹æ³•ï¼Œä»¥ä¾¿ä½¿ç°ä»£çš„JavaScriptä»£ç èƒ½å¤Ÿåœ¨è¿™äº›ç¯å¢ƒä¸­è¿è¡Œã€‚\r\n### ä¸€äº›ç‰¹ç‚¹\r\n- é€šè¿‡~./vuercç®¡ç†é…ç½®ï¼Œæ’ä»¶\r\n- é€šè¿‡ä¸åŒçš„æ›´ç®€ä¾¿çš„è¯­æ³•ä½¿ç”¨html\r\n- é€šè¿‡é»˜è®¤è®¾ç½®çš„æ–¹æ³•åŠ è½½CSS\r\n- webpack:\r\n    - Webpack æ˜¯ä¸€ä¸ªå¼€æºçš„å‰ç«¯æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå®ƒæ˜¯ç°ä»£å‰ç«¯å¼€å‘ä¸­éå¸¸é‡è¦çš„å·¥å…·ä¹‹ä¸€ã€‚Webpack çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†å¤šä¸ªå‰ç«¯èµ„æºï¼Œå¦‚ JavaScriptã€CSSã€å›¾åƒç­‰ï¼Œæ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ªé™æ€æ–‡ä»¶ï¼Œä»¥ä¾¿ç”¨äºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\r\n    - é“¾å¼çš„æœ€å¤§ç‰¹ç‚¹æ˜¯ä½¿ç”¨æ–¹æ³•æ„å»ºï¼Œåº”ç”¨æ›´åŠ çµæ´»\r\n- å˜é‡ï¼šç¯å¢ƒå˜é‡ï¼Œå®¢æˆ·ç«¯å˜é‡ï¼ˆåªæœ‰ NODE_ENVï¼ŒBASE_URL å’Œä»¥ VUE_APP_ å¼€å¤´çš„å˜é‡å°†é€šè¿‡ webpack.DefinePlugin é™æ€åœ°åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„ä»£ç ä¸­ã€‚è¿™æ˜¯ä¸ºäº†é¿å…æ„å¤–å…¬å¼€æœºå™¨ä¸Šå¯èƒ½å…·æœ‰ç›¸åŒåç§°çš„ç§é’¥ï¼‰å’Œæœ¬åœ°å˜é‡ï¼ˆlocalï¼‰\r\n- å¯¼å‡ºåŒ…ä½¿ç”¨\r\n- ç»„ä»¶æ³¨å†Œ\r\n- å¼‚æ­¥ Web Components ç»„ä»¶ï¼šéƒ¨åˆ†åŠŸèƒ½å°å…¥å£ç»„ä»¶\r\n- æ ¹æ®ä¸åŒçš„äº‘å¹³å°è¿›è¡Œéƒ¨ç½²\r\n- ä¿å­˜preseté…ç½®ï¼Œä¾‹å¦‚tryï¼Œä½¿ç”¨æ—¶\r\n- æ·»åŠ æ’ä»¶ vue add xxxx\r\n```\r\nvue create my-new-project --preset try\r\n```\r\n* vueè¿˜å¯ä»¥ä½¿ç”¨vantåˆ›å»º\r\n#### é—®é¢˜è®°å½•\r\n- ERROR Error loading vue.config.js: ERROR TypeError: defineConfig is not a function\r\n- å®‰è£…vueçš„urlå¤„ç†å¹¶å¯¼å…¥åŒ…åé¡¹ç›®æŠ¥é”™æ— æ³•æ‰“å¼€\r\n    - npm install vue-file-upload --save  # æ¨æµ‹åŸå› vueç‰ˆæœ¬å‡ºç°é—®é¢˜ -- è§£å†³æ–¹å¼é‡æ–°å®‰è£…vue -- å› ä¸ºvueçš„é¢œè‰²ä¸å†æ”¹å˜\r\n- æ— æ³•ä¸Šä¼ æ–‡ä»¶\r\n    - æ–­ç‚¹æµ‹è¯•ä¼ æ¥çš„æ–‡ä»¶ä¸ºnull: åŸå› ä¹‹ä¸€ï¼šèµ„æ–™æœ‰é—®é¢˜ ä¹‹äºŒï¼šæŸ¥çœ‹F12Preview\r\n- ç¼–è¯‘é€Ÿåº¦è¿‡æ…¢\r\n    - æ‰“å¼€å¹¶è¡Œï¼Œå¢åŠ heap size [ \"File\" > \"Settings\" > \"Build, Execution, Deployment\" > \"Compiler\" ]\r\n```\r\nnpm upgrade\r\n```\r\n- vue-cliæ— æ³•æ­£å¸¸æ‰“å¼€ï¼šç›´æ¥æ”¹è‡ªå¸¦çš„ hello\r\n- tomcatå’Œvue-cliè¿è¡Œåœ¨ä¸åŒç«¯å£ä¸Šï¼štomcatæ”¯æŒè·¨åŸŸè¯·æ±‚\r\n```\r\n<textarea>\r\n<filter>\r\n    <filter-name>CorsFilter</filter-name>\r\n    <filter-class>org.apache.catalina.filters.CorsFilter</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>CorsFilter</filter-name>\r\n    <url-pattern>/*</url-pattern>\r\n</filter-mapping>\r\n</textarea>\r\n```\r\n- jqueryå¼•å…¥ï¼š\r\n```\r\nnpm add jquery\r\n-----------------------\r\nimport $ from \'jquery\';\r\n```\r\n- æ›´æ¢ä¸»é¡µï¼šæ¡†æ¶Vueä¸­çš„nameå±æ€§éœ€è¦å’Œimportä¸­å¼•ç”¨çš„åç§°ä¸€è‡´ï¼Œ**å¦åˆ™ä¸çŸ¥é“å¼•å…¥çš„æ˜¯ä»€ä¹ˆ**\r\n- æµ‹è¯•**æ³¨æ„**ï¼šå°è¯•æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡å¯å¼€å‘æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æ–°çš„ä»£ç ç”Ÿæ•ˆã€‚\r\n```\r\nvue-cli-service build\r\n```\r\nä¼šåœ¨ dist/ ç›®å½•äº§ç”Ÿä¸€ä¸ªå¯ç”¨äºç”Ÿäº§ç¯å¢ƒçš„åŒ…ï¼Œå¸¦æœ‰ JS/CSS/HTML çš„å‹ç¼©ï¼Œå’Œä¸ºæ›´å¥½çš„ç¼“å­˜è€Œåšçš„è‡ªåŠ¨çš„ vendor chunk splittingã€‚å®ƒçš„ chunk manifest ä¼šå†…è”åœ¨ HTML é‡Œã€‚\r\n### å¯åŠ¨\r\n```\r\nnpx vue-cli-service serve\r\n```\r\n- åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼šè¿è¡Œ npm run build å‘½ä»¤ï¼ŒVue CLI å°†ä½¿ç”¨åŠ¨æ€èµ„æºå…¥å£è¿›è¡Œæ„å»ºï¼Œå¹¶ç”Ÿæˆç”¨äºç”Ÿäº§ç¯å¢ƒçš„æ–‡ä»¶ã€‚\r\n- åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼šè¿è¡Œ npm run serve å‘½ä»¤ï¼ŒVue CLI å°†ä½¿ç”¨é™æ€èµ„æºå…¥å£ï¼Œå¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œä»¥ä¾¿ä½ å¯ä»¥å¿«é€Ÿå¼€å‘å’Œè°ƒè¯•é™æ€èµ„æºã€‚\r\n\r\n##### è·¨åŸŸè¯·æ±‚ï¼ˆCross-Origin Requestï¼‰\r\næŒ‡çš„æ˜¯é€šè¿‡ä¸€ä¸ªåŸŸåçš„ç½‘é¡µå»è¯·æ±‚å¦ä¸€ä¸ªåŸŸåä¸‹çš„èµ„æºçš„è¿‡ç¨‹ã€‚å½“ä½ çš„å‰ç«¯åº”ç”¨è¿è¡Œåœ¨ä¸€ä¸ªåŸŸåï¼ˆæˆ–ç«¯å£ï¼‰ä¸‹ï¼Œè€Œéœ€è¦ä»å¦ä¸€ä¸ªåŸŸåçš„æœåŠ¡å™¨ä¸Šè·å–æ•°æ®æˆ–èµ„æºæ—¶ï¼Œæµè§ˆå™¨ä¼šæ‰§è¡Œè·¨åŸŸè¯·æ±‚ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„æ¶æ„è·¨åŸŸè¯·æ±‚ã€‚\r\n```\r\npublic class CorsFilterServlet extends HttpServlet {\r\n@Override\r\nprotected void doOptions(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\r\n    ...\r\n}\r\n}\r\n```\r\n\r\n### æ•´åˆ\r\nä½¿ç”¨Tomcatå’ŒSpringä½œä¸ºåç«¯ï¼Œä»¥åŠVue.jsä½œä¸ºå‰ç«¯ï¼Œä½ å¯ä»¥å®ç°åç«¯æ•°æ®æä¾›ã€å‰ç«¯æ•°æ®è·å–ï¼Œå¹¶å®ç°åŠ¨æ€å’Œé™æ€èµ„æºåˆ†ç¦»çš„å®Œæ•´Webåº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„Webåº”ç”¨ç¨‹åºæ¶æ„ï¼Œé€šå¸¸è¢«ç§°ä¸º\"å‰åç«¯åˆ†ç¦»\"ã€‚\r\n\r\n#### ajaxåº“\r\nvueä¸­å¸¸è§çš„ajaxåº“æœ‰ï¼š\r\n- axios (æµè¡Œä¸”å¹¿æ³›ä½¿ç”¨)\r\n- vue-resource\r\n- fetch API\r\n- jQuery\r\n\r\n<textarea><https://vuejsdevelopers.com/2017/08/28/vue-js-ajax-recipes/></textarea>\r\n\r\n### ROUTER\r\n<textarea><https://router.vuejs.org/installation.html></textarea>\r\n\r\n### ä¿¡æ¯å­¤å²›\r\n- æ•°æ®å­¤ç«‹ï¼šæ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„ç³»ç»Ÿã€åº”ç”¨ç¨‹åºæˆ–ç»„ç»‡ä¸­ï¼Œç”±äºç¼ºä¹äº’æ“ä½œæ€§æˆ–æ•°æ®æ ‡å‡†ï¼Œè¿™äº›æ•°æ®æ— æ³•è¢«æ•´åˆæˆ–å…±äº«ã€‚\r\n- æŠ€æœ¯éšœç¢ï¼šæŠ€æœ¯é™åˆ¶æˆ–ä¸é€‚å½“çš„æŠ€æœ¯å·¥å…·å¯èƒ½å¯¼è‡´ä¿¡æ¯å­¤å²›é—®é¢˜ï¼Œä½¿ä¿¡æ¯éš¾ä»¥è·å–æˆ–å…±äº«ã€‚\r\n- ç»„ç»‡æ–‡åŒ–ï¼šæŸäº›ç»„ç»‡å†…éƒ¨çš„æ–‡åŒ–å’Œç»“æ„é—®é¢˜å¯èƒ½å¯¼è‡´ä¿¡æ¯å­¤å²›é—®é¢˜ï¼Œå› ä¸ºä¸åŒéƒ¨é—¨æˆ–å›¢é˜Ÿä¹‹é—´ä¸æ„¿æ„å…±äº«ä¿¡æ¯ã€‚\r\n\r\n### å¤šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½\r\n- æ·»åŠ åŒ…ï¼š\r\n    - commons-fileupload\r\n    - commons-io **è¯¥æŠ¥é”™ä¿¡æ¯å¯ä»¥F12 -> Network -> RED PACKAGE -> Preview**\r\n<textarea>\r\nåœ¨Webåº”ç”¨ç¨‹åºä¸­å®ç°å¤šæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½é€šå¸¸æ¶‰åŠåˆ°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„ä»£ç ã€‚ä¸‹é¢æˆ‘å°†ä¸ºä½ æä¾›ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ä¸€ä¸ªå…¸å‹çš„Vue.jså‰ç«¯åº”ç”¨å’ŒNode.jsåç«¯æœåŠ¡å™¨ä¸­å®ç°å¤šæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚\r\n\r\n**å¤šæ–‡ä»¶ä¸Šä¼ ï¼ˆå‰ç«¯éƒ¨åˆ† - Vue.jsï¼‰ï¼š**\r\n\r\n1. åœ¨Vueç»„ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªHTMLè¡¨å•å…ƒç´ ç”¨äºæ–‡ä»¶ä¸Šä¼ ï¼Œé€šå¸¸åŒ…æ‹¬ä¸€ä¸ª`<input type=\"file\">`å…ƒç´ ï¼Œå¯ä»¥å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼š\r\n\r\n```\r\n<template>\r\n  <div>\r\n    <form method=\"post\" @submit.prevent=\"uploadFiles\" enctype=\"multipart/form-data\">\r\n      <input type=\"file\" ref=\"fileInput\" multiple>\r\n      <input type=\"submit\" value=\"æäº¤\"/>\r\n    </form>\r\n\r\n    <span id=\"re\"></span>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import $ from \'jquery\';\r\nimport axios from \'axios\';\r\nexport default {\r\n  name: \"uploadComp\",\r\n  methods: {\r\n    async uploadFiles() {\r\n      const files = this.$refs.fileInput.files;\r\n      const formData = new FormData();\r\n\r\n      for (let i = 0; i < files.length; i++) {\r\n        formData.append(\"files\", files[i]);\r\n      }\r\n\r\n      try {\r\n        let response = await axios\r\n            .post(\"http://localhost:8080/return/upload\", formData, {\r\n              \"Content-Type\": \"multipart/form-data;charset=utf-8\",\r\n            })\r\n            .then((res) => {\r\n              return res.data.data;\r\n            })\r\n            .catch((error) => {\r\n              console.error(\"ä¸Šä¼ å¤±è´¥\", error);\r\n            });\r\n\r\n        // console.log(response);\r\n        // å¤„ç†æœåŠ¡å™¨çš„å“åº”\r\n      } catch (error) {\r\n        console.error(\"ä¸Šä¼ å¤±è´¥\", error);\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n```\r\n\r\n2. åœ¨`uploadFiles`æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è·å–æ–‡ä»¶çš„å¼•ç”¨ï¼Œå¹¶ä½¿ç”¨`FormData`å¯¹è±¡åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æ–‡ä»¶çš„è¡¨å•æ•°æ®ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨HTTPåº“ï¼ˆå¦‚Axiosï¼‰å°†FormDataå¯¹è±¡å‘é€åˆ°æœåŠ¡å™¨ã€‚\r\n\r\n**å¤šæ–‡ä»¶ä¸Šä¼ ï¼ˆåç«¯éƒ¨åˆ† - SSMï¼‰ï¼š**\r\n\r\n1. åœ¨Node.jsæœåŠ¡å™¨ç«¯ï¼Œä½ å¯ä»¥ä½¿ç”¨Express.jsä½œä¸ºæœåŠ¡å™¨æ¡†æ¶ï¼Œæ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼š\r\n\r\n```java\r\nString s = \"ä¸Šä¼ æˆåŠŸ\";\r\nfor (MultipartFile file : files) {\r\n    String classpath = \"F:\\\\JAVA\\\\20231010\\\\ssmAjax_vue\\\\test\";\r\n    File f = new File(classpath + \"\\\\uploaded\", file.getOriginalFilename());\r\n    System.out.println(f.getAbsolutePath());\r\n\r\n    try {\r\n        if (!f.getParentFile().exists()) f.getParentFile().mkdirs();\r\n        if (!f.exists()) f.createNewFile();\r\n\r\n        file.transferTo(f);\r\n    } catch (IOException e) {\r\n        s = \"ä¸Šä¼ å¤±è´¥\";\r\n        e.printStackTrace();\r\n    }\r\n}\r\n```\r\n\r\n**æ–‡ä»¶ä¸‹è½½ï¼š**\r\n\r\nnpm install --save-dev copy-webpack-plugin\r\n- æ–‡ä»¶ä¸‹è½½çš„æ—¶å€™æ— æ³•è¯†åˆ«æ–‡ä»¶åï¼Œä¸èƒ½ä½¿ç”¨PathVariableè¦ç”¨RequestParamå¦åˆ™å¯èƒ½ä¼šå¿½ç•¥.ä¹‹åçš„å€¼\r\n- å¤šæ–‡ä»¶ä¸‹è½½ï¼šè¦å…è®¸å¼¹çª—\r\n\r\n##### å‰ç«¯\r\n```\r\nfor (let index in files) {\r\n        try {\r\n          window.open(\"http://localhost:8080/download?file=\" + files[index])\r\n\r\n          $(\"#re\").html(\"ä¸‹è½½æˆåŠŸ\")\r\n          setTimeout(() => {\r\n            $(\"#re\").html(\"\")\r\n          }, 3000)\r\n        } catch (error) {\r\n          $(\"#re\").html(error)\r\n          console.log(error)\r\n        }\r\n      }\r\n```\r\n##### åç«¯\r\n```\r\nString s = \"ä¸‹è½½æˆåŠŸ\";\r\nFile f = new File(currentPath + innerUploadPath + file);\r\n\r\ntry {\r\n    if (f.exists()) {\r\n        rs.setContentType(\"multipart/form-data\");\r\n        rs.setCharacterEncoding(\"utf-8\");\r\n        rs.setHeader(\"Content-Disposition\", \"attachment;filename=\" + f.getName());\r\n\r\n        // è¯»å–æ–‡ä»¶å†…å®¹å¹¶å†™å…¥å“åº”è¾“å‡ºæµ\r\n        FileInputStream fileInputStream = new FileInputStream(f);\r\n        ServletOutputStream out = rs.getOutputStream();\r\n        rs.setCharacterEncoding(\"UTF-8\");\r\n        byte[] buffer = new byte[4096];\r\n        int bytesRead;\r\n        while ((bytesRead = fileInputStream.read(buffer)) != -1) {\r\n            out.write(buffer, 0, bytesRead);\r\n        }\r\n\r\n        fileInputStream.close();\r\n        out.flush();\r\n        out.close();\r\n    }\r\n} catch (Exception e) {\r\n    s = \"ä¸‹è½½å¤±è´¥ï¼š\" + e.getCause().getMessage();\r\n    System.out.println(\"ç”¨æˆ·é€‰æ‹©\");\r\n}\r\n```\r\n### Spring Boot\r\n- è‡ªåŠ¨é…ç½®ï¼šSpring Bootæä¾›äº†è®¸å¤šè‡ªåŠ¨é…ç½®ç±»ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œéœ€æ±‚è‡ªåŠ¨é…ç½®Springåº”ç”¨ç¨‹åºçš„å„ä¸ªæ–¹é¢ï¼Œå¦‚æ•°æ®æºã€WebæœåŠ¡å™¨ã€å®‰å…¨ç­‰ã€‚è¿™äº›é…ç½®ç±»é€šå¸¸åœ¨Spring Bootçš„å¯åŠ¨ç±»ä¸Šä½¿ç”¨@SpringBootApplicationæ³¨è§£æ¥å¯ç”¨ã€‚\r\n- ç±»è·¯å¾„æ‰«æï¼šSpring Bootä¼šè‡ªåŠ¨æ‰«æåº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ï¼ŒæŸ¥æ‰¾æ ‡æœ‰@Componentã€@Serviceã€@Repositoryç­‰æ³¨è§£çš„Beanï¼Œå¹¶å°†å®ƒä»¬æ³¨å†Œåˆ°Springå®¹å™¨ã€‚\r\n- å¤–éƒ¨åŒ–é…ç½®ï¼šSpring Bootæ”¯æŒå°†åº”ç”¨ç¨‹åºçš„é…ç½®ä»application.propertiesæˆ–application.ymlæ–‡ä»¶ä¸­åŠ è½½ã€‚ä½ å¯ä»¥åœ¨è¿™äº›é…ç½®æ–‡ä»¶ä¸­å®šä¹‰åº”ç”¨ç¨‹åºçš„å±æ€§ï¼Œè€Œä¸éœ€è¦æ˜¾å¼é…ç½®Beanã€‚Spring Bootä¼šè‡ªåŠ¨åŠ è½½è¿™äº›å±æ€§å¹¶åº”ç”¨å®ƒä»¬ã€‚\r\n- æ³¨è§£é©±åŠ¨ï¼ˆ**ä¸ä½¿ç”¨**ï¼‰ï¼šSpring Booté¼“åŠ±ä½¿ç”¨æ³¨è§£æ¥é…ç½®Beanã€ä¾èµ–æ³¨å…¥å’Œå…¶ä»–SpringåŠŸèƒ½ï¼Œè€Œä¸éœ€è¦XMLé…ç½®æ–‡ä»¶ã€‚\r\n\r\n- **ä¼˜åŠ¿**ï¼šä½¿ç”¨springBootä¹‹åå¯ä»¥ä¸å†åˆ›å»ºwebï¼Œspringbootä¼šå¸®ä½ åˆ›å»º\r\n\r\n- æ‰€ç”¨åŒ…\r\n    - assertj-core\r\n    - commons-fileupload\r\n    - gson\r\n    - hamcrest\r\n    - jakarta.annotation\r\n    - jakarta.xml.bind-api\r\n    - junit-jupiter\r\n    - mockito-junit-jupiter-3.1.0.jar\r\n    - spring-boot-2.2.5.RELEASE.jar\r\n    spring-boot-autoconfigure-2.2.5.RELEASE.jar\r\n    spring-boot-starter-2.2.5.RELEASE.jar\r\n    spring-boot-starter-json-2.2.5.RELEASE.jar\r\n    spring-boot-starter-logging-2.2.5.RELEASE.jar\r\n    spring-boot-starter-test-2.2.5.RELEASE.jar\r\n    spring-boot-starter-tomcat-2.2.5.RELEASE.jar\r\n    spring-boot-starter-validation-2.2.5.RELEASE.jar\r\n    spring-boot-starter-web-2.2.5.RELEASE.jar\r\n    spring-boot-test-2.2.5.RELEASE.jar\r\n    tomcat-annotations-api-9.0.48.jar\r\n    tomcat-api-9.0.48.jar\r\n    tomcat-catalina-9.0.48.jar\r\n    tomcat-coyote-9.0.48.jar\r\n    tomcat-el-api-9.0.48.jar\r\n    tomcat-embed-core-9.0.31.jar\r\n    tomcat-embed-el-9.0.31.jar\r\n    tomcat-embed-websocket-9.0.31.jar\r\n    tomcat-jaspic-api-9.0.48.jar\r\n    tomcat-jni-9.0.48.jar\r\n    tomcat-jsp-api-9.0.48.jar\r\n    tomcat-juli-9.0.48.jar\r\n    tomcat-servlet-api-9.0.48.jar\r\n    tomcat-util-9.0.48.jar\r\n    tomcat-util-scan-9.0.48.jar\r\n    xmlunit-core-2.6.3.jar\r\n    spring-test-5.2.4.RELEASE.jar\r\n- maven\r\n    <dependency>\r\n            <groupId>org.apache.tomcat</groupId>\r\n            <artifactId>tomcat-catalina</artifactId>\r\n            <version>9.0.48</version> <!-- ä½¿ç”¨ä½ éœ€è¦çš„ Tomcat ç‰ˆæœ¬ -->\r\n<!--            <scope>provided</scope> &lt;!&ndash; provided è¡¨ç¤ºåœ¨è¿è¡Œæ—¶ç”±å®¹å™¨æä¾› &ndash;&gt;-->\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>commons-fileupload</groupId>\r\n            <artifactId>commons-fileupload</artifactId>\r\n            <version>1.4</version> <!-- ä½¿ç”¨ä½ éœ€è¦çš„ç‰ˆæœ¬ -->\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.google.code.gson</groupId>\r\n            <artifactId>gson</artifactId>\r\n            <version>2.8.6</version> <!-- Use the version that includes setLenient() -->\r\n        </dependency>\r\n    <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-starter</artifactId>\r\n            <version>2.2.5.RELEASE</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-starter-test</artifactId>\r\n            <version>2.2.5.RELEASE</version>\r\n<!--            <scope>test</scope>-->\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-starter-web</artifactId>\r\n            <version>2.2.5.RELEASE</version>\r\n        </dependency>\r\n\r\n#### Spring Bootå¯åŠ¨ç¤ºä¾‹\r\n```\r\n@SpringBootApplication\r\npublic class Boot {\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(Config.class, args);\r\n    }\r\n}\r\n```\r\n- config dataSourceç­‰å‚æ•°çš„å¹³æ›¿\r\n```\r\n@Configuration\r\n@ComponentScan(\"com.hyh\")\r\npublic class Config extends WebMvcConfigurerAdapter {\r\n    @Bean(name = \"dataSource\")\r\n    @ConfigurationProperties(prefix = \"spring.datasource\")\r\n    public DataSource dataSource() {\r\n        DruidDataSource druidDataSource = new DruidDataSource();\r\n        druidDataSource.setUrl(\"jdbc:oracle:thin:@localhost:1521:orcl\");\r\n        druidDataSource.setDriverClassName(\"oracle.jdbc.driver.OracleDriver\");\r\n        druidDataSource.setUsername(\"scott\");\r\n        druidDataSource.setPassword(\"123456\");\r\n        return druidDataSource;\r\n    }\r\n\r\n    @Bean(name = \"sessionFactory\")\r\n    public MybatisSqlSessionFactoryBean sessionFactory(DataSource dataSource) {\r\n        MybatisSqlSessionFactoryBean sessionFactory = new MybatisSqlSessionFactoryBean();\r\n        sessionFactory.setDataSource(dataSource);\r\n        sessionFactory.setConfigLocation(new ClassPathResource(\"mybatis-config.xml\"));\r\n        sessionFactory.setTypeAliasesPackage(\"com.hyh.model\");\r\n        return sessionFactory;\r\n    }\r\n\r\n    @Bean(name = \"mapperScanner\")\r\n    public MapperScannerConfigurer mapperScanner(MybatisSqlSessionFactoryBean sessionFactory) {\r\n        MapperScannerConfigurer mapperScanner = new MapperScannerConfigurer();\r\n        mapperScanner.setSqlSessionFactoryBeanName(\"sessionFactory\");\r\n        mapperScanner.setBasePackage(\"com.hyh.mapper\");\r\n        return mapperScanner;\r\n    }\r\n\r\n    @Bean\r\n    public ServletWebServerFactory servletContainer() {\r\n        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();\r\n        // åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œé¢å¤–çš„é…ç½®\r\n        // factory.setPort(8080);\r\n        return factory;\r\n    }\r\n\r\n    @Override\r\n    public void addCorsMappings(CorsRegistry registry) {\r\n        registry.addMapping(\"/**\")\r\n                .allowedOrigins(\"http://localhost:8081\")\r\n                .allowedMethods(\"GET\", \"POST\", \"PUT\", \"DELETE\")\r\n                .allowCredentials(true)\r\n                .maxAge(3600);\r\n    }\r\n}\r\n```\r\n#### æ‹¦æˆªå™¨\r\n- ä¸ºä»€ä¹ˆå¤šæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½è¦ä½¿ç”¨æ‹¦æˆªå™¨ï¼š\r\nå¤šæ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½è¦ä½¿ç”¨æ‹¦æˆªå™¨æ˜¯å› ä¸ºæ‹¦æˆªå™¨å¯ä»¥æ‹¦æˆªHTTPè¯·æ±‚å’Œå“åº”ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€å“åº”ç¼“å­˜ç­‰ã€‚å¯¹äºå¤šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½ï¼Œä½¿ç”¨æ‹¦æˆªå™¨å¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ£€æŸ¥æ–‡ä»¶ç±»å‹ã€å¤§å°ã€æƒé™ç­‰ï¼Œæˆ–è€…åœ¨æ–‡ä»¶ä¸Šä¼ ä¸‹è½½å®Œæˆåè¿›è¡Œæ¸…ç†ã€ç»Ÿè®¡ç­‰æ“ä½œã€‚\r\nå¦å¤–ï¼Œæ‹¦æˆªå™¨è¿˜å¯ä»¥ç”¨äºå®ç°ä¸€äº›é€šç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è®°å½•è¯·æ±‚å’Œå“åº”çš„ä¿¡æ¯ã€å¤„ç†å¼‚å¸¸ç­‰ã€‚é€šè¿‡ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå¯ä»¥å°†è¿™äº›é€šç”¨çš„åŠŸèƒ½å°è£…èµ·æ¥ï¼Œé¿å…åœ¨æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä¸­é‡å¤ç¼–å†™ä»£ç ã€‚\r\næ€»ä¹‹ï¼Œä½¿ç”¨æ‹¦æˆªå™¨å¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ é¢å¤–çš„åŠŸèƒ½å’Œå®ç°ä¸€äº›é€šç”¨çš„æ“ä½œï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚\r\n\r\n##### ç®€å•ç¤ºä¾‹ï¼šæ£€æµ‹sessionä¸å…è®¸è®¿é—®\r\n    @Around(\"this(com.hyh.controller.UploadController)\") //* classçš„é€šé…ç¬¦\r\n    public Object restrainBeforeUpload(ProceedingJoinPoint jp) throws Throwable {\r\n        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();\r\n        HttpSession session = request.getSession();\r\n\r\n        if (session.getAttribute(\"hello\") != null)\r\n            return jp.proceed();\r\n        else\r\n            return null;\r\n    }\r\n\r\n#### é™æ€å¯¹è±¡\r\n    public static void main(String[] args) { // è¿™é‡Œé¢åˆ›å»ºçš„å¯¹è±¡æ˜¯é™æ€å¯¹è±¡ï¼Œä¹Ÿåªæœ‰è¿™é‡Œé¢çš„å¯¹è±¡å¯ä»¥è°ƒç”¨é™æ€æ–¹æ³•ä¸”åœ°å€ä¸åŒ\r\n        MyClass myObject1 = new MyClass();\r\n        MyClass myObject2 = new MyClass();\r\n    }\r\n\r\n#### tomcatå¿«é€Ÿé‡å¯\r\n    edit-configuration -> on update -> hot swap classes\r\n\r\n#### è·å–æœ¬æœºip\r\n```\r\n        String hostIp = \"\";\r\n\r\n        try {\r\n            Enumeration<NetworkInterface> interfaces = NetworkInterface.getNetworkInterfaces();\r\n            while (interfaces.hasMoreElements()) {\r\n                NetworkInterface iface = interfaces.nextElement();\r\n                if (iface.isLoopback() || !iface.isUp()) {\r\n                    continue;\r\n                }\r\n\r\n                Enumeration<InetAddress> addresses = iface.getInetAddresses();\r\n                while (addresses.hasMoreElements()) {\r\n                    InetAddress addr = addresses.nextElement();\r\n                    if (iface.getDisplayName().contains(\"Intel(R) Wireless-AC 9560 160MHz\")\r\n                    && addr.getHostAddress().split(\"\\\\.\").length == 4) {\r\n                        hostIp = addr.getHostAddress();\r\n                    }\r\n\r\n                }\r\n            }\r\n        } catch (SocketException e) {\r\n            e.printStackTrace();\r\n        }\r\n```\r\n\r\n### å…³é”®è¯\r\n> head, header', '2024-12-15 18:24:22'),(6, 1, 'Solr AliPay Xml Stream Vue3å“åº”å¼', '## Solr AliPay Xml Stream Vue3å“åº”å¼\r\n- è®¿é—® Apache Solr å®˜ç½‘ï¼Œä¸‹è½½\r\n- è¿›å…¥binï¼Œæ‰§è¡Œ: `solr [re]start -p 8983`\r\n- è®¿é—®ï¼š<http://localhost:8983/solr/>\r\n- åˆ›å»ºæ ¸å¿ƒï¼š`solr create -c CDataCore`\r\n- <https://juejin.cn/post/6850418112488996871>\r\n- å¯¼å…¥mysql jaråŒ…\r\n\r\n##### ä½¿ç”¨ç¤ºä¾‹\r\n```\r\n        // Solr æœåŠ¡å™¨çš„åœ°å€ï¼Œæ›¿æ¢æˆä½ è‡ªå·±çš„ Solr åœ°å€\r\n        String solrUrl = \"http://localhost:8983/solr/CDataCore\";\r\n\r\n        // åˆ›å»º SolrClient å¯¹è±¡\r\n        SolrClient solr = new HttpSolrClient.Builder(solrUrl).build();\r\n\r\n        // æ„å»º Solr æŸ¥è¯¢\r\n        SolrQuery query = new SolrQuery();\r\n        query.setQuery(\"*:*\"); // æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£ï¼Œå¯ä»¥æ›¿æ¢æˆä½ çš„å…·ä½“æŸ¥è¯¢æ¡ä»¶\r\n        query.setRows(10); // è®¾ç½®è¿”å›ç»“æœçš„è¡Œæ•°\r\n\r\n        try {\r\n            // æ‰§è¡ŒæŸ¥è¯¢\r\n            QueryResponse response = solr.query(query);\r\n\r\n            // è·å–æŸ¥è¯¢ç»“æœ\r\n            SolrDocumentList results = response.getResults();\r\n\r\n            // å¤„ç†æŸ¥è¯¢ç»“æœ\r\n            for (SolrDocument document : results) {\r\n                // å¯ä»¥æ ¹æ®éœ€è¦è·å–å­—æ®µå€¼\r\n                String id = (String) document.getFieldValue(\"id\");\r\n                String title = \"\";\r\n\r\n                title = (String) document.getFieldValue(\"sname\");\r\n\r\n                // åœ¨è¿™é‡Œå¤„ç†è·å–åˆ°çš„å­—æ®µå€¼\r\n                System.out.println(\"ID: \" + id + \", Title: \" + title);\r\n            }\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        } finally {\r\n            // å…³é—­ SolrClient è¿æ¥\r\n            try {\r\n                solr.close();\r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n```\r\n\r\n### æ”¯ä»˜å®\r\n<https://blog.csdn.net/weixin_45394086/article/details/121843483>\r\n<https://zhuanlan.zhihu.com/p/596771147>å…·ä½“è§gité¡¹ç›®leetcode -> tries -> springbootæ¨¡å—\r\n\r\n#### xmlæ–‡ä»¶å¤„ç†\r\nxml\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<library>\r\n    <book id=\"001\">\r\n        <title>Java Programming</title>\r\n        <author>John Doe</author>\r\n        <genre>Programming</genre>\r\n    </book>\r\n    <book id=\"002\">\r\n        <title>Data Structures and Algorithms</title>\r\n        <author>Jane Smith</author>\r\n        <genre>Computer Science</genre>\r\n    </book>\r\n</library>\r\n```\r\n```\r\ntry {\r\n            // æŒ‡å®šè¦è§£æçš„ XML æ–‡ä»¶è·¯å¾„\r\n            File inputFile = new File(\"src\\\\main\\\\java\\\\tries\\\\xml\\\\test.xml\");\r\n\r\n            // åˆ›å»ºä¸€ä¸ª DocumentBuilderFactory å®ä¾‹\r\n            DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\r\n\r\n            // åˆ›å»ºä¸€ä¸ª DocumentBuilder å®ä¾‹ï¼Œç”¨äºæ„å»º Document å¯¹è±¡\r\n            DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\r\n\r\n            // ä½¿ç”¨ DocumentBuilder è§£æ XML æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºæ•´ä¸ª XML æ–‡æ¡£çš„ Document å¯¹è±¡\r\n            Document doc = dBuilder.parse(inputFile);\r\n\r\n            // å¯¹æ–‡æ¡£è¿›è¡Œæ ‡å‡†åŒ–ï¼Œä½¿å…¶æ˜“äºå¤„ç†\r\n            doc.getDocumentElement().normalize();\r\n\r\n            // æ‰“å°æ ¹å…ƒç´ çš„åç§°\r\n            System.out.println(\"Root element: \" + doc.getDocumentElement().getNodeName());\r\n\r\n            // è·å–æ–‡æ¡£ä¸­æ‰€æœ‰åä¸º \"book\" çš„å…ƒç´ \r\n            NodeList bookList = doc.getElementsByTagName(\"book\");\r\n\r\n            // å¾ªç¯éå†æ‰€æœ‰ \"book\" å…ƒç´ \r\n            for (int temp = 0; temp < bookList.getLength(); temp++) {\r\n                // è·å–å½“å‰éå†åˆ°çš„ \"book\" å…ƒç´ \r\n                Node bookNode = bookList.item(temp);\r\n\r\n                // ç¡®ä¿å½“å‰èŠ‚ç‚¹æ˜¯å…ƒç´ èŠ‚ç‚¹\r\n                if (bookNode.getNodeType() == Node.ELEMENT_NODE) {\r\n                    // å°†å½“å‰èŠ‚ç‚¹è½¬æ¢ä¸º Element ç±»å‹\r\n                    Element bookElement = (Element) bookNode;\r\n\r\n                    // è¾“å‡ºå½“å‰ä¹¦ç±çš„ ID\r\n                    System.out.println(\"\\nBook ID: \" + bookElement.getAttribute(\"id\"));\r\n\r\n                    // è¾“å‡ºå½“å‰ä¹¦ç±çš„æ ‡é¢˜\r\n                    System.out.println(\"Title: \" + bookElement.getElementsByTagName(\"title\").item(0).getTextContent());\r\n\r\n                    // è¾“å‡ºå½“å‰ä¹¦ç±çš„ä½œè€…\r\n                    System.out.println(\"Author: \" + bookElement.getElementsByTagName(\"author\").item(0).getTextContent());\r\n\r\n                    // è¾“å‡ºå½“å‰ä¹¦ç±çš„æµæ´¾\r\n                    System.out.println(\"Genre: \" + bookElement.getElementsByTagName(\"genre\").item(0).getTextContent());\r\n                }\r\n            }\r\n        } catch (Exception e) {\r\n            // æ•è·å¯èƒ½å‡ºç°çš„å¼‚å¸¸å¹¶æ‰“å°å¼‚å¸¸ä¿¡æ¯\r\n            e.printStackTrace();\r\n        }\r\n```\r\n\r\n#### é€šè¿‡ä¼šè¯å’Œæ¶ˆæ¯å¯¹è±¡å‘é€é‚®ä»¶ç¤ºä¾‹ tries leetcode åŠ è½½åŠ¨ç”»\r\n```\r\n public String sendMail(String mail) {\r\n        // é…ç½®é‚®ä»¶æœåŠ¡å™¨å±æ€§\r\n        Properties properties = new Properties();\r\n        properties.put(\"mail.smtp.host\", \"smtp.163.com\"); // è®¾ç½® SMTP æœåŠ¡å™¨\r\n        properties.put(\"mail.smtp.port\", \"465\"); // è®¾ç½® SMTP ç«¯å£ï¼ˆä¸€èˆ¬ä¸º 25 æˆ– 465ï¼‰\r\n        properties.put(\"mail.smtp.auth\", \"true\"); // å¯ç”¨èº«ä»½éªŒè¯\r\n        properties.put(\"mail.smtp.ssl.enable\", \"true\"); // ä½¿ç”¨ SSL åŠ å¯†\r\n\r\n        // è®¾ç½®å‘é€é‚®ä»¶çš„è´¦æˆ·ä¿¡æ¯\r\n        final String username = \"yysxiaohao201802@163.com\";\r\n        final String password = \"TRRNKSJQSXZQOLAL\"; // æˆ–è€…æ˜¯æˆæƒç ï¼Œæ ¹æ®ä½ çš„é‚®ç®±æä¾›å•†è€Œå®š\r\n\r\n        // åˆ›å»ºä¼šè¯å¯¹è±¡\r\n        Session session = Session.getInstance(properties, new Authenticator() {\r\n            @Override\r\n            protected PasswordAuthentication getPasswordAuthentication() {\r\n                final PasswordAuthentication passwordAuthentication = new PasswordAuthentication(username,\r\n                        password);\r\n                return passwordAuthentication;\r\n            }\r\n        });\r\n\r\n        StringBuilder code = new StringBuilder();\r\n\r\n        try {\r\n            // åˆ›å»ºæ¶ˆæ¯å¯¹è±¡\r\n            Message message = new MimeMessage(session);\r\n\r\n            // è®¾ç½®å‘ä»¶äºº\r\n            message.setFrom(new InternetAddress(username));\r\n\r\n            // è®¾ç½®æ”¶ä»¶äºº\r\n            message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(mail));\r\n\r\n            String characters = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\r\n            int length = 6;\r\n\r\n            Random random = new Random();\r\n\r\n            for (int i = 0; i < length; i++) {\r\n                int index = random.nextInt(characters.length());\r\n                code.append(characters.charAt(index));\r\n            }\r\n\r\n            // è®¾ç½®é‚®ä»¶ä¸»é¢˜\r\n            message.setSubject(\"è¿™æ˜¯æ‚¨çš„éªŒè¯ç \");\r\n\r\n            // è®¾ç½®é‚®ä»¶å†…å®¹\r\n            message.setText(\"éªŒè¯ç ï¼š\" + code);\r\n\r\n            // å‘é€é‚®ä»¶\r\n            Transport.send(message);\r\n            System.out.println(\"é‚®ä»¶å‘é€æˆåŠŸï¼\");\r\n        } catch (MessagingException e) {\r\n            e.printStackTrace();\r\n            System.out.println(\"é‚®ä»¶å‘é€å¤±è´¥ï¼š\" + e.getMessage());\r\n        }\r\n\r\n        return code.toString();\r\n    }\r\n```\r\n\r\n#### Stream java 1.8\r\n<https://blog.csdn.net/m0_63364103/article/details/130136467>\r\n\r\nç›®çš„ï¼šç”¨äºè®¡ç®—ï¼Œä¸ä¿å­˜æ•°æ®\r\n\r\n- BaseStreamï¼šåŸºç¡€æ¥å£ï¼Œå£°æ˜äº†æµç®¡ç†çš„æ ¸å¿ƒæ–¹æ³•ï¼›\r\n\r\n- Streamï¼šæ ¸å¿ƒæ¥å£ï¼Œå£°æ˜äº†æµæ“ä½œçš„æ ¸å¿ƒæ–¹æ³•ï¼Œå…¶ä»–æ¥å£ä¸ºæŒ‡å®šç±»å‹çš„é€‚é…\r\n\r\n1.æ™®é€šä½¿ç”¨\r\n\r\n2.ä¸­é—´æ“ä½œç¬¦ï¼Œæ‡’æƒ°å¼è®¾è®¡: å¯¹äºæ•°æ®çš„è®¡ç®—åªæœ‰éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œ\r\n\r\nç¤ºä¾‹ï¼š[streamå¯¹æ–‡ä»¶ é›†åˆçš„æ“ä½œå’ŒstreamåŸºäºæ•°æ®å¤„ç†çš„åŒ–ç®€ ä»¥åŠstreamå¯¹äºçº¿ç¨‹çš„å¤„ç†]\r\n```\r\npackage tries.stream;\r\n\r\nimport org.apache.solr.common.util.ContentStreamBase;\r\nimport org.junit.Test;\r\n\r\nimport java.io.IOException;\r\nimport java.nio.charset.Charset;\r\nimport java.nio.charset.StandardCharsets;\r\nimport java.nio.file.Files;\r\nimport java.nio.file.Paths;\r\nimport java.util.*;\r\nimport java.util.function.BinaryOperator;\r\nimport java.util.stream.Collectors;\r\nimport java.util.stream.IntStream;\r\nimport java.util.stream.Stream;\r\n\r\npublic class TestStream {\r\n\r\n    @Test\r\n    public void streamFromList () {\r\n        Stream<Integer> stream1 = Stream.of(1, 2, 3, 4, 5);\r\n        stream1.forEach(System.out::println);\r\n\r\n        List<Integer> integerList = Arrays.asList(new Integer[]{1, 2, 3, 4, 5});\r\n        Stream<Integer> listStream = integerList.stream();\r\n        listStream.forEach(System.out::println);\r\n    }\r\n\r\n    @Test\r\n    public void streamFromArray() {\r\n        int[] intArr = {1, 2, 3, 4, 5};\r\n        IntStream arrayStream = Arrays.stream(intArr);\r\n        arrayStream.forEach(System.out::println);\r\n    }\r\n\r\n    @Test\r\n    public void readFileLines() {\r\n        try {\r\n            Stream<String> fileStream = Files.lines(\r\n                    Paths.get(\"F:\\\\JAVA\\\\20231010\\\\LeetCode\\\\src\\\\main\\\\java\\\\tries\\\\stream\\\\data.txt\"),\r\n                    Charset.defaultCharset());\r\n            fileStream.forEach(System.out::println);\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void createFunction() {\r\n        Stream<Integer> iterateStream = Stream.iterate(0, n -> n + 2).limit(5);\r\n        iterateStream.forEach(System.out::println);\r\n\r\n        Stream<Double> generateStream = Stream.generate(Math::random).limit(5);\r\n        generateStream.forEach(System.out::println);\r\n    }\r\n\r\n    List strings = Arrays.asList(\"abc\", \"\", \"bc\", \"efg\", \"abcd\",\"\", \"jkl\");\r\n    List repeated = Arrays.asList(\"abc\", \"abc\");\r\n    List disordered = Arrays.asList(\"f\", \"a\");\r\n    List<Integer> numbers = Arrays.asList(1, 99, 3, 30, -20);\r\n\r\n    //filter map distinct sorted flatMap peek limit skip\r\n    @Test\r\n    public void normalMethod() {\r\n        System.out.println(strings.stream().filter(string -> !string.equals(\"\")).collect(Collectors.toList()));\r\n        System.out.println(strings.stream().map(str -> str + \"-itcast\").collect(Collectors.toList()));\r\n        System.out.println(repeated.stream().distinct().collect(Collectors.toList()));\r\n        System.out.println(disordered.stream().sorted().collect(Collectors.toList()));\r\n        System.out.println(numbers.stream().peek(System.out::println));\r\n        System.out.println(strings.stream().limit(3).collect(Collectors.toList()));\r\n        System.out.println(strings.stream().skip(3).collect(Collectors.toList()));\r\n        int sum = numbers.stream().reduce(0, (a, b) -> a + b);\r\n        System.out.println(\"Sum of numbers: \" + sum);\r\n        System.out.println(numbers.stream().anyMatch(number -> number % 2 == 0));\r\n    }\r\n\r\n    @Test\r\n    public void streamCompareAndUse() {\r\n        String[] intArr = {\"1-1\", \"2-1\", \"3-1\", \"4-1\", \"5-1\"};\r\n        List arrayStream = Arrays.asList(intArr);\r\n        System.out.println(arrayStream.stream().map(number -> Stream.of(number.toString().split(\"-\")).collect(Collectors.toList())).collect(Collectors.toList()));\r\n        System.out.println(arrayStream.stream().flatMap(number -> Stream.of(number.toString().split(\"-\"))).collect(Collectors.toList()));\r\n\r\n        Stream<String> lines = null;\r\n        try {\r\n            lines = Files.lines(Paths.get(\"F:\\\\JAVA\\\\20231010\\\\LeetCode\\\\src\\\\main\\\\java\\\\tries\\\\stream\\\\passage.txt\"),\r\n                    StandardCharsets.UTF_8);\r\n            Stream<String> words = lines.flatMap(line -> Stream.of(line.split(\" +\")));\r\n            System.out.println(words.collect(Collectors.toList()));\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n    @Test\r\n    public void streamMultiThread() {\r\n        List<Integer> list = Arrays.asList(1, 2, 3, 99);\r\n        // é€šè¿‡List æ¥å£ ç›´æ¥è·å–å¹¶è¡Œæµ\r\n        Stream<Integer> integerStream = list.parallelStream();\r\n        // å°†å·²æœ‰çš„ä¸²è¡Œæµè½¬æ¢ä¸ºå¹¶è¡Œæµ\r\n        Stream<Integer> parallel = Stream.of(1, 2, 3).parallel();\r\n        parallel = integerStream;\r\n\r\n        Object obj = new Object();\r\n        Vector v = new Vector();\r\n        List<Integer> syncronizedList = Collections.synchronizedList(new ArrayList<>(v)); //ç›¸å½“äºçº¿ç¨‹å®‰å…¨åœ°æ·»åŠ äº†\r\n        System.out.println(parallel // å°†æµè½¬æ¢ä¸ºå¹¶å‘æµï¼ŒStreamå¤„ç†çš„æ—¶å€™å°±ä¼šé€šè¿‡å¤šçº¿ç¨‹å¤„ç†\r\n                .filter(s -> {\r\n                    syncronizedList.add(s);\r\n                    synchronized (obj) {\r\n                        System.out.println(Thread.currentThread() + \" s=\" + s);\r\n                        v.add(s);\r\n                        return s > 2;\r\n                    }\r\n                }).count());\r\n        System.out.println(v);\r\n        System.out.println(syncronizedList);\r\n\r\n        System.out.println(IntStream.rangeClosed(1, 100)\r\n                .parallel()\r\n                .boxed()\r\n                .collect(Collectors.toList())); //è¿™æ ·å¹¶è¡Œæµä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„\r\n\r\n    }\r\n\r\n}\r\n\r\n```\r\n\r\n#### streamå¯¹æ•°æ®åº“æ•°æ®çš„å¤„ç†\r\n\r\n```\r\npackage tries.stream;\r\n\r\nimport org.apache.solr.common.util.ContentStreamBase;\r\nimport org.junit.Test;\r\n\r\nimport java.io.IOException;\r\nimport java.nio.charset.Charset;\r\nimport java.nio.charset.StandardCharsets;\r\nimport java.nio.file.Files;\r\nimport java.nio.file.Paths;\r\nimport java.util.*;\r\nimport java.util.concurrent.atomic.AtomicReference;\r\nimport java.util.function.BinaryOperator;\r\nimport java.util.stream.Collectors;\r\nimport java.util.stream.IntStream;\r\nimport java.util.stream.Stream;\r\n\r\nimport static java.util.stream.Collectors.*;\r\n\r\npublic class TestStream {\r\n\r\n    @Test\r\n    public void streamFromList () {\r\n        Stream<Integer> stream1 = Stream.of(1, 2, 3, 4, 5);\r\n        stream1.forEach(System.out::println);\r\n\r\n        List<Integer> integerList = Arrays.asList(new Integer[]{1, 2, 3, 4, 5});\r\n        Stream<Integer> listStream = integerList.stream();\r\n        listStream.forEach(System.out::println);\r\n    }\r\n\r\n    @Test\r\n    public void streamFromArray() {\r\n        int[] intArr = {1, 2, 3, 4, 5};\r\n        IntStream arrayStream = Arrays.stream(intArr);\r\n        arrayStream.forEach(System.out::println);\r\n    }\r\n\r\n    @Test\r\n    public void readFileLines() {\r\n        try {\r\n            Stream<String> fileStream = Files.lines(\r\n                    Paths.get(\"F:\\\\JAVA\\\\20231010\\\\LeetCode\\\\src\\\\main\\\\java\\\\tries\\\\stream\\\\data.txt\"),\r\n                    Charset.defaultCharset());\r\n            fileStream.forEach(System.out::println);\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void createFunction() {\r\n        Stream<Integer> iterateStream = Stream.iterate(0, n -> n + 2).limit(5);\r\n        iterateStream.forEach(System.out::println);\r\n\r\n        Stream<Double> generateStream = Stream.generate(Math::random).limit(5);\r\n        generateStream.forEach(System.out::println);\r\n    }\r\n\r\n    List strings = Arrays.asList(\"abc\", \"\", \"bc\", \"efg\", \"abcd\",\"\", \"jkl\");\r\n    List repeated = Arrays.asList(\"abc\", \"abc\");\r\n    List disordered = Arrays.asList(\"f\", \"a\");\r\n    List<Integer> numbers = Arrays.asList(1, 99, 3, 30, -20);\r\n\r\n    //filter map distinct sorted flatMap peek limit skip\r\n    @Test\r\n    public void normalMethod() {\r\n        System.out.println(strings.stream().filter(string -> !string.equals(\"\")).collect(Collectors.toList()));\r\n        System.out.println(strings.stream().map(str -> str + \"-itcast\").collect(Collectors.toList()));\r\n        System.out.println(repeated.stream().distinct().collect(Collectors.toList()));\r\n        System.out.println(disordered.stream().sorted().collect(Collectors.toList()));\r\n        System.out.println(numbers.stream().peek(System.out::println));\r\n        System.out.println(strings.stream().limit(3).collect(Collectors.toList()));\r\n        System.out.println(strings.stream().skip(3).collect(Collectors.toList()));\r\n        int sum = numbers.stream().reduce(0, (a, b) -> a + b);\r\n        System.out.println(\"Sum of numbers: \" + sum);\r\n        System.out.println(numbers.stream().anyMatch(number -> number % 2 == 0));\r\n    }\r\n\r\n    @Test\r\n    public void streamCompareAndUse() {\r\n        String[] intArr = {\"1-1\", \"2-1\", \"3-1\", \"4-1\", \"5-1\"};\r\n        List arrayStream = Arrays.asList(intArr);\r\n        System.out.println(arrayStream.stream().map(number -> Stream.of(number.toString().split(\"-\")).collect(Collectors.toList())).collect(Collectors.toList()));\r\n        System.out.println(arrayStream.stream().flatMap(number -> Stream.of(number.toString().split(\"-\"))).collect(Collectors.toList()));\r\n\r\n        Stream<String> lines = null;\r\n        try {\r\n            lines = Files.lines(Paths.get(\"F:\\\\JAVA\\\\20231010\\\\LeetCode\\\\src\\\\main\\\\java\\\\tries\\\\stream\\\\passage.txt\"),\r\n                    StandardCharsets.UTF_8);\r\n            Stream<String> words = lines.flatMap(line -> Stream.of(line.split(\" +\")));\r\n            System.out.println(words.collect(Collectors.toList()));\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n    }\r\n\r\n    @Test\r\n    public void streamMultiThread() {\r\n        List<Integer> list = Arrays.asList(1, 2, 3, 99);\r\n        // é€šè¿‡List æ¥å£ ç›´æ¥è·å–å¹¶è¡Œæµ\r\n        Stream<Integer> integerStream = list.parallelStream();\r\n        // å°†å·²æœ‰çš„ä¸²è¡Œæµè½¬æ¢ä¸ºå¹¶è¡Œæµ\r\n        Stream<Integer> parallel = Stream.of(1, 2, 3).parallel();\r\n        parallel = integerStream;\r\n\r\n        Object obj = new Object();\r\n        Vector v = new Vector();\r\n        List<Integer> syncronizedList = Collections.synchronizedList(new ArrayList<>(v)); //ç›¸å½“äºçº¿ç¨‹å®‰å…¨åœ°æ·»åŠ äº†\r\n        System.out.println(parallel // å°†æµè½¬æ¢ä¸ºå¹¶å‘æµï¼ŒStreamå¤„ç†çš„æ—¶å€™å°±ä¼šé€šè¿‡å¤šçº¿ç¨‹å¤„ç†\r\n                .filter(s -> {\r\n                    syncronizedList.add(s);\r\n                    synchronized (obj) {\r\n                        System.out.println(Thread.currentThread() + \" s=\" + s);\r\n                        v.add(s);\r\n                        return s > 2;\r\n                    }\r\n                }).count());\r\n        System.out.println(v);\r\n        System.out.println(syncronizedList);\r\n\r\n        System.out.println(IntStream.rangeClosed(1, 100)\r\n                .parallel()\r\n                .boxed()\r\n                .collect(Collectors.toList())); //è¿™æ ·å¹¶è¡Œæµä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„\r\n\r\n    }\r\n\r\n    @Test\r\n    public void collectorAndDBDataProcessing() {\r\n        User user = new User(1, \"name1\", \"description\", 20);\r\n        System.out.println(user.getAge());\r\n        User user0 = new User(1, \"name2\", \"description\", 16);\r\n\r\n        ArrayList<User> givenList = new ArrayList();\r\n        givenList.add(user);\r\n        givenList.add(user0);\r\n\r\n        System.out.println(givenList.stream().map(User::getName).collect(Collectors.toSet()));\r\n        System.out.println(givenList.stream().map(User::getDscrip).collect(Collectors.toList()));\r\n        System.out.println(givenList.stream().map(User::getNo).collect(toCollection(LinkedList::new)).toString());\r\n\r\n        System.out.println(givenList.stream().collect(toMap(User::getName, User::getDscrip)));\r\n        System.out.println(givenList.stream().collect(toMap(User::getNo, User::getDscrip, (item, identicalItem) -> item))); //é¿å…ç¢°æ’\r\n\r\n        givenList.stream().map(User::getNo).collect(Collectors.collectingAndThen(\r\n                        Collectors.toList(), list -> {System.out.println(list); return null;}));\r\n\r\n        System.out.println(givenList.stream().map(User::getName).collect(joining(\" \", \"[ \", \" ]\")));\r\n\r\n        // data comparing\r\n        System.out.println(\"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\");\r\n        System.out.println(givenList.stream().collect(summarizingDouble(User::getNo)));\r\n        System.out.println(givenList.stream().collect(averagingDouble(User::getNo)));\r\n        System.out.println(givenList.stream().collect(summingDouble(User::getNo)));\r\n        System.out.println(givenList.stream().map(User::getAge).collect(maxBy(Comparator.naturalOrder())));\r\n        System.out.println(givenList.stream().map(User::getAge).collect(minBy(Comparator.naturalOrder())));\r\n        System.out.println(givenList.stream().collect(groupingBy(User::getNo, Collectors.mapping(User::getName, Collectors.toSet()))));\r\n\r\n        System.out.println(givenList.stream().collect(partitioningBy(usr -> usr.getAge() > 18, Collectors.mapping(User::getAge, Collectors.toList()))));\r\n\r\n\r\n    }\r\n\r\n}\r\n\r\n```\r\n\r\n\r\n#### vueæ–‡æ¡£åŠå“åº”å¼çŠ¶æ€å˜é‡\r\n- <https://vuejs.org/guide/quick-start.html#local>\r\n```\r\n<script setup>\r\nimport { ref,reactive } from \'vue\'\r\n\r\ndefineProps({\r\n  msg: String,\r\n})\r\n//æ•°ç»„\r\nconst tableList = ref([])\r\n//å˜é‡\r\nconst state = reactive({\r\n    form:{\r\n        id: undefined,\r\n        name: undefined\r\n    }\r\n})\r\nconsole.log(state)\r\nfunction addInfo() { //åˆ—è¡¨æ¸²æŸ“\r\n    //1.ä½¿ç”¨ å¯¹è±¡å…‹éš†    æµ…å…‹éš† å’Œ æ·±å…‹éš†\r\n    //æµ…å…‹éš†\r\n    // Object.clone() //js Object clone\r\n    const newObj = Object.assign({}, state.form) //é‡æ–°åˆ†é…ç©ºé—´ target , origin\r\n    //æ·±å…‹éš† åºåˆ—åŒ–å’Œååºåˆ—åŒ–\r\n    const str=JSON.stringify(state.form) //åºåˆ—åŒ–\r\n    const newObject1=JSON.parse(str) //ååºåˆ—åŒ–\r\n\r\n    tableList.value.push(newObj) //æ•°ç»„è¿½åŠ å€¼  æ·»åŠ çš„æ˜¯å¼•ç”¨å¯¹è±¡ åé¢ä¼šå½±å“\r\n\r\n    // æ¸…ç©º\r\n    state.form.id = undefined\r\n    state.form.name = undefined\r\n}\r\nconst addInfo0 = () => {\r\n    console.log(\"loading\")\r\n}\r\nfunction removeInfo(index) {\r\n    console.log(index)\r\n    tableList.value.splice(index, 1)\r\n}\r\nconst count = ref(0)\r\n</script>\r\n\r\n<template>\r\n    <!--<div>{{ msg }}</div>-->\r\n    <div class = \"left\">\r\n        <table width=100% border=\"1\">\r\n            <tr>\r\n                <td>å­¦å·</td>\r\n                <td>å§“å</td>\r\n                <td>æ“ä½œ</td>\r\n            </tr>\r\n            <tr v-for=\"(item, index) in tableList\">\r\n                <td>{{item.id}}</td>\r\n                <td>{{item.name}}</td>\r\n                <td><input type=\"button\" value=\"åˆ é™¤\" @click=\"removeInfo(index)\"></td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n\r\n    <div class=\"right\">\r\n        å­¦å·ï¼š<input type=\"text\" v-model = \'state.form.id\'>\r\n        å§“åï¼š<input type=\"text\" v-model = \'state.form.name\'>\r\n        <input type=\"button\" value=\"ä¿å­˜\" @click=\"addInfo\">\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n.left {\r\n    width: 480px;\r\n    border: 1px solid red float;\r\n    float:left;\r\n}\r\n.right {\r\n    width: 480px;\r\n    border: 1px solid red float;\r\n    float:right;\r\n}\r\n</style>\r\n```', '2024-05-22 20:11:11'),(7, 1, 'Elasticsearch', '## Elasticsearch\r\n### ä¸‹è½½\r\n<https://www.elastic.co/downloads/elasticsearch>\r\n\r\n### æ–‡æ¡£\r\n<https://www.elastic.co/guide/en/elasticsearch/reference/8.11/setup.html>\r\n    \r\n### å¯åŠ¨\r\n1. å°†binç›®å½•åŠ å…¥ç¯å¢ƒå˜é‡\r\n2. æ‰§è¡Œ `elasticsearch.bat`\r\n> å¦‚æœé‡åˆ°jdkæ‰¾ä¸åˆ°\r\n```\r\nhjava.nio.file.NoSuchFileException: F:\\jdk1.8.0_201\\lib\\tools.jar\r\n```\r\n> å°†jdkå¤åˆ¶åˆ°æ‰€æ˜¾ç¤ºç›®å½•\r\n\r\n> The system environment variable ES_JAVA_HOME should be set to the path of the JDK installation that you want the service to use. \r\n\r\n### windowså®‰è£…æœåŠ¡å¹¶å¯åŠ¨\r\n```\r\nC:\\Users\\AJH41>elasticsearch-service.bat install\r\nC:\\Users\\AJH41>elasticsearch-service.bat start\r\nUsage: elasticsearch-service.bat install|remove|start|stop|manager\r\n```\r\n\r\n### é»˜è®¤è®¿é—®ç½‘å€\r\n<https://192.168.17.2:9200>  æˆ–è€…\r\n<https://localhost:9200>  \r\n- å…·ä½“æŸ¥çœ‹[logsç›®å½•ä¸‹çš„]æ—¥å¿—\r\n\r\n### æ·»åŠ ç”¨æˆ·åŠæƒé™\r\n```\r\nC:\\Users\\AJH41>elasticsearch-users useradd admin\r\n```\r\nconfig/roles.yum  \r\n```\r\nadmin_role:\r\n  cluster: [\"monitor\", \"manage\"]\r\n  indices:\r\n    - names: [\"*\"]\r\n      privileges: [\"all\"]\r\n```\r\nconfig/users_roles  \r\n```\r\nadmin_role:admin\r\n```\r\n\r\n### å¯¼å…¥æ•°æ®\r\n- ä½¿ç”¨Logstash\r\n<https://www.elastic.co/downloads/logstash>\r\n\r\n- å…³é—­elasticsearch ssl åŠ ç”¨æˆ·åï¼Œå¯†ç éªŒè¯\r\n/config/elasticsearch.yml\r\nä¿®æ”¹ä»¥ä¸‹æ¡ç›®\r\n```\r\nxpack.security.enabled: false\r\nxpack.security.enrollment.enabled: false\r\nxpack.security.http.ssl.enabled: false\r\nxpack.security.transport.ssl.enabled: false\r\n```\r\n<https://blog.csdn.net/qq_43080270/article/details/105970462> # å®‰è£…ElasticSearch-Headæ’ä»¶  \r\n- å¯åŠ¨elasticsearchçš„ç£ç›˜éœ€è¦ç•™æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œå¦åˆ™clusterçš„å¥åº·åº¦ä¼šçˆ†çº¢\r\n  - å¯åŠ¨å‘½ä»¤ï¼šnpm run start\r\n  - å¥åº·åº¦é”™è¯¯è¯¦æƒ…ã€åˆ†ç‰‡æ•…éšœåˆ†æåŸå› ã€‘å¯ä»¥é€šè¿‡æ’ä»¶9100ç«¯å£é¡µé¢çš„Any query: GET _cluster/allocation/explainæŸ¥çœ‹  \r\n- ä»elasticsearch->logstash->kabana(é€šè¿‡nsmnçš„windowsæœåŠ¡æ­å»º)[å¤‡ç”¨]:<https://community.spiceworks.com/how_to/164166-installing-elk-7-elasticsearch-logstash-and-kibana-windows-server-2016-part-1>  \r\n- ç£ç›˜å¥åº·é˜ˆå€¼è®¾ç½®ï¼š<https://blog.csdn.net/gxb2260/article/details/129108795>   \r\n\r\nlogstashæ ¹ç›®å½•/logstash.conf\r\n```\r\ninput {\r\n  jdbc {\r\n    jdbc_driver_library => \"G:\\\\Downloads\\\\mysql-connector-java-8.0.30.jar\"\r\n    jdbc_driver_class => \"com.mysql.jdbc.Driver\"\r\n    jdbc_connection_string => \"jdbc:mysql://localhost:3306/manage\"\r\n    jdbc_user => \"root\"\r\n    jdbc_password => \"123456\"\r\n    schedule => \"* * * * *\"\r\n    statement => \"SELECT * FROM product#\"\r\n  }\r\n}\r\n\r\noutput {\r\n  elasticsearch {\r\n    hosts => [\"http://127.0.0.1:9200\"]\r\n    index => \"myindex\"\r\n    user => \"admin\"\r\n    password => \"123456\"\r\n  }\r\n}\r\n```\r\nwindows shell:[binç›®å½•ä¸‹æ‰§è¡Œæˆ–è®¾ç½®ç¯å¢ƒå˜é‡]\r\n```\r\nlogstash -f logstash.conf\r\n```\r\néªŒè¯æ˜¯å¦å¯¼å…¥æˆåŠŸ\r\n> elastic-headæ’ä»¶<http://localhost:9100/> -> structed query -> é€‰æ‹©[myindex] [json]æŸ¥çœ‹ç»“æœ  \r\n\r\n### é€šè¿‡javaè¯»å–æ•°æ®\r\nmaven\r\n```\r\n<dependency>\r\n  <groupId>org.elasticsearch.client</groupId>\r\n  <artifactId>elasticsearch-rest-client</artifactId>\r\n  <version>8.11.1</version>\r\n</dependency>\r\n```\r\nè¯»å–æ•°æ®\r\n```\r\n@Test\r\n    public void test() {\r\n        // åˆ›å»º Elasticsearch REST å®¢æˆ·ç«¯è¿æ¥\r\n        RestClient restClient = RestClient.builder(\r\n                        new HttpHost(\"localhost\", 9200, \"http\"))\r\n                .build();\r\n\r\n// å‘é€ GET è¯·æ±‚æŸ¥è¯¢æ•°æ®\r\n        try {\r\n            // æ„å»ºæŸ¥è¯¢è¯·æ±‚\r\n            Request request = new Request(\"GET\", \"/myindex/_search\");\r\n            // æ›¿æ¢ \"your_index\" ä¸ºä½ è¦æŸ¥è¯¢çš„ç´¢å¼•åç§°\r\n\r\n            // æ·»åŠ è¯·æ±‚ä½“ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\r\n            // request.setJsonEntity(\"{ \\\"query\\\": { \\\"match_all\\\": {} } }\");\r\n\r\n            // å‘é€è¯·æ±‚å¹¶è·å–å“åº”\r\n            Response response = restClient.performRequest(request);\r\n\r\n            // å¤„ç†å“åº”ç»“æœ\r\n            // è¾“å‡ºå“åº”å†…å®¹\r\n//            System.out.println(\"Response Status: \" + response.getStatusLine());\r\n            System.out.println(\"Response Body: \" + EntityUtils.toString(response.getEntity()));\r\n\r\n            // å…³é—­ REST å®¢æˆ·ç«¯è¿æ¥\r\n            restClient.close();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n```', '2024-05-22 20:11:25'),(8, 1, 'Flowableæµç¨‹å¼•æ“', '## Flowableæµç¨‹å¼•æ“\r\n### å¿«é€Ÿå¼€å§‹\r\n<https://www.flowable.com/open-source/docs/bpmn/ch02-GettingStarted>\r\n```\r\nProcessEngineConfiguration cfg = new StandaloneProcessEngineConfiguration()\r\n.setJdbcUrl(\"jdbc:h2:mem:flowable;DB_CLOSE_DELAY=-1\")\r\n.setJdbcUsername(\"sa\")\r\n.setJdbcPassword(\"\")\r\n.setJdbcDriver(\"org.h2.Driver\")\r\n.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);\r\n\r\nProcessEngine processEngine = cfg.buildProcessEngine();\r\n```\r\n\r\n### å¯¹xmlçš„åº”ç”¨\r\n<https://paulhh.wordpress.com/2017/01/31/flowable-6-instant-gratification/>\r\n- modelerå¯ä»¥å¯¼å…¥xmlæ–‡ä»¶\r\n> ä¾‹å¦‚\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<definitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\r\n             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n             xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\r\n             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\r\n             xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\"\r\n             xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\"\r\n             xmlns:flowable=\"http://flowable.org/bpmn\"\r\n             typeLanguage=\"http://www.w3.org/2001/XMLSchema\"\r\n             expressionLanguage=\"http://www.w3.org/1999/XPath\"\r\n             targetNamespace=\"http://www.flowable.org/processdef\">\r\n\r\n    <process id=\"holidayRequest\" name=\"Holiday Request\" isExecutable=\"true\">\r\n\r\n        <startEvent id=\"startEvent\"/>\r\n        <sequenceFlow sourceRef=\"startEvent\" targetRef=\"approveTask\"/>\r\n\r\n        <userTask id=\"approveTask\" name=\"Approve or reject request\"/>\r\n        <sequenceFlow sourceRef=\"approveTask\" targetRef=\"decision\"/>\r\n\r\n        <exclusiveGateway id=\"decision\"/>\r\n        <sequenceFlow sourceRef=\"decision\" targetRef=\"externalSystemCall\">\r\n            <conditionExpression xsi:type=\"tFormalExpression\">\r\n                <![CDATA[\r\n          ${approved}\r\n        ]]>\r\n            </conditionExpression>\r\n        </sequenceFlow>\r\n        <sequenceFlow  sourceRef=\"decision\" targetRef=\"sendRejectionMail\">\r\n            <conditionExpression xsi:type=\"tFormalExpression\">\r\n                <![CDATA[\r\n          ${!approved}\r\n        ]]>\r\n            </conditionExpression>\r\n        </sequenceFlow>\r\n\r\n        <serviceTask id=\"externalSystemCall\" name=\"Enter holidays in external system\"\r\n                     flowable:class=\"org.flowable.CallExternalSystemDelegate\"/>\r\n        <sequenceFlow sourceRef=\"externalSystemCall\" targetRef=\"holidayApprovedTask\"/>\r\n\r\n        <userTask id=\"holidayApprovedTask\" name=\"Holiday approved\"/>\r\n        <sequenceFlow sourceRef=\"holidayApprovedTask\" targetRef=\"approveEnd\"/>\r\n\r\n        <serviceTask id=\"sendRejectionMail\" name=\"Send out rejection email\"\r\n                     flowable:class=\"org.flowable.SendRejectionMail\"/>\r\n        <sequenceFlow sourceRef=\"sendRejectionMail\" targetRef=\"rejectEnd\"/>\r\n\r\n        <endEvent id=\"approveEnd\"/>\r\n\r\n        <endEvent id=\"rejectEnd\"/>\r\n\r\n    </process>\r\n\r\n</definitions>\r\n```\r\nå¯ä»¥è½¬åŒ–ä¸ºï¼š\r\n<img alt=\"flowableè½¬æ¢\" src=\"http://mail.hampster.work:9000/online/hampster/java/flowable/image.png\" width=\"100%\"/>\r\n', '2025-01-10 11:58:31'),(9, 1, 'Mybatis-pool', '\r\n## MYBATIS-POOL\r\n> å‚è€ƒï¼šæ–‡å¿ƒä¸€è¨€ è®¯é£æ˜Ÿç« chatGPT MYBATISç™½çš®ä¹¦ gamma.app(bilibili)\r\n\r\n[https://www.tutorialspoint.com/mybatis/mybatis_annotations.htm](https://www.tutorialspoint.com/mybatis/mybatis_annotations.htm)<br/>\r\n<a href=\"https://blog.csdn.net/weixin_51725434/article/details/128396111\">https://blog.csdn.net/weixin_51725434/article/details/128396111</a><br/>\r\n<a href=\"https://howtodoinjava.com/log4j2/log4j2-properties-example/\">https://howtodoinjava.com/log4j2/log4j2-properties-example/</a><br/>\r\nspring transaction:<br/>\r\n <a href=\"https://www.digitalocean.com/community/tutorials/spring-transaction-management-jdbc-example\">https://www.digitalocean.com/community/tutorials/spring-transaction-management-jdbc-example</a><br/>\r\n<a href=\"https://blog.csdn.net/xcnaabb/article/details/130102571\">https://blog.csdn.net/xcnaabb/article/details/130102571</a><br/>\r\nmapper SQL process: <br/>\r\n<a href=\"https://blog.csdn.net/weixin_44451022/article/details/128641020\">https://blog.csdn.net/weixin_44451022/article/details/128641020</a><br/>\r\nsource Code: <br/>\r\n<a href=\"https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/transaction/SpringManagedTransactionFactory.java\">https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/transaction/SpringManagedTransactionFactory.java</a><br/>\r\nå¾·é²ä¼Šï¼š<br/>\r\n<a href=\"https://blog.csdn.net/qq_15204179/article/details/83050229\">https://blog.csdn.net/qq_15204179/article/details/83050229</a><br/>\r\n\r\n</a>\r\n\r\n</span>\r\n\r\n<h3>æ•°æ®åº“æ“ä½œï¼šmybatisä¸­å®ç°æ•°æ®åº“å¢åˆ æŸ¥æ”¹çš„mapperä¸€å…±æœ‰ä¸‰ç§æ–¹å¼</h3>\r\n\r\n1.é€šè¿‡xmlæ–¹å¼\r\nè¿™æ˜¯æœ€å¸¸è§çš„æ–¹å¼ï¼Œå…¶ä¸­ Mapper æ¥å£çš„ SQL æ˜ å°„è§„åˆ™è¢«å®šä¹‰åœ¨ XML æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ª XML æ–‡ä»¶é€šå¸¸ä»¥ \".xml\" ä¸ºåç¼€åã€‚æ‚¨å¯ä»¥é€šè¿‡ `&lt;mapper&gt;` å…ƒç´ çš„ `resource` å±æ€§æ¥å¼•å…¥ XML Mapper æ–‡ä»¶ã€‚<br/>\r\n\r\n2.é€šè¿‡æ³¨è§£çš„æ–¹å¼\r\nå¯ä»¥ä½¿ç”¨æ³¨è§£æ–¹å¼æ¥å®šä¹‰ SQL æ˜ å°„è§„åˆ™ã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæ‚¨åœ¨ Mapper æ¥å£çš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£æ¥æŒ‡å®š SQL æŸ¥è¯¢ã€‚è¿™ç§æ–¹å¼é€šå¸¸æ¯”è¾ƒç®€æ´ï¼Œä½†ä¸å¦‚ XML é…ç½®æ–‡ä»¶çµæ´»ã€‚<br/>\r\n\r\n3.é€šè¿‡å®ç°æ¥å£ç»“åˆxmlçš„æ–¹å¼\r\nè¯¥æ¥å£ï¼Œç”¨äºå®šä¹‰ä¸æ•°æ®åº“äº¤äº’çš„ SQL æ–¹æ³•ã€‚è¿™äº›æ¥å£é€šå¸¸æ²¡æœ‰å®ç°ç±»ï¼Œä½†æ˜¯ MyBatis åœ¨è¿è¡Œæ—¶ä¼šç”Ÿæˆä»£ç†ç±»æ¥å®ç°è¿™äº›æ¥å£çš„æ–¹æ³•ã€‚Mapper æ¥å£çš„æ–¹æ³•åå’Œå‚æ•°ä¸ SQL æŸ¥è¯¢çš„é…ç½®ç›¸å…³è”ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º \"Mapper æ¥å£æ–¹å¼\"ã€‚<br/>\r\n\r\n<h4>1. mybatiså¢åˆ æŸ¥æ”¹:é€šè¿‡xmlæ–¹å¼</h4>\r\n\r\n</div>\r\n\r\n##### Mapper.xmlæ–‡ä»¶\r\n\r\n```\r\n\r\n<!DOCTYPE mapper\r\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\r\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\r\n<mapper namespace=\"com.hyh.dao.TestDao\">\r\n    <!--æŸ¥è¯¢-->\r\n    <resultMap type=\"com.hyh.pojo.User\" id=\"userSet\">\r\n        <id column=\"id\" property=\"id\"/>\r\n        <result column=\"name\" property=\"name\"/>\r\n        <result column=\"sex\" property=\"sex\"/>\r\n        <result column=\"age\" property=\"age\"/>\r\n    </resultMap>\r\n    <!--é€šè¿‡idæŸ¥è¯¢-->\r\n    <select id=\"selectUser\" parameterType = \"int\" resultType=\"com.hyh.pojo.User\">\r\n        select * from mybatis_user where id = #{id}\r\n    </select>\r\n    <!--æŸ¥è¯¢æ‰€æœ‰-->\r\n    <select id = \"getAll\" resultMap = \"userSet\">\r\n        SELECT * FROM mybatis_user\r\n    </select>\r\n\r\n    <!--æ’å…¥-->\r\n    <insert id=\"insert\"> <!--å¯èƒ½æ˜¯databaseIdæ²¡æœ‰æ£€æµ‹åˆ°-->\r\n        <selectKey keyProperty=\"id\" resultType=\"int\" order=\"BEFORE\">\r\n            <if test=\"_databaseId == \'oracle\'\"> <!--å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®åº“åšå‡ºä¸åŒå“åº”-->\r\n                select mybatis_seq.nextVal from dual\r\n            </if>\r\n        </selectKey>\r\n        insert into mybatis_user values (#{id}, #{name}, #{sex}, #{age})\r\n    </insert>\r\n\r\n    <!--æ›´æ–°-->\r\n    <update id=\"update\">\r\n        update mybatis_user\r\n        <set>\r\n            <if test=\"name != null\">name=#{name},</if>\r\n            <if test=\"sex != null\">sex=#{sex},</if>\r\n            <if test=\"age != null\">age=#{age}</if>\r\n        </set>\r\n        where id=#{id}\r\n    </update>\r\n\r\n    <!--åˆ é™¤-->\r\n    <delete id=\"delete\"\r\n            parameterType=\"com.hyh.pojo.User\"\r\n            flushCache=\"true\"\r\n            statementType=\"PREPARED\"\r\n            timeout=\"20\">\r\n    <!--ä»¥ä¸Šå‚æ•°å‡ä¸ºå¯é€‰å‚æ•°ï¼Œå¯ä»¥ä¸å†™ï¼Œå‚æ•°ä¸ºï¼šid, è¿”å›ç±»å‹ï¼Œæ˜¯å¦æ¸…ç©ºç¼“å­˜ï¼Œprepared statement/static statement, è¶…æ—¶æ—¶é™-->\r\n        delete from mybatis_user where id = #{id}\r\n    </delete>\r\n\r\n</mapper>\r\n\r\n\r\n```\r\n\r\n#### mybatisé…ç½®æ–‡ä»¶\r\n\r\n##### propertyæ–‡ä»¶è®¾ç½®\r\n\r\n- åˆ©ç”¨resourceå±æ€§æ·»åŠ æ–‡ä»¶å\r\n\r\n- åˆ©ç”¨property name=\"\" value=\'\'å­é¡¹ï¼Œæ·»åŠ å±æ€§</pre>\r\n\r\n```\r\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n<!DOCTYPE configuration\r\n        PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\r\n        \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\r\n<configuration>\r\n    <properties resource=\"db.properties\">\r\n        <property name=\"username\" value=\"dev_user\"/>\r\n        <property name=\"password\" value=\"F2Fa3!33TYyg\"/>\r\n    </properties>\r\n    <environments default=\"development\">\r\n        <environment id=\"development\">\r\n            <transactionManager type=\"JDBC\"/>\r\n            <dataSource type=\"POOLED\">\r\n                <property name=\"driver\" value=\"${oracle_driver}\"/>\r\n                <property name=\"url\" value=\"${oracle_url}\"/>\r\n                <property name=\"username\" value=\"${oracle_username}\"/>\r\n                <property name=\"password\" value=\"${oracle_password}\"/>\r\n            </dataSource>\r\n        </environment>\r\n    </environments>\r\n    <mappers>\r\n        <mapper resource=\"com\\hyh\\mapper\\TestMapper.xml\"/> <!--æ ¹æ®ä¸åŒçš„mapperæœ‰ä¸åŒçš„ç¼–å†™å’Œç»“æ„-->\r\n    </mappers>\r\n</configuration>\r\n```\r\n\r\n##### æµ‹è¯•æ–‡ä»¶\r\n\r\n```\r\n   public SqlSessionFactory giveFactory() { //å¯ç”¨mybatisé…ç½®æ–‡ä»¶\r\n        SqlSessionFactory factory = null;\r\n        try { // 2.1.2 Building SqlSessionFactory from XML\r\n            InputStream inputStream = Resources.getResourceAsStream(\"mybatis-config.xml\");\r\n            factory = new SqlSessionFactoryBuilder().build(inputStream);\r\n            inputStream.close();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n        System.out.println(factory.getConfiguration().getDatabaseId());\r\n\r\n        return factory;\r\n    }\r\n\r\n    public void XMLSelect(SqlSession sqlSession) { //æŸ¥æ‰¾\r\n        System.out.println(\"XMLSelect\");\r\n        List<User> users = sqlSession.selectList(\"com.hyh.dao.TestDao.getAll\");\r\n        User user = sqlSession.selectOne(\"com.hyh.dao.TestDao.selectUser\", 1);\r\n\r\n        System.out.println(users);\r\n        System.out.println(user);\r\n    }\r\n\r\n    @Test\r\n    public void buildForXML() {\r\n        System.out.println(\"============Test buildForXML==============\");\r\n\r\n        SqlSessionFactory factory = giveFactory();\r\n\r\n        try (SqlSession sqlSession = factory.openSession()) {\r\n            factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n            System.out.println(factory.getConfiguration().getDatabaseId());\r\n\r\n            XMLSelect(sqlSession);\r\n\r\n            User userInserted = new User(2, \"WWW\", \"W\", 10); //æ·»åŠ \r\n            int bo = sqlSession.insert(\"com.hyh.dao.TestDao.insert\", userInserted);\r\n\r\n            User userUpdated = new User(3, \"xxxpoipioip\", \"op\", 9); //ä¿®æ”¹\r\n            int boo = sqlSession.update(\"com.hyh.dao.TestDao.update\", userUpdated);\r\n\r\n            int fii = sqlSession.delete(\"com.hyh.dao.TestDao.delete\", 1); //åˆ é™¤\r\n            User userDeleted = new User(3, \"WWW\", \"W\", 10);\r\n            int fiii = sqlSession.delete(\"com.hyh.dao.TestDao.deleteObject\", userDeleted);\r\n\r\n            System.out.println(\"others\");\r\n            System.out.println(bo);\r\n            System.out.println(boo);\r\n            System.out.println(fii);\r\n            System.out.println(fiii);\r\n\r\n            sqlSession.commit(); //!!!!!!æäº¤\r\n        }\r\n```\r\n\r\n#### 2. mybatiså¢åˆ æŸ¥æ”¹:é€šè¿‡æ³¨è§£æ–¹å¼\r\n\r\nä½¿ç”¨åŒ…ï¼š<br>\r\n\r\nå› ä¸ºä¹‹å‰å·²ç»è½½å…¥äº†å¾ˆå¤šå…¶å®ƒçš„åŒ…ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨mavenï¼ŒåŒ…çš„æœç´¢ç½‘å€ä¸ºï¼š<a href=\"https://search.maven.org/search\">https://search.maven.org/search</a>\r\n<!--  spring-dao<br>-->\r\n\r\nspring-orm: ç”¨äºå°†å¯¹è±¡æ¨¡å‹ä¸å…³ç³»æ•°æ®åº“ä¹‹é—´çš„æ•°æ®è¿›è¡Œæ˜ å°„å’Œè½¬æ¢ï¼Œè§£å†³å®ƒä»¬ä¹‹é—´æ•°æ®è¡¨ç¤ºä¸åŒ¹é…çš„é—®é¢˜ï¼Œå…·æœ‰sqlè¯­è¨€å¯¹è±¡åŒ–ï¼Œè‡ªåŠ¨åŒ–æ•°æ®è®¿é—®ï¼Œå¤šæ•°æ®åº“æ”¯æŒï¼Œç®€åŒ–ä»£ç æé«˜æ•ˆç‡çš„ç‰¹ç‚¹<br>\r\n\r\n> mybatis-spring<br>\r\n> mybatis<br>\r\n> ojdbc8\r\n\r\n\r\n##### annotation Interface\r\n\r\n```\r\n@Mapper\r\npublic interface TestMapperAnnotation {\r\n\r\n    @Select(\"select * from mybatis_user where id = #{id}\")\r\n    User getUserById(int id);\r\n\r\n    @Delete(\"delete from mybatis_user where id = #{id}\")\r\n    int deleteUserById(int id);\r\n\r\n    @Insert(\"insert into mybatis_user values (#{id}, #{name}, #{sex}, #{age})\") //å¤šä¸ªå‚æ•°è¦ç”¨@Paramæ¥åŒºåˆ†\r\n    int insertUserByObject(@Param(\"id\") int id, @Param(\"name\") String name, @Param(\"sex\") String sex, @Param(\"age\") int age);\r\n\r\n    @Update(\"update mybatis_user set name=#{name}, sex=#{sex}, age=#{age} where id=#{id}\")\r\n    int updateByObject(@Param(\"id\") int id, @Param(\"name\") String name, @Param(\"sex\") String sex, @Param(\"age\") int age);\r\n}\r\n```\r\n\r\n##### æµ‹è¯•\r\n\r\n```\r\n    @Test\r\n    public void buildForAnnotation() {\r\n        System.out.println(\"============Test buildForAnnotation=============\");\r\n        SqlSessionFactory factory = giveFactory();\r\n\r\n        try (SqlSession session = factory.openSession()) {\r\n            session.getConfiguration().addMapper(TestMapperAnnotation.class);\r\n\r\n            TestMapperAnnotation mapper = session.getMapper(TestMapperAnnotation.class);\r\n            System.out.println(mapper.getUserById(51));\r\n            System.out.println(mapper.deleteUserById(51));\r\n            System.out.println(mapper.insertUserByObject(1000, \"asdf\", \"ew\", 0));\r\n            System.out.println(mapper.updateByObject(1000, \"mmm\", \"ooo\", 999));\r\n\r\n            session.commit();\r\n        }\r\n    }\r\n```\r\n\r\n#### 3. mybatiså¢åˆ æŸ¥æ”¹ï¼šé€šè¿‡æ¥å£ç»“åˆxmlæ–‡ä»¶çš„æ–¹å¼</h4>\r\n\r\n- mapperæ¥å£çš„å…¨ç±»åå’Œæ˜ å°„æ–‡ä»¶çš„å‘½åç©ºé—´(namespace)ä¿æŒä¸€è‡´\r\n\r\n- mapperæ¥å£ä¸­æ–¹æ³•çš„æ–¹æ³•åå’Œæ˜ å°„æ–‡ä»¶ä¸­ç¼–å†™SQLçš„æ ‡ç­¾çš„idå±æ€§ä¿æŒä¸€è‡´\r\n\r\nä¸­é€”é‡åˆ°çš„é—®é¢˜ï¼šoutæ–‡ä»¶å¤¹çš„å†…å®¹æ²¡æœ‰è·Ÿç€æ›´æ–°éœ€è¦æ‰‹åŠ¨å¤åˆ¶è¿›å»/outæ–‡ä»¶å¤¹æ²¡æœ‰.classæ–‡ä»¶ï¼Œåˆ é™¤outé‡æ–°ç”Ÿæˆ ---ç¼–è¯‘å™¨IDEA<br>\r\n\r\næ²¡æœ‰è®¾ç½®æ•°æ®åº“åç§°(æµ‹è¯•æ–¹æ³•æ•ˆç‡ä¸é«˜)<br>\r\n\r\næ¥å£æ–‡ä»¶\r\n\r\n```\r\nimport com.hyh.pojo.User;\r\nimport org.apache.ibatis.annotations.Param;\r\n\r\nimport java.util.List;\r\n\r\npublic interface TestMapperInterface {\r\n    User selectUser(@Param(\"id\") int id); //ä¸€æ¥å£æ–¹å¼å®ç°çš„å“ªæ€•åªæœ‰ä¸€ä¸ªå˜é‡ä¹Ÿè¦å£°æ˜@Param\r\n    List<User> getAll();\r\n    boolean insert(@Param(\"id\") int id, @Param(\"name\") String name, @Param(\"sex\") String sex, @Param(\"age\") int age);\r\n    boolean update(@Param(\"id\") int id, @Param(\"name\") String name, @Param(\"sex\") String sex, @Param(\"age\") int age);\r\n    boolean delete(@Param(\"id\") int id);\r\n}\r\n```\r\n\r\n<div >mapper.xmlæ–‡ä»¶ä¸ä¸Šä¸€ä¸ªmapperçš„å·®åˆ«</div>\r\n\r\n```\r\n<mapper namespace=\"com.hyh.dao.TestMapperInterface\">\r\n```\r\n\r\n<div >è¾“å‡ºæ–‡ä»¶</div>\r\n\r\n```\r\n    @Test\r\n    public void testForInterfacePlusXML() {\r\n        System.out.println(\"============Test testForInterfacePlusXML=============\");\r\n\r\n        SqlSessionFactory factory = giveFactory();\r\n\r\n        try (SqlSession session = factory.openSession()) {\r\n            factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n            System.out.println(factory.getConfiguration().getDatabaseId());\r\n            //åœ¨xmlé‡Œé¢æ·»åŠ äº†æ¥å£\r\n\r\n            TestMapperInterface tmi = session.getMapper(TestMapperInterface.class);\r\n            System.out.println(\"\" +\r\n            tmi.delete(51) + \" \" +\r\n            tmi.update(45, \"asdf\", \"wee\", 90) + \" \" +\r\n            tmi.insert(23, \"sd\", \"sd\", 88) + \" \" +\r\n                    tmi.getAll() + \" \\n\" +\r\n                    tmi.selectUser(45)\r\n            ); //è¿™é‡ŒæŸ¥æ‰¾çš„æ•°æ®æƒ³è¦æ”¹å˜ä¸­é€”éœ€è¦commit\r\n\r\n            session.commit();\r\n\r\n        }\r\n    }\r\n```\r\n\r\n<div >\r\n\r\n<h3>å¯¹mybatis-config.XMLæ–‡ä»¶çš„è§£é‡Šä¹‹TransactionManager</h3>\r\n\r\nç™½çš®ä¹¦ç¿»è¯‘ï¼ˆCHATGPT + HYHï¼‰P24\r\n\r\n\r\näº‹åŠ¡ç®¡ç†å™¨\r\nMyBatisåŒ…å«ä¸¤ç§äº‹åŠ¡ç®¡ç†å™¨ç±»å‹ï¼ˆå³type=\"[JDBC|MANAGED]\"ï¼‰ï¼š\r\n\r\n- JDBC - è¿™ä¸ªé…ç½®ç®€å•åœ°ç›´æ¥ä½¿ç”¨JDBCçš„æäº¤ï¼ˆcommitï¼‰å’Œå›æ»šï¼ˆrollbackï¼‰åŠŸèƒ½ã€‚å®ƒä¾èµ–äºä»dataSourceè·å–çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡çš„èŒƒå›´ã€‚\r\n- MANAGED - è¿™ä¸ªé…ç½®å‡ ä¹ä»€ä¹ˆéƒ½ä¸åšã€‚å®ƒä¸ä¼šæäº¤æˆ–å›æ»šè¿æ¥ã€‚ç›¸åï¼Œå®ƒä¼šè®©å®¹å™¨ç®¡ç†äº‹åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆä¾‹å¦‚ï¼Œåœ¨JEEåº”ç”¨æœåŠ¡å™¨ä¸Šçš„ä¸Šä¸‹æ–‡ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šå…³é—­è¿æ¥ã€‚ä½†æ˜¯ï¼Œæœ‰äº›å®¹å™¨ä¸å¸Œæœ›è¿™æ ·åšï¼Œå› æ­¤å¦‚æœæ‚¨éœ€è¦é˜»æ­¢å®ƒå…³é—­è¿æ¥ï¼Œè¯·å°†\"closeConnection\"å±æ€§è®¾ç½®ä¸ºfalseã€‚ä¾‹å¦‚ï¼š\r\n	- JEEåº”ç”¨æœåŠ¡å™¨ä¸Šæ˜¯JNDI(Java Naming and Directory Interfaceï¼‰ä¸Šä¸‹æ–‡(context))ï¼Œé€šä¿—åœ°ç†è§£ï¼ŒSpring Webåº”ç”¨ç¨‹åºæ˜¯éƒ¨ç½²åœ¨JEEåº”ç”¨æœåŠ¡å™¨ä¸Šçš„ã€‚\r\n\r\n>ã€æ³¨æ„ã€‘å¦‚æœæ‚¨è®¡åˆ’åœ¨Springä¸­ä½¿ç”¨MyBatisï¼Œå°±ä¸éœ€è¦é…ç½®ä»»ä½•TransactionManagerï¼Œå› ä¸ºSpringæ¨¡å—ä¼šè®¾ç½®è‡ªå·±çš„TransactionManagerï¼Œè¦†ç›–ä»»ä½•ä¹‹å‰è®¾ç½®çš„é…ç½®ã€‚\r\n\r\n- è¿™ä¸¤ç§TransactionManagerç±»å‹éƒ½ä¸éœ€è¦ä»»ä½•å±æ€§é…ç½®ã€‚ç„¶è€Œï¼Œå®ƒä»¬éƒ½æ˜¯ç±»å‹åˆ«åï¼ˆType Aliasesï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„å®Œå…¨é™å®šç±»åæˆ–ç±»å‹åˆ«åæ¥å¼•ç”¨æ‚¨è‡ªå·±å®ç°çš„TransactionFactoryæ¥å£ã€‚\r\n\r\n\r\n<h4>TransactionFactoryæ¥å£</h4>\r\n\r\nsource Code: <a href=\"https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/transaction/SpringManagedTransactionFactory.java\">\r\n\r\n[https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/transaction/SpringManagedTransactionFactory.java](https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/transaction/SpringManagedTransactionFactory.java)\r\n\r\n</a>\r\n\r\n<pre class=\"preText\">\r\n> å¦‚æœè®¾ç½®å¤±è´¥ï¼Œæ£€æŸ¥å¯èƒ½æ˜¯mybatis-config.xmlè·¯å¾„é—®é¢˜ï¼Œå¯èƒ½è¿ç§»äº†é¡¹ç›®ä½†æ˜¯æ²¡æœ‰ä¿®æ”¹å‚æ•°ï¼Œå¯ä»¥è¾“å‡ºæ–‡ä»¶æµæŸ¥çœ‹\r\n\r\n+ ä»¥ä¸‹ä¸ºè‡ªå®šä¹‰æ¥å£å®ç°ï¼š\r\n- mybatis-config.xmlæ–‡ä»¶\r\n</pre>\r\n\r\n</div>\r\n\r\n```\r\n<transactionManager type=\"com.hyh.transaction.impl.TransactionFactoryImpl\">\r\n    <property name=\"autoCommit\" value=\"false\"/>\r\n</transactionManager>\r\n```\r\n\r\n<div >\r\n\r\n<pre class=\"preText\">\r\n- TransactionFactoryæ¥å£å®ç°\r\n</pre>\r\n\r\n</div>\r\n\r\n```\r\nimport org.apache.ibatis.session.TransactionIsolationLevel;\r\nimport org.apache.ibatis.transaction.Transaction;\r\nimport org.apache.ibatis.transaction.TransactionFactory;\r\nimport javax.sql.DataSource;\r\nimport java.sql.Connection;\r\nimport java.util.Properties;\r\n\r\npublic class TransactionFactoryImpl implements TransactionFactory {\r\n\r\n    public boolean autoCommit;\r\n\r\n    public boolean isAutoCommit() {\r\n        return autoCommit;\r\n    }\r\n\r\n    public void setAutoCommit(boolean autoCommit) {\r\n        this.autoCommit = autoCommit;\r\n    }\r\n\r\n    @Override\r\n    public void setProperties(Properties props) {\r\n        TransactionFactory.super.setProperties(props); //å½“å‰ç‰ˆæœ¬3.5.8, 3.5.2ä¹‹åå˜ä¸ºé»˜è®¤æ–¹æ³•\r\n    }\r\n\r\n    @Override\r\n    public Transaction newTransaction(Connection connection) {\r\n        return new TransactionImpl(connection, autoCommit);\r\n    }\r\n\r\n    @Override\r\n    public Transaction newTransaction(DataSource dataSource, TransactionIsolationLevel transactionIsolationLevel, boolean b) {\r\n        return new TransactionImpl(dataSource, autoCommit);\r\n    }\r\n}\r\n```\r\n\r\n<div >- Transactionæ¥å£å®ç°</div>\r\n\r\n```\r\nimport com.hyh.dbUtil.DBUtils;\r\nimport org.apache.ibatis.transaction.Transaction;\r\nimport org.mybatis.logging.Logger;\r\nimport org.mybatis.logging.LoggerFactory;\r\n\r\nimport javax.sql.DataSource;\r\nimport java.sql.Connection;\r\nimport java.sql.SQLException;\r\nimport org.mybatis.spring.transaction.SpringManagedTransaction;\r\n\r\n/**\r\n * å‚è€ƒï¼šorg.mybatis.spring.transaction.SpringManagedTransaction\r\n */\r\npublic class TransactionImpl implements Transaction {\r\n\r\n    private static final Logger LOGGER = LoggerFactory.getLogger(TransactionImpl.class); //é€šè¿‡mybatisè·å–æ—¥å¿—\r\n    private DataSource dataSource;\r\n\r\n    private Connection connection;\r\n    public Boolean autoCommit; //connection.setAutoCommit  åŒ…è£…ç±»æ‰å¯ä»¥è®¾ç½®ä¸ºç©º(é»˜è®¤ä¸ºnull)\r\n\r\n    private int commitCount = 0;\r\n    private int rollbackCount = 0;\r\n\r\n    public TransactionImpl(Connection connection, boolean autoCommit) {\r\n        this.connection = connection;\r\n        this.autoCommit = autoCommit;\r\n        LOGGER.debug(() -> {\r\n            return \"initialize HAMSTER Connection through connection AUTOCOMMIT \" + this.autoCommit;\r\n        });\r\n    }\r\n\r\n    public TransactionImpl(DataSource dataSource, boolean autoCommit) {\r\n        this.dataSource = dataSource;\r\n        this.autoCommit = autoCommit;\r\n        LOGGER.debug(() -> {\r\n            return \"initialize HAMSTER Connection through datasource AUTOCOMMIT \" + this.autoCommit;\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public Connection getConnection() throws SQLException {\r\n\r\n        if (this.connection == null) {\r\n            this.openConnection();\r\n        }\r\n\r\n        return this.connection;\r\n    }\r\n\r\n    @Override\r\n    public void commit() throws SQLException {\r\n        if (this.connection != null &&  !this.autoCommit) {\r\n            LOGGER.debug(() -> {\r\n                return ++commitCount + \"Committing HAMSTER Connection [\" + this.connection + \"]\";\r\n            });\r\n            this.connection.commit();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void rollback() throws SQLException {\r\n        if (this.connection != null && !this.autoCommit) {\r\n            LOGGER.debug(() -> {\r\n                return ++rollbackCount + \"Rolling back HAMSTER Connection [\" + this.connection + \"]\";\r\n            });\r\n            this.connection.rollback();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void close() throws SQLException {\r\n        LOGGER.debug(() -> {\r\n            return \"HAMSTER Connection [\" + this.connection + \"] is closing\";\r\n        });\r\n        this.connection.close();\r\n    }\r\n\r\n    @Override\r\n    public Integer getTimeout() throws SQLException {\r\n        LOGGER.debug(() -> {\r\n            return \"HAMSTER Connection [\" + this.connection + \"] is checking timeout\";\r\n        });\r\n        return this.connection.getNetworkTimeout();\r\n    }\r\n\r\n    /**\r\n     * Sets this connection\'s auto-commit mode to the given state.\r\n     * If a connection is in auto-commit mode, then all its SQL statements will be executed and committed as individual\r\n     * transactions. Otherwise, its SQL statements are grouped into transactions that are terminated by a call to either\r\n     * the method commit or the method rollback. By default, new connections are in auto-commit mode.\r\n     * å¤§æ¦‚æ˜¯è¯´ï¼šè‡ªåŠ¨æäº¤ä¸ºçœŸï¼Œé‚£ä¹ˆå°±å•ä¸ªsqlæ¯æ¬¡éƒ½æäº¤ï¼Œè‡ªåŠ¨æäº¤ä¸ºå‡ï¼Œé‚£ä¹ˆå°±æ‰‹åŠ¨æäº¤ï¼Œå¹¶å°†æœ¬æ¬¡æäº¤å‰çš„æ‰€æœ‰sqlç§°ä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸ªäº‹åŠ¡ä¼šè¢«æäº¤æ–¹æ³•æˆ–è€…å›æ»šæ–¹æ³•ç»ˆæ­¢ã€‚\r\n     * @throws SQLException\r\n     */\r\n    private void openConnection() {\r\n        try {\r\n            this.connection = dataSource != null ? dataSource.getConnection() : new DBUtils().getConnection();\r\n            this.autoCommit = this.autoCommit == null? this.connection.getAutoCommit() : this.autoCommit;\r\n            this.connection.setAutoCommit(this.autoCommit); // è®¾ç½®/ä¼ å…¥å€¼\r\n        } catch (SQLException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        LOGGER.debug(() -> {\r\n            return \"HAMSTER Connection [\" + this.connection + \"] will be managed by Hamster\";\r\n        });\r\n    }\r\n}\r\n```\r\n\r\n<div >DBUtilç±»</div>\r\n\r\n```\r\nimport java.sql.Connection;\r\nimport java.sql.DriverManager;\r\nimport java.sql.SQLException;\r\n\r\npublic class DBUtils {\r\n\r\n    private String driver = \"oracle.jdbc.driver.OracleDriver\";\r\n    private String url = \"jdbc:oracle:thin:@localhost:1521:orcl\";\r\n    private String username = \"hyh\";\r\n    private String password = \"123456\";\r\n\r\n    public Connection getConnection() {\r\n        System.out.println(\"get Connection\");\r\n\r\n        Connection conn = null;\r\n        try {\r\n            Class.forName(driver);\r\n            conn = DriverManager.getConnection(url, username, password);\r\n        } catch (ClassNotFoundException | SQLException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        return conn;\r\n    }\r\n\r\n}\r\n```\r\n\r\n- æµ‹è¯•\r\n\r\n```\r\n@Test\r\npublic void testTransaction() {\r\n    System.out.println(\"====================test testTransaction===============\");\r\n\r\n    // è·å– MyBatis SqlSessionFactoryï¼ˆå‡è®¾ä½ å·²ç»åˆå§‹åŒ–äº†å®ƒï¼‰\r\n    SqlSessionFactory factory = giveFactory(); //!!!set Oracle Factory in this method\r\n\r\n    LogFactory.useStdOutLogging(); //å¼€å¯æ—¥å¿—æ‰“å°åˆ°æ§åˆ¶å°\r\n\r\n    // åˆ›å»ºä¸€ä¸ª SqlSession\r\n    try (SqlSession sqlSession = factory.openSession()) {\r\n        // è·å–ä½ çš„ Mapper\r\n        TestMapperInterface yourMapper = sqlSession.getMapper(TestMapperInterface.class);\r\n\r\n        // å¼€å§‹äº‹åŠ¡\r\n        sqlSession.getConnection().setAutoCommit(false);\r\n\r\n        try {\r\n            // æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œä¾‹å¦‚æ’å…¥æˆ–æ›´æ–°æ•°æ®\r\n            yourMapper.insert(5000, \"sss\", \"sdf\", 80); // æ›¿æ¢æˆä½ çš„å®é™…æ“ä½œ\r\n\r\n            // æ‰‹åŠ¨æäº¤äº‹åŠ¡\r\n            sqlSession.getConnection().commit();\r\n\r\n            // å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œäº‹åŠ¡å°†è¢«æäº¤\r\n        } catch (Exception e) {\r\n            // å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡\r\n            sqlSession.getConnection().rollback();\r\n\r\n            // å¤„ç†å¼‚å¸¸ï¼Œä¾‹å¦‚è®°å½•é”™è¯¯ä¿¡æ¯æˆ–æŠ›å‡ºå¼‚å¸¸\r\n            e.printStackTrace();\r\n        }\r\n    } catch (SQLException throwables) {\r\n        throwables.printStackTrace();\r\n    }\r\n}\r\n```\r\n<div >- è¾“å‡º</div>\r\n\r\n```\r\noracle\r\nLogging initialized using \'class org.apache.ibatis.logging.stdout.StdOutImpl\' adapter.\r\ninitialize HAMSTER Connection through datasource AUTOCOMMIT false\r\nHAMSTER Connection [oracle.jdbc.driver.T4CConnection@67a20f67] will be managed by Hamster\r\nHAMSTER Connection [oracle.jdbc.driver.T4CConnection@67a20f67] is checking timeout\r\nDEBUG [main] - ==>  Preparing: select mybatis_seq.nextVal from dual\r\nDEBUG [main] - ==> Parameters:\r\nDEBUG [main] - <==      Total: 1\r\nHAMSTER Connection [oracle.jdbc.driver.T4CConnection@67a20f67] is checking timeout\r\nDEBUG [main] - ==>  Preparing: insert into mybatis_user values (?, ?, ?, ?)\r\nDEBUG [main] - ==> Parameters: 398(Integer), sss(String), sdf(String), 80(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\n1Rolling back HAMSTER Connection [oracle.jdbc.driver.T4CConnection@67a20f67]\r\nHAMSTER Connection [oracle.jdbc.driver.T4CConnection@67a20f67] is closing\r\n\r\nProcess finished with exit code 0\r\n```\r\n<div >\r\n<pre class=\"preText\" id=\"dataSource\">\r\n    å¯ä»¥å¾—å‡ºsqläº‹åŠ¡çš„åŠ è½½é¡ºåºä¸ºï¼š\r\n</pre>\r\n\r\n> <h5>getConnection ---> check timeout ---> roll back / commit ---> close</h5>\r\n<pre>\r\n    XML ä¸­é…ç½®çš„ä»»ä½•å±æ€§éƒ½ä¼šåœ¨å®ä¾‹åŒ–åä¼ é€’ç»™ setProperties() æ–¹æ³•ã€‚ä½ çš„å®ç°è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª Transaction å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¥å£ï¼šgetConnection() commit() rollback() close() getTimeout() + ä¸Šé¢æœ‰å®ç°\r\n    ä½¿ç”¨ä¸Šé¢ä¸¤ç§æ¥å£ï¼Œä½ å¯ä»¥å®Œå…¨è‡ªå®šä¹‰mybatiså¤„ç†äº‹åŠ¡çš„æ–¹å¼ã€‚\r\n</pre>\r\n\r\n<h3>å¯¹mybatis-config.XMLæ–‡ä»¶çš„è§£é‡Šä¹‹dataSource</h3>\r\n\r\n> dataSource å…ƒç´ é…ç½®äº†ä½¿ç”¨æ ‡å‡† JDBC DataSource æ¥å£çš„ JDBC è¿æ¥å¯¹è±¡çš„æºå¤´ã€‚\r\n- å¤§å¤šæ•° MyBatis åº”ç”¨ç¨‹åºå°†é…ç½®ä¸€ä¸ªå¦‚ç¤ºä¾‹ä¸­çš„ dataSourceã€‚ç„¶è€Œï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœè¦æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œåˆ™å¿…é¡»é…ç½®dataSourceã€‚\r\n- å†…ç½®äº†ä¸‰ç§ dataSource ç±»å‹ï¼ˆå³ type=\"[UNPOOLED|POOLED|JNDI]\"ï¼‰ï¼š\r\n##### æ€»ç»“éƒ¨åˆ†\r\n\r\nUNPOOLED: æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šæ‰“å¼€å’Œå…³é—­è¿æ¥ï¼Œé€‚ç”¨äºä¸éœ€è¦é«˜å¯ç”¨è¿æ¥ï¼ˆéšç”¨éšè¿ï¼‰çš„ç®€å•åº”ç”¨ç¨‹åºä»¥åŠå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„æ•°æ®åº“ã€‚\r\n- UNPOOLED DataSource å…·æœ‰ä»¥ä¸‹å±æ€§ï¼šdriver[class of JDBC driver] url username password\r\n	- defaultTransactionIsolationLevel â€“ è¿æ¥çš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚\r\n	    - NONE æ•°æ®åº“é»˜è®¤éš”ç¦»çº§åˆ«\r\n	    - READ_UNCOMMITED å¯ä»¥è¯»å–æœªæäº¤æ•°æ®çš„æ›´æ”¹ï¼Œå¯èƒ½å¯¼è‡´è„è¯»/ä¸å¯é‡å¤è¯»/å¹»è¯»ã€‚\r\n	    - READ_COMMITTED åªèƒ½è¯»å–å·²æäº¤æ•°æ®çš„æ›´æ”¹ï¼Œå¯èƒ½ä¸å¯é‡å¤è¯»/å¹»è¯»ã€‚\r\n	    - REPEATABLE_READ åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–ç›¸åŒæ•°æ®æ—¶ï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¯èƒ½å¹»è¯»ã€‚\r\n	    - SERIALIZABLE äº‹åŠ¡ä¼šé”å®šè®¿é—®çš„æ•°æ®ï¼Œä»€ä¹ˆéƒ½ä¸å¯èƒ½å‘ç”Ÿï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå¹¶å‘å—åˆ°é™åˆ¶ã€‚\r\n             - è„è¯»ï¼šä¸»è¦æ˜¯å› ä¸ºæ²¡æœ‰æäº¤ã€‚\r\n             - ä¸å¯é‡å¤è¯»ï¼šè¡Œå†…å®¹å¯¹ä¸ä¸Šã€‚ä¸å¯é‡å¤è¯»å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡åœ¨å¤šæ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®æ—¶ï¼Œå¾—åˆ°äº†ä¸åŒçš„ç»“æœã€‚è¿™æ˜¯å› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†åŒä¸€è¡Œæ•°æ®ã€‚\r\n             - å¹»è¯»ï¼šè¡Œæ•°é‡å¯¹ä¸ä¸Šã€‚å¹»è¯»å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­å¤šæ¬¡æ‰§è¡Œæ—¶ï¼Œå‘ç°äº†ä¸åŒæ•°é‡çš„è¡Œã€‚è¿™æ˜¯å› ä¸ºåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥æˆ–åˆ é™¤äº†ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è¡Œã€‚\r\n	- defaultNetworkTimeout â€“ é»˜è®¤ç­‰å¾…æ•°æ®åº“æ“ä½œå®Œæˆçš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚\r\n    > æ‚¨è¿˜å¯ä»¥å°†å±æ€§ä¼ é€’ç»™æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·ä½¿ç”¨ driver. å‰ç¼€ï¼Œä¾‹å¦‚ï¼š\r\n    \r\n	- driver.encoding=UTF8\r\n            è¿™å°†é€šè¿‡ DriverManager.getConnection(url, driverProperties) æ–¹æ³•å°†å±æ€§ encoding çš„å€¼è®¾ç½®ä¸º UTF8ï¼Œä¼ é€’ç»™æ‚¨çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚\r\n\r\nPOOLED - æ­¤å®ç°çš„ DataSource ä½¿ç”¨è¿æ¥æ± æ¥é¿å…åˆ›å»ºæ–°çš„ Connection å®ä¾‹æ‰€éœ€çš„åˆå§‹è¿æ¥å’Œèº«ä»½éªŒè¯æ—¶é—´ã€‚è¿™æ˜¯ç”¨äºå¹¶å‘Webåº”ç”¨ç¨‹åºä»¥å®ç°æœ€å¿«å“åº”çš„å¸¸è§æ–¹æ³•ã€‚\r\n    å±æ€§ï¼š\r\n- poolMaximumActiveConnections - æ­¤å±æ€§è¡¨ç¤ºåœ¨ä»»ä½•ç»™å®šæ—¶é—´å¯ä»¥å­˜åœ¨çš„æ´»åŠ¨ï¼ˆå³æ­£åœ¨ä½¿ç”¨çš„ï¼‰è¿æ¥æ•°ã€‚é»˜è®¤å€¼ï¼š10\r\n- poolMaximumIdleConnections - å¯ä»¥åœ¨ä»»ä½•ç»™å®šæ—¶é—´å­˜åœ¨çš„ç©ºé—²è¿æ¥æ•°ã€‚\r\n- poolMaximumCheckoutTime - è¿™æ˜¯åœ¨è¢«å¼ºåˆ¶ç»“æŸä¹‹å‰ï¼Œè¿æ¥å¯ä»¥è‡ªè¡Œç™»å‡ºçš„æœ€å¤§æ—¶é—´ã€‚é»˜è®¤å€¼ï¼š20000æ¯«ç§’ï¼ˆå³20ç§’ï¼‰\r\n- poolTimeToWait - è¿™æ˜¯ä¸€ä¸ªä½çº§åˆ«è®¾ç½®ï¼Œè®¾ç½®åï¼Œå¦‚æœè·å¾—è¿æ¥çš„æ—¶é—´è¿‡é•¿ï¼Œè¿æ¥æ± æ‰æœ‰æœºä¼šæ‰“å°æ—¥å¿—çŠ¶æ€å¹¶è¿›è¡Œé‡è¯•ã€‚ï¼ˆä»¥å…é…ç½®ä¸æ­£ç¡®å¯¼è‡´å¯åŠ¨å¤±è´¥å´æ— æŠ¥é”™æ— é‡è¯•ï¼‰ã€‚é»˜è®¤å€¼ï¼š20000æ¯«ç§’ï¼ˆå³20ç§’ï¼‰\r\n- poolMaximumLocalBadConnectionTolerance - è¿™æ˜¯æœ‰å…³çº¿ç¨‹è·å¾—åè¿æ¥çš„å®¹å¿åº¦çš„ä½çº§åˆ«è®¾ç½®ã€‚å¦‚æœçº¿ç¨‹è·å¾—äº†åè¿æ¥ï¼Œå®ƒä»ç„¶å¯ä»¥æœ‰å¦ä¸€æ¬¡å°è¯•è·å–å¦ä¸€ä¸ªæœ‰æ•ˆè¿æ¥çš„æœºä¼šã€‚ä½†æ˜¯ï¼Œé‡è¯•æ¬¡æ•°ä¸åº”è¶…è¿‡ poolMaximumIdleConnections å’Œ poolMaximumLocalBadConnectionTolerance çš„æ€»å’Œã€‚é»˜è®¤å€¼ï¼š3ï¼ˆè‡ª3.4.5ç‰ˆæœ¬ä»¥æ¥ï¼‰\r\n- poolPingQuery - PingæŸ¥è¯¢ç”¨äºéªŒè¯è¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œå¹¶å‡†å¤‡æ¥å—è¯·æ±‚ã€‚é»˜è®¤å€¼ä¸º \"NO PING QUERY SET\"ï¼Œè¿™å°†ä½¿å¤§å¤šæ•°æ•°æ®åº“é©±åŠ¨ä¸æ­£å¸¸å·¥ä½œçš„æ—¶å€™æ˜¾ç¤ºåˆç†çš„é”™è¯¯æ¶ˆæ¯ï¼Œæ‰€ä»¥éå¿…è¦ä¸è¦æ›´æ”¹ã€‚\r\n- poolPingEnabled - è¿™å¯ç”¨æˆ–ç¦ç”¨pingæŸ¥è¯¢ã€‚å¦‚æœå¯ç”¨ï¼Œæ‚¨è¿˜å¿…é¡»å°† poolPingQuery çš„å€¼è®¾ç½®ä¸ºæœ‰æ•ˆçš„SQLè¯­å¥ï¼ˆæœ€å¥½æ˜¯æ‰§è¡Œå¿«é€Ÿçš„ï¼‰ã€‚é»˜è®¤å€¼ï¼šfalseã€‚\r\n- poolPingConnectionsNotUsedFor - è¿™é…ç½®äº†æ± å°†ä½¿ç”¨ poolPingQuery çš„é¢‘ç‡ã€‚å¯ä»¥ä¸æ•°æ®åº“è¿æ¥çš„æœ€å¤§è¶…æ—¶æ—¶é—´ç›¸åŒï¼Œä»¥é¿å…ä¸å¿…è¦çš„pingã€‚é»˜è®¤å€¼ï¼š0ï¼ˆå³æ¯æ¬¡éƒ½ä¼špingæ‰€æœ‰è¿æ¥ - ä½†å‰ææ˜¯ poolPingEnabled ä¸ºtrueï¼‰ã€‚\r\n\r\nJNDI - æ­¤ DataSource å®ç°é€‚ç”¨äºå®¹å™¨ï¼Œå¦‚EJBæˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œå®ƒä»¬å¯ä»¥åœ¨JNDIä¸Šä¸‹æ–‡ä¸­é…ç½®DataSourceå¹¶æ”¾ç½®å¯¹å®ƒçš„å¼•ç”¨ï¼Œç”¨äºå‘Šè¯‰ MyBatis ä½¿ç”¨ JNDI æ¥æŸ¥æ‰¾å’Œè·å–æ•°æ®æºã€‚æ­¤DataSourceé…ç½®ä»…éœ€è¦ä¸¤ä¸ªå±æ€§ï¼š\r\n- initial_context - ç”¨äºä» InitialContext é‡ŒæŸ¥æ‰¾ä¸Šä¸‹æ–‡([Context])ï¼ˆå³ initialContext.lookup(initial_context)ï¼‰ã€‚æ­¤å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¦‚æœçœç•¥ï¼Œåˆ™å°†ç›´æ¥ä» InitialContext é‡Œç›´æ¥æŸ¥æ‰¾ data_source å±æ€§ã€‚\r\n- data_source - æ•°æ®æºå®ä¾‹çš„å¼•ç”¨æ‰€åœ¨çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚å®ƒå°†é’ˆå¯¹ç”± initial_context æ‰¾åˆ°çš„ä¸Šä¸‹æ–‡[Context]è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æä¾› initial_context å±æ€§ï¼Œåˆ™å°†ç›´æ¥ä» InitialContext é‡ŒæŸ¥æ‰¾ã€‚\r\n> ä¸å…¶ä»–DataSourceé…ç½®ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡åœ¨å±æ€§å‰ç¼€ env. æ¥å°†å±æ€§ç›´æ¥å‘é€åˆ° InitialContextï¼Œä¾‹å¦‚ï¼š\r\n- env.encoding=UTF8\r\n        è¿™å°†æŠŠå±æ€§ encoding çš„å€¼ä½œä¸º UTF8 ç›´æ¥å‘é€åˆ° InitialContext æ„é€ å‡½æ•°ã€‚\r\n\r\nNOTE: æ‚¨å¯ä»¥é€šè¿‡å®ç° org.apache.ibatis.datasource.DataSourceFactory æ¥å£æ¥æ’å…¥ä»»ä½•ç¬¬ä¸‰æ–¹DataSourceã€‚\r\n\r\n> æ·»åŠ åŒ…ï¼šc3p0-0.9.5.5.jar mchange-commons-java-0.2.20.jar\r\n\r\n- è‡ªå®šä¹‰æ¥å£ dataSourceFactoryImpl/DataSourceFactoryImpl\r\n```\r\nimport com.mchange.v2.c3p0.*;\r\nimport org.apache.ibatis.datasource.DataSourceFactory;\r\nimport org.apache.ibatis.reflection.MetaObject;\r\nimport org.apache.ibatis.reflection.SystemMetaObject;\r\n\r\nimport javax.sql.DataSource;\r\nimport java.util.Properties;\r\n\r\npublic class DataSourceFactoryImpl implements DataSourceFactory {\r\n\r\n    private DataSource dataSource;\r\n\r\n    public DataSourceFactoryImpl() {\r\n        this.dataSource = new ComboPooledDataSource(); //åªæœ‰å®ƒæœ‰driver, url, user, passå±æ€§\r\n    }\r\n\r\n    // å‚è€ƒï¼šhttps://github.com/fuzhengwei/CodeGuide/blob/e9ff44b894ba2033bee782573b3f0fb33ad1f097/docs/md/spring/develop-mybatis/2022-05-03-%E7%AC%AC8%E7%AB%A0%EF%BC%9A%E6%8A%8A%E5%8F%8D%E5%B0%84%E7%94%A8%E5%88%B0%E5%87%BA%E7%A5%9E%E5%85%A5%E5%8C%96.md?plain=1#L465\r\n    @Override\r\n    public void setProperties(Properties props) { // é€šè¿‡ åå°„ çš„æ–¹å¼æ§åˆ¶æ•°æ®æºçš„å±æ€§\r\n        System.out.println(\"setting\");\r\n        MetaObject metaObject = SystemMetaObject.forObject(dataSource);\r\n\r\n        if (metaObject.hasSetter(\"dmds\")) {\r\n            DriverManagerDataSource dmds = (DriverManagerDataSource) metaObject.getValue(\"dmds\"); // ä¸Šä¸€å±‚ä¸ºdmds\r\n            MetaObject metaObjectDMDS = SystemMetaObject.forObject(dmds);\r\n            for (Object key : props.keySet()) {\r\n                String propertyName = (String) key;\r\n                String str[] = metaObjectDMDS.getSetterNames();\r\n                if (metaObjectDMDS.hasSetter(propertyName)) { // æŸ¥çœ‹æ•°æ®æºæ˜¯å¦æœ‰è¯¥ç±»å‹\r\n                    String value = (String) props.get(propertyName);\r\n                    Object convertedValue = convertValue(metaObject, propertyName, value);\r\n                    metaObjectDMDS.setValue(propertyName, convertedValue);\r\n                }\r\n            }\r\n            metaObject.setValue(\"dmds\", dmds);\r\n        }\r\n\r\n    }\r\n\r\n    @Override\r\n    public DataSource getDataSource() {\r\n        return this.dataSource;\r\n    }\r\n\r\n    // https://github.com/mybatis/mybatis-3/blob/master/src/main/java/org/apache/ibatis/datasource/unpooled/UnpooledDataSourceFactory.java\r\n    private Object convertValue(MetaObject metaDataSource, String propertyName, String value) {\r\n        Object convertedValue = value;\r\n        Class<?> targetType = metaDataSource.getSetterType(propertyName); // è·å–å…ƒæ•°æ®ä¸­è®¾å®šçš„ç±»å‹\r\n        if (targetType == Integer.class || targetType == int.class) {\r\n            convertedValue = Integer.valueOf(value);\r\n        } else if (targetType == Long.class || targetType == long.class) {\r\n            convertedValue = Long.valueOf(value);\r\n        } else if (targetType == Boolean.class || targetType == boolean.class) {\r\n            convertedValue = Boolean.valueOf(value);\r\n        }\r\n        return convertedValue; // è¿”å›è®¾ç½®å¥½ç±»å‹çš„å¯¹è±¡\r\n    }\r\n}\r\n</textarea>\r\n<div >mybatis-config.xmlä¸åŒçš„éƒ¨åˆ†</div>\r\n<textarea class=\"code\">\r\n    <dataSource type=\"com.hyh.dataSourceFactoryImpl.DataSourceFactoryImpl\"> <!--å®ƒçš„å±æ€§åä¸POOLEDçš„å®Œå…¨ä¸åŒ-->\r\n        <property name=\"driverClass\" value=\"${oracle_driver}\"/>\r\n        <property name=\"jdbcUrl\" value=\"${oracle_url}\"/>\r\n        <property name=\"user\" value=\"${oracle_username}\"/>\r\n        <property name=\"password\" value=\"${oracle_password}\"/>\r\n    </dataSource>\r\n</textarea>\r\n<div >mybatis-config.xmlå¯¹UNPOOLEDï¼ŒPOOLEDå’ŒJNDIçš„å±æ€§åº”ç”¨</div>\r\n<textarea class=\"code\">\r\n            <!--unpooledåªæ”¯æŒREAD_COMMITEDå’ŒSERIALIZABLEï¼Œä¸»è¦å› ä¸ºæ¯æ¬¡åˆ›å»ºæ–°çš„è¿æ¥ã€‚ä¸å¯èƒ½åŒè¿æ¥åŒæ—¶è®¿é—®-->\r\n            <dataSource type=\"UNPOOLED\"> <!--org.apache.ibatis.datasource.unpooled.UnpooledDataSource ä¸­å¯ä»¥æ‰¾åˆ°Connection.READ_COMMITTEDæ˜¯é‡Œé¢çš„å¸¸é‡-->\r\n                <property name=\"driver\" value=\"${oracle_driver}\"/>\r\n                <property name=\"url\" value=\"${oracle_url}\"/>\r\n                <property name=\"username\" value=\"${oracle_username}\"/>\r\n                <property name=\"password\" value=\"${oracle_password}\"/>\r\n                <property name=\"defaultTransactionIsolationLevel\" value=\"2\"/>\r\n                <!-- * æ¥å£åï¼šConnection\r\n                int TRANSACTION_NONE             = 0;\r\n                int TRANSACTION_READ_UNCOMMITTED = 1;\r\n                int TRANSACTION_READ_COMMITTED   = 2;\r\n                int TRANSACTION_REPEATABLE_READ  = 4;\r\n                int TRANSACTION_SERIALIZABLE     = 8;-->\r\n                <property name=\"defaultNetworkTimeout\" value=\"1000\"/>\r\n            </dataSource>\r\n\r\n            <!--æ–°æ–‡ä»¶-->\r\n            <dataSource type=\"POOLED\"> <!--org.apache.ibatis.datasource.pooled.pooledDataSource-->\r\n                <property name=\"driver\" value=\"${oracle_driver}\"/>\r\n                <property name=\"url\" value=\"${oracle_url}\"/>\r\n                <property name=\"username\" value=\"${oracle_username}\"/>\r\n                <property name=\"password\" value=\"${oracle_password}\"/>\r\n                <property name=\"poolMaximumActiveConnections\" value=\"20\"/>\r\n                <property name=\"poolMaximumIdleConnections\" value=\"5\"/>\r\n                <property name=\"poolMaximumCheckoutTime\" value=\"30000\"/>\r\n                <property name=\"poolTimeToWait\" value=\"25000\"/>\r\n                <property name=\"poolMaximumLocalBadConnectionTolerance\" value=\"5\"/>\r\n                <property name=\"poolPingQuery\" value=\"select * from mybatis_user where id = 1\"/>\r\n                <property name=\"poolPingEnabled\" value=\"true\"/>\r\n                <property name=\"poolPingConnectionsNotUsedFor\" value=\"30000\"/>\r\n            </dataSource>\r\n</textarea>\r\n<div >\r\n<pre>\r\n    org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory å¯ä»¥ä½œä¸ºæ„å»ºæ–°çš„æ•°æ®æºé€‚é…å™¨çš„çˆ¶ç±»ä½¿ç”¨ã€‚\r\n\r\n    - C3P0DataSourceFactoryç±»\r\n    * mybatis-config.xmlå’Œä¸Šé¢çš„ä¸€æ ·\r\n</pre>\r\n</div>\r\n<textarea class=\"code\">\r\nimport com.mchange.v2.c3p0.ComboPooledDataSource;\r\nimport org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;\r\n\r\npublic class C3P0DataSourceFactory extends UnpooledDataSourceFactory {\r\n\r\n    public C3P0DataSourceFactory() {\r\n        this.dataSource = new ComboPooledDataSource();\r\n    }\r\n}\r\n```\r\n<div >\r\n    <h4>JNDIçš„åº”ç”¨(spring + mybatis)ï¼šæ˜¯å¯¹å®¹å™¨è®¾ç½®çš„åº”ç”¨</h4>\r\n    JNDIåœ¨mybatisä¸­åº•å±‚è¿æ¥æ± å°±æ˜¯DBCP(2)ï¼Œè¯¦æƒ…çœ‹ <a href=\"#dbcp\">è¿™é‡Œ</a>  <br>\r\n<pre>\r\n* context.xmlï¼ï¼ï¼ï¼ï¼ï¼è¿™ä¸ªæ–‡ä»¶ä¸€å®šåœ¨tomcatå®‰è£…è·¯å¾„ä¸‹çš„confé‡Œcontex.xmlæ·»åŠ ï¼Œä¹Ÿå°±æ˜¯æ˜¯tomcatå®¹å™¨æœ¬èº«çš„ç¯å¢ƒé…ç½®\r\n    - å¯¹web.xmlçš„ä¿®æ”¹ä¹Ÿæ˜¯åœ¨tomcatç›®å½•ä¸‹ä¿®æ”¹\r\n    - éœ€è¦åœ¨ç›®å½•ä¸‹libæ–‡ä»¶å¤¹æ·»åŠ jdbcçš„åŒ… eg:ojdbc8.jar\r\n</pre>\r\n\r\n- tomcatè·¯å¾„ä¸‹context.xml\r\n</div>\r\n\r\n```\r\n<!--ï¼ï¼ï¼ï¼ï¼ï¼è¿™ä¸ªæ–‡ä»¶ä¸€å®šåœ¨tomcatå®‰è£…è·¯å¾„ä¸‹çš„confé‡Œcontex.xmlæ·»åŠ -->\r\n<Resource name=\"jdbc/test\" auth=\"Container\"\r\n      type=\"javax.sql.DataSource\"\r\n      driverClassName=\"com.mysql.jdbc.Driver\"\r\n      url=\"jdbc:oracle:thin:@localhost:1521:orcl\"\r\n      username=\"hyh\"\r\n      password=\"123456\"\r\n      maxActive=\"100\" maxIdle=\"30\" maxWait=\"10000\"\r\n      removeAbandoned=\"true\"\r\n      removeAbandonedTimeout=\"60\"\r\n      logAbandoned=\"true\"\r\n/>\r\n```\r\n<div >tomcatè·¯å¾„ä¸‹web.xmlæ·»åŠ </div>\r\n\r\n```\r\n<resource-ref>\r\n    <description>Oracle Datasource example</description>\r\n    <res-ref-name>jdbc/test</res-ref-name>\r\n    <res-type>javax.sql.DataSource</res-type>\r\n    <res-auth>Container</res-auth>\r\n</resource-ref>\r\n```\r\n<div >springåŸºæœ¬è®¾ç½®</div>\r\n\r\n```\r\n    ++ applicationContext.xml\r\n    <context:component-scan base-package=\"web.hyh\"/>\r\n\r\n    ++ dispatcher-servlet.xml\r\n    <context:component-scan base-package=\"web.hyh.controller\"/>\r\n    <bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\" id=\"internalResourceViewResolver\">\r\n        <property name=\"prefix\" value=\"/WEB-INF/jsp/\"/>\r\n        <property name=\"suffix\" value=\".jsp\"/>\r\n    </bean>\r\n\r\n    ++ web.xml\r\n    <context-param>\r\n        <param-name>contextConfigLocation</param-name>\r\n        <param-value>\r\n            /WEB-INF/applicationContext.xml\r\n        </param-value>\r\n    </context-param>\r\n    <listener>\r\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\r\n    </listener>\r\n    <servlet>\r\n        <servlet-name>dispatcher</servlet-name>\r\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\r\n        <load-on-startup>1</load-on-startup>\r\n    </servlet>\r\n    <servlet-mapping>\r\n        <servlet-name>dispatcher</servlet-name>\r\n        <url-pattern>/</url-pattern>\r\n    </servlet-mapping>\r\n\r\n    ++ index.jsp\r\n    <body>\r\n        <% response.sendRedirect( \"/index\" ); %>\r\n    </body>\r\n```\r\n<div >web.hyh.controller.IndexControllerç±»</div>\r\n\r\n```\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport web.hyh.service.DataProcess;\r\n\r\nimport javax.servlet.http.HttpServletRequest;\r\nimport javax.servlet.http.HttpServletResponse;\r\n\r\n@Controller\r\npublic class IndexController {\r\n\r\n    @Autowired\r\n    DataProcess dataProcess;\r\n\r\n    @RequestMapping(\"/index\")\r\n    public String handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) {\r\n\r\n        dataProcess.index(httpServletRequest, httpServletResponse);\r\n\r\n        return \"index\";\r\n    }\r\n\r\n}\r\n```\r\n<div >\r\n    web.hyh.serviceåŒ…å†…å†…å®¹\r\n</div>\r\n\r\n```\r\nimport javax.servlet.http.HttpServletRequest;\r\nimport javax.servlet.http.HttpServletResponse;\r\nimport javax.servlet.http.HttpSession;\r\n\r\npublic interface DataProcess {\r\n    void index(HttpServletRequest request, HttpServletResponse response);\r\n    void setDataProcess(HttpServletRequest request, HttpServletResponse response);\r\n\r\n    int StaticExample = 1;\r\n}\r\n-----------------------------------------------\r\npackage web.hyh.service.impl;\r\n\r\nimport com.hyh.dao.TestMapperInterface;\r\nimport com.hyh.pojo.User;\r\nimport com.sun.deploy.net.HttpResponse;\r\nimport org.apache.ibatis.io.Resources;\r\nimport org.apache.ibatis.session.SqlSession;\r\nimport org.apache.ibatis.session.SqlSessionFactory;\r\nimport org.apache.ibatis.session.SqlSessionFactoryBuilder;\r\nimport org.springframework.stereotype.Service;\r\nimport web.hyh.service.DataProcess;\r\n\r\nimport javax.naming.Context;\r\nimport javax.naming.InitialContext;\r\nimport javax.naming.NamingException;\r\nimport javax.servlet.http.HttpServletRequest;\r\nimport javax.servlet.http.HttpServletResponse;\r\nimport javax.servlet.http.HttpSession;\r\nimport javax.sql.DataSource;\r\nimport java.io.*;\r\nimport java.sql.Connection;\r\nimport java.sql.SQLException;\r\nimport java.util.List;\r\nimport java.util.Properties;\r\n\r\n@Service\r\npublic class DataProcessImpl implements DataProcess {\r\n\r\n    protected HttpServletRequest request;\r\n    protected HttpServletResponse response;\r\n\r\n    private HttpSession session;\r\n    private PrintWriter out;\r\n\r\n    public DataProcessImpl() {\r\n    }\r\n\r\n    public void setDataProcess(HttpServletRequest request, HttpServletResponse response) {\r\n        this.request = request;\r\n        this.response = response;\r\n\r\n        try {\r\n            response.setContentType(\"text/html\");\r\n            response.setCharacterEncoding(\"UTF-8\");\r\n            out = response.getWriter();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n        session = request.getSession();\r\n    }\r\n\r\n    @Override\r\n    public void index(HttpServletRequest request, HttpServletResponse response) {\r\n        setDataProcess(request, response);\r\n\r\n        SqlSessionFactory factory = giveFactory();\r\n        SqlSession sqlSession = factory.openSession();\r\n        out.print(sqlSession.getMapper(TestMapperInterface.class).getAll());\r\n        out.flush();\r\n        System.out.println(sqlSession.getMapper(TestMapperInterface.class).getAll());\r\n    }\r\n\r\n    public SqlSessionFactory giveFactory() { //å¯ç”¨mybatisé…ç½®æ–‡ä»¶\r\n        SqlSessionFactory factory = null;\r\n        try {\r\n            InputStream inputStream = Resources.getResourceAsStream(\"mybatis-config.xml\"); //ä½¿ç”¨\r\n            factory = new SqlSessionFactoryBuilder().build(inputStream);\r\n            inputStream.close();\r\n        } catch (IOException exception) {\r\n            exception.printStackTrace();\r\n        }\r\n\r\n        factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n        System.out.println(factory.getConfiguration().getDatabaseId());\r\n\r\n        return factory;\r\n    }\r\n\r\n}\r\n```\r\n\r\n<div >mybatis-config.xmlä¿®æ”¹éƒ¨åˆ†</div>\r\n\r\n```\r\n    <dataSource type=\"JNDI\">\r\n        <property name=\"initial_context\" value=\"java:/comp/env\"/> <!--åœ¨java:/comp/envè¿™ä¸ªä¸Šä¸‹æ–‡é‡ŒæŸ¥æ‰¾ https://github.com/yeecode/MyBatisCN/blob/489e130b318d4e46f0b2e70a5ed71b25914bda20/src/main/java/org/apache/ibatis/datasource/jndi/JndiDataSourceFactory.java#L40-->\r\n        <property name=\"data_source\" value=\"/jdbc/test\"/>\r\n    <dataSource/>\r\n```\r\n<div >\r\n       <h3>mybatis-config.xml settingså±æ€§å¤§å…¨</h3>\r\n    </div>\r\n    \r\n```\r\n<settings>\r\n\r\n    <!--settingséœ€è¦åœ¨propertiesåé¢ environmentså‰é¢ å¦åˆ™ä¼šæŠ¥çº¢ çŒœæµ‹æ˜¯åŠ è½½é¡ºåºæœ‰è§„å®š-->\r\n    <setting name=\"logImpl\" value=\"LOG4J\"/>\r\n    <!--æœ‰æ•ˆçš„å€¼åŒ…æ‹¬SLF4Jã€LOG4Jã€LOG4J2ã€JDK_LOGGINGã€COMMONS_LOGGINGã€STDOUT_LOGGINGã€NO_LOGGINGï¼Œæˆ–è€…ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åï¼Œè¯¥ç±»å®ç°org.apache.ibatis.logging.Logæ¥å£ï¼Œå¹¶å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ã€‚-->\r\n\r\n    <!-- ä½¿å…¨å±€çš„æ˜ å°„å™¨å¯ç”¨æˆ–ç¦ç”¨ç¼“å­˜ã€‚ -->\r\n    <setting name=\"cacheEnabled\" value=\"true\"/>\r\n\r\n    <!-- å…¨å±€å¯ç”¨æˆ–ç¦ç”¨å»¶è¿ŸåŠ è½½ã€‚å½“ç¦ç”¨æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå³æ—¶åŠ è½½ã€‚ -->\r\n    <setting name=\"lazyLoadingEnabled\" value=\"true\"/>\r\n\r\n    <!-- å½“å¯ç”¨æ—¶ï¼Œæœ‰å»¶è¿ŸåŠ è½½å±æ€§çš„å¯¹è±¡åœ¨è¢«è°ƒç”¨æ—¶å°†ä¼šå®Œå…¨åŠ è½½ä»»æ„å±æ€§ã€‚å¦åˆ™ï¼Œæ¯ç§å±æ€§å°†ä¼šæŒ‰éœ€è¦åŠ è½½ã€‚ -->\r\n    <setting name=\"aggressiveLazyLoading\" value=\"true\"/>\r\n\r\n    <!-- æ˜¯å¦å…è®¸å•æ¡sql è¿”å›å¤šä¸ªæ•°æ®é›†  (å–å†³äºé©±åŠ¨çš„å…¼å®¹æ€§) default:true -->\r\n    <setting name=\"multipleResultSetsEnabled\" value=\"true\"/>\r\n\r\n    <!-- æ˜¯å¦å¯ä»¥ä½¿ç”¨åˆ—çš„åˆ«å (å–å†³äºé©±åŠ¨çš„å…¼å®¹æ€§) default:true -->\r\n    <setting name=\"useColumnLabel\" value=\"true\"/>\r\n\r\n    <!-- å…è®¸JDBC ç”Ÿæˆä¸»é”®ã€‚éœ€è¦é©±åŠ¨å™¨æ”¯æŒã€‚å¦‚æœè®¾ä¸ºäº†trueï¼Œè¿™ä¸ªè®¾ç½®å°†å¼ºåˆ¶ä½¿ç”¨è¢«ç”Ÿæˆçš„ä¸»é”®ï¼Œæœ‰ä¸€äº›é©±åŠ¨å™¨ä¸å…¼å®¹ä¸è¿‡ä»ç„¶å¯ä»¥æ‰§è¡Œã€‚  default:false  -->\r\n    <setting name=\"useGeneratedKeys\" value=\"false\"/>\r\n\r\n    <!-- æŒ‡å®š MyBatis å¦‚ä½•è‡ªåŠ¨æ˜ å°„ æ•°æ®åŸºè¡¨çš„åˆ— NONEï¼šä¸éšå°„ã€€PARTIAL:éƒ¨åˆ†  FULL:å…¨éƒ¨  -->\r\n    <setting name=\"autoMappingBehavior\" value=\"PARTIAL\"/>\r\n\r\n    <!-- è¿™æ˜¯é»˜è®¤çš„æ‰§è¡Œç±»å‹  ï¼ˆSIMPLE: ç®€å•ï¼› REUSE: æ‰§è¡Œå™¨å¯èƒ½é‡å¤ä½¿ç”¨prepared statementsè¯­å¥ï¼›BATCH: æ‰§è¡Œå™¨å¯ä»¥é‡å¤æ‰§è¡Œè¯­å¥å’Œæ‰¹é‡æ›´æ–°ï¼‰  -->\r\n    <setting name=\"defaultExecutorType\" value=\"SIMPLE\"/>\r\n\r\n    <!-- ä½¿ç”¨é©¼å³°å‘½åæ³•è½¬æ¢å­—æ®µã€‚ -->\r\n    <setting name=\"mapUnderscoreToCamelCase\" value=\"true\"/>\r\n\r\n    <!-- è®¾ç½®æœ¬åœ°ç¼“å­˜èŒƒå›´ session:å°±ä¼šæœ‰æ•°æ®çš„å…±äº«  statement:è¯­å¥èŒƒå›´ (è¿™æ ·å°±ä¸ä¼šæœ‰æ•°æ®çš„å…±äº« ) defalut:session -->\r\n    <setting name=\"localCacheScope\" value=\"SESSION\"/>\r\n\r\n    <!-- å½“å‚æ•°æ²¡æœ‰è®¾ç½®(JDBC)æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œè®¾å®šè¯¥å‚æ•°çš„nullå€¼çš„æ•°æ®ç±»å‹ã€‚æŸäº›æ•°æ®åº“é©±åŠ¨è¦æŒ‡å®šæ•°æ®ç±»å‹ï¼ŒæŸäº›ä¸éœ€è¦æŒ‡å®šç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é€šç”¨å€¼æ¯”å¦‚null, varchar æˆ–è€… other-->\r\n    <setting name=\"jdbcTypeForNull\" value=\"NULL\"/>\r\n\r\n</settings>\r\n```\r\n <div >\r\n     <h3>mybatisæ—¥å¿—</h3>\r\n     \r\n1. `æ—¥å¿—çš„é…ç½®`ï¼šMyBatis å…è®¸æ‚¨é…ç½®æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰ï¼Œè¿™äº›æ—¥å¿—è®°å½•å™¨ç”¨äºæ•è· MyBatis æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ã€‚é€šå¸¸ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸åŒçš„æ—¥å¿—è®°å½•å™¨å®ç°ï¼Œä¾‹å¦‚ Log4jã€Logbackã€Slf4jã€Java Util Logging ç­‰ã€‚<br>\r\n2. `MyBatis çš„æ—¥å¿—çº§åˆ«`ï¼šMyBatis é€šå¸¸æ”¯æŒä¸åŒçš„æ—¥å¿—çº§åˆ«ï¼Œå¦‚ DEBUGã€INFOã€WARN å’Œ ERRORã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é…ç½®æ‰€éœ€çš„æ—¥å¿—çº§åˆ«ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨å¼€å‘å’Œè°ƒè¯•é˜¶æ®µï¼Œå°†æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º DEBUG å¯ä»¥æ˜¾ç¤ºè¯¦ç»†çš„ SQL æ‰§è¡Œä¿¡æ¯ã€‚<br>\r\n3. `æ—¥å¿—çš„è¾“å‡ºä½ç½®`ï¼šæ‚¨å¯ä»¥é…ç½®æ—¥å¿—è¾“å‡ºçš„ä½ç½®ï¼Œé€šå¸¸å¯ä»¥å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ã€æ–‡ä»¶æˆ–å…¶ä»–è‡ªå®šä¹‰ä½ç½®ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®æ—¥å¿—æ¡†æ¶çš„ appender æˆ– MyBatis çš„é…ç½®æ–‡ä»¶æ¥å®Œæˆã€‚<br>\r\n4. `MyBatis å†…ç½®çš„æ—¥å¿—å®ç°`ï¼šMyBatis é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªå†…ç½®çš„æ—¥å¿—å®ç°ï¼Œå®ƒå¯ä»¥ç”¨äºå¿«é€Ÿè®¾ç½®å’ŒæŸ¥çœ‹æ—¥å¿—ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ›´å¼ºå¤§çš„æ—¥å¿—æ¡†æ¶ã€‚<br>\r\n5. `ä½¿ç”¨ SLF4J é€‚é…å™¨`ï¼šSLF4Jï¼ˆSimple Logging Facade for Javaï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ—¥å¿—é—¨é¢ï¼Œå®ƒå¯ä»¥ä¸ä¸åŒçš„æ—¥å¿—å®ç°ï¼ˆå¦‚ Log4jã€Logbackï¼‰ä¸€èµ·ä½¿ç”¨ã€‚MyBatis æä¾›äº† SLF4J çš„é€‚é…å™¨ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å°† MyBatis çš„æ—¥å¿—è¾“å‡ºé›†æˆåˆ°æ‚¨çš„ SLF4J æ—¥å¿—ç³»ç»Ÿä¸­ã€‚<br>\r\n6. `ç¤ºä¾‹é…ç½®`ï¼šå®˜æ–¹æ–‡æ¡£é€šå¸¸æä¾›ç¤ºä¾‹é…ç½®ï¼Œä»¥å¸®åŠ©ç”¨æˆ·é…ç½®é€‚å½“çš„æ—¥å¿—è®°å½•å™¨å’Œçº§åˆ«ã€‚<br>\r\n7. `ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µ`ï¼šæ–‡æ¡£é€šå¸¸ä¼šæä¾›å…³äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¦‚ä½•é…ç½®å’Œä½¿ç”¨æ—¥å¿—çš„æœ€ä½³å®è·µå»ºè®®ï¼Œä»¥ç¡®ä¿æ—¥å¿—è®°å½•ä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“ã€‚<br>\r\n\r\nNOTE: chatGPTåŒä¸€å¯¹è¯ä¿å­˜ä¿¡æ¯å¤ªå¤šä¼šå˜å¡ï¼Œè®°å¾—æ–°å¼€ä¸€ä¸ªã€‚<br>\r\n<h4>mybatisæ—¥å¿—å®˜æ–¹æ–‡æ¡£ï¼ˆç¿»è¯‘æ¶¦è‰²è‡ªchatGPTï¼‰</h4>\r\n<pre>\r\nmybatisä½¿ç”¨å†…éƒ¨æ—¥å¿—å·¥å‚æ¥ç”Ÿæˆæ—¥å¿—ï¼Œå†…éƒ¨æ—¥å¿—å·¥å‚ä¼šå°†æ—¥å¿—ä¿¡æ¯å§”æ´¾ç»™ä¸‹åˆ—æ—¥å¿—å®ç°ä¸­çš„ä¸€ä¸ªï¼š\r\n    SLF4J\r\n    Apache Commons Logging\r\n    Log4j 2\r\n    Log4j\r\n    JDK logging\r\nå…·ä½“é€‰æ‹©çš„å®ç°ç”±mybatiså†…éƒ¨çš„æ—¥å¿—å·¥å‚åœ¨è¿è¡Œæ—¶å®¡æŸ¥å†³å®šã€‚MyBatisæ—¥å¿—å·¥å‚å°†ä½¿ç”¨å®ƒæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ—¥å¿—å®ç°ï¼ˆæŒ‰ä¸Šè¿°é¡ºåºæœç´¢å®ç°ï¼‰ã€‚å¦‚æœMyBatisæ‰¾ä¸åˆ°ä¸Šè¿°ä»»ä½•å®ç°ï¼Œåˆ™æ—¥å¿—è®°å½•å°†è¢«ç¦ç”¨ã€‚\r\n\r\nè®¸å¤šç¯å¢ƒå°†Commons Loggingè£…è½½ä¸ºåº”ç”¨å†…è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼ˆä¾‹å¦‚Tomcatå’ŒWebSphereï¼‰ï¼Œåœ¨è¿™ç§ç¯å¢ƒä¸­ï¼ŒMyBatiså°†ä½¿ç”¨Commons Loggingä½œä¸ºæ—¥å¿—å®ç°ï¼Œè¿™æ„å‘³ç€æ‚¨çš„Log4Jé…ç½®å°†è¢«å¿½ç•¥ï¼Œä½†å¦‚æœæ‚¨æ›´æ„¿æ„ä½¿ç”¨å…¶ä»–æ—¥å¿—å®ç°ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨mybatis-config.xmlæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è®¾ç½®æ¥é€‰æ‹©ä¸åŒçš„æ—¥å¿—å®ç°ï¼š\r\n</pre>\r\n- mybatis-config.xml\r\n\r\n```\r\n<settings> <!-- settingséœ€è¦åœ¨propertiesåé¢ environmentså‰é¢ å¦åˆ™ä¼šæŠ¥çº¢ çŒœæµ‹æ˜¯åŠ è½½é¡ºåºæœ‰è§„å®š -->\r\n    <setting name=\"logImpl\" value=\"LOG4J\"/>\r\n    <!--æœ‰æ•ˆçš„å€¼åŒ…æ‹¬SLF4Jã€LOG4Jã€LOG4J2ã€JDK_LOGGINGã€COMMONS_LOGGINGã€STDOUT_LOGGINGã€NO_LOGGINGï¼Œæˆ–è€…ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åï¼Œè¯¥ç±»å®ç°org.apache.ibatis.logging.Logæ¥å£ï¼Œå¹¶å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ã€‚-->\r\n</settings>\r\n```\r\n<div >ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è®¾å®šLogFactoryçš„ç±»å‹ï¼š(å‰ææ˜¯ä½ çš„è·¯å¾„é‡Œé¢æœ‰è¯¥æ—¥å¿—å®ç°ï¼Œå¦åˆ™mybatiså°±ä¼šå¿½ç•¥å®ƒ)</div>\r\n\r\n```\r\n@Test\r\npublic void testForInterfacePlusXMLWithLog() {\r\n    System.out.println(\"============Test testForInterfacePlusXMLWithLog=============\");\r\n\r\n    SqlSessionFactory factory = giveFactory();\r\n    LogFactory.useSlf4jLogging(); //é€‰æ‹©org.apache.ibatis.logging.LogFactory\r\n    //        æŠ¥é”™æ²¡æ‰¾åˆ°è·¯å¾„ï¼Œå¯èƒ½mybatisè™½ç„¶å¿½ç•¥æ²¡æœ‰è·¯å¾„çš„é…ç½®ï¼Œä½†å®ƒä¸‹é¢çš„LoggerFactoryä¸ä¼šï¼Œä»ç„¶ä¼šæŠ¥é”™\r\n    //        ç”šè‡³åº•å±‚å¯ä»¥çœ‹è§å®ƒæ˜¯æŠ›å‡ºäº†å¼‚å¸¸çš„ å¯ä»¥ç”¨try catchè·³è¿‡  <å¥½æƒ³æ­»>\r\n    //        æ·»åŠ åŒ…ï¼šslf4j-api-1.7.32.jar\r\n    org.apache.ibatis.logging.LogFactory.useLog4JLogging();\r\n    //log4j-1.2.17.jar log4j-slf4j-impl-3.0.0-alpha1.jar log4j-api-2.17.2.jar log4j-core-2.11.2.jar\r\n    System.setProperty(\"myproperty\", \"F:\\\\JAVA\\\\20230925\\\\mybitis\\\\src\\\\resources\\\\log4j2.properties\");\r\n    org.apache.ibatis.logging.LogFactory.useLog4J2Logging();\r\n    //æç¤ºéœ€è¦è®¾ç½®é…ç½®æ–‡ä»¶ æ³¨æ„éclassæ–‡ä»¶outå’Œå®é™…æ–‡ä»¶å¯èƒ½ä¸åŒæ­¥ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶ å¡äº†å¥½å‡ å°æ—¶...\r\n    //åˆ†æåŸå› ï¼šå¯èƒ½æ˜¯æ›¾ç»ä¿®æ”¹é¡¹ç›®åˆ°mavenç»“æ„å¯¼è‡´çš„ideaè¯†åˆ«é—®é¢˜ï¼Œé‡æ–°å»ºä¸€ä¸ªé¡¹ç›®å°±å¯ä»¥è§£å†³äº†ã€‚\r\n    org.apache.ibatis.logging.LogFactory.useJdkLogging();\r\n    org.apache.ibatis.logging.LogFactory.useCommonsLogging();\r\n    org.apache.ibatis.logging.LogFactory.useStdOutLogging();\r\n\r\n    try (SqlSession session = factory.openSession()) {\r\n        factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n        System.out.println(factory.getConfiguration().getDatabaseId());\r\n        //åœ¨xmlé‡Œé¢æ·»åŠ äº†æ¥å£\r\n\r\n        TestMapperInterface tmi = session.getMapper(TestMapperInterface.class);\r\n        System.out.println(\"\" +\r\n                tmi.delete(51) + \" \" +\r\n                tmi.update(45, \"asdf\", \"wee\", 90) + \" \" +\r\n                tmi.insert(23, \"sd\", \"sd\", 88) + \" \" +\r\n                tmi.getAll() + \" \\n\" +\r\n                tmi.selectUser(45)\r\n        ); //è¿™é‡ŒæŸ¥æ‰¾çš„æ•°æ®æƒ³è¦æ”¹å˜ä¸­é€”éœ€è¦commit\r\n\r\n        session.commit();\r\n\r\n    }\r\n}\r\n```\r\n<div >è¾“å‡ºï¼ˆåŒ…å«StdOutLoggingæ—¥å¿—å†…å®¹ï¼‰</div>\r\n\r\n```\r\n2023-09-30 20:06:36 DEBUG LogFactory:105 - Logging initialized using \'class org.apache.ibatis.logging.log4j2.Log4j2Impl\' adapter.\r\nLogging initialized using \'class org.apache.ibatis.logging.stdout.StdOutImpl\' adapter.\r\noracle\r\nOpening JDBC Connection\r\nSetting autocommit to false on JDBC Connection [oracle.jdbc.driver.T4CConnection@f1da57d]\r\ntrue true true [User{id=175, name=\'sd\', sex=\'sd\', age=88}, User{id=45, name=\'asdf\', sex=\'wee\', age=90}, User{id=42, name=\'WWW\', sex=\'W\', age=10}, User{id=43, name=\'WWW\', sex=\'W\', age=10}, User{id=44, name=\'WWW\', sex=\'W\', age=10}, User{id=46, name=\'WWW\', sex=\'W\', age=10}, User{id=47, name=\'WWW\', sex=\'W\', age=10}, User{id=48, name=\'WWW\', sex=\'W\', age=10}, User{id=49, name=\'WWW\', sex=\'W\', age=10}, User{id=50, name=\'WWW\', sex=\'W\', age=10}]\r\nUser{id=45, name=\'asdf\', sex=\'wee\', age=90}\r\nRolling back JDBC Connection [oracle.jdbc.driver.T4CConnection@f1da57d]\r\nResetting autocommit to true on JDBC Connection [oracle.jdbc.driver.T4CConnection@f1da57d]\r\nClosing JDBC Connection [oracle.jdbc.driver.T4CConnection@f1da57d]\r\n```\r\nè¦æŸ¥çœ‹MyBatisçš„æ—¥å¿—è®°å½•è¯­å¥ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹ä¸€äº›å¯¹è±¡å¯ç”¨æ—¥å¿—ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåŒ…ï¼Œä¸€ä¸ªmapperæŒ‡å‘çš„ç±»æˆ–å…¶ä¸­çš„namespaceæˆ–ä¸€ä¸ªåˆæ³•çš„sqlè¯­å¥idåã€‚\r\n\r\n> å¦‚ä½•å®ç°è¿™ä¸€ç‚¹å–å†³äºæ‰€ä½¿ç”¨çš„æ—¥å¿—è®°å½•å®ç°æ–¹å¼ã€‚æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨Log4Jæ¥å®ç°å®ƒã€‚é…ç½®æ—¥å¿—æœåŠ¡åªæ˜¯ç®€å•åœ°åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤–çš„é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚log4j.propertiesï¼‰å’Œæœ‰æ—¶ä¸€ä¸ªæ–°çš„JARæ–‡ä»¶ï¼ˆä¾‹å¦‚log4j.jarï¼‰ã€‚ä»¥ä¸‹ç¤ºä¾‹é…ç½®å°†ä½¿ç”¨Log4Jä½œä¸ºæä¾›è€…é…ç½®å®Œæ•´çš„æ—¥å¿—è®°å½•æœåŠ¡ã€‚å…±æœ‰2ä¸ªæ­¥éª¤ã€‚\r\n\r\n- ç¬¬ä¸€æ­¥ï¼šæ·»åŠ åŒ…\r\n\r\n- ç¬¬äºŒæ­¥ï¼šé…ç½®\r\n    log4j.propertiesæ–‡ä»¶\r\n```\r\n# Global logging configuration\r\nlog4j.rootLogger=ERROR, stdout\r\n# MyBatis logging configuration...\r\nlog4j.logger.com.hyh.dao.TestDao=TRACE\r\n# Console output...\r\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\r\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\r\nlog4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n\r\n    </textarea>\r\n    <div >æ‰“å°å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„æ—¥å¿—</div>\r\n    <textarea class=\"code\">\r\nXMLSelect\r\nOpening JDBC Connection\r\nSetting autocommit to false on JDBC Connection [oracle.jdbc.driver.T4CConnection@5c3b6c6e]\r\nDEBUG [main] - ==>  Preparing: SELECT * FROM mybatis_user\r\nDEBUG [main] - ==> Parameters:\r\nTRACE [main] - <==    Columns: ID, NAME, SEX, AGE\r\nTRACE [main] - <==        Row: 51, WWW, W, 10\r\nTRACE [main] - <==        Row: 45, WWW, W, 10\r\nTRACE [main] - <==        Row: 42, WWW, W, 10\r\n...\r\nDEBUG [main] - <==      Total: 10\r\nDEBUG [main] - ==>  Preparing: select * from mybatis_user where id = ?\r\nDEBUG [main] - ==> Parameters: 51(Integer)\r\nTRACE [main] - <==    Columns: ID, NAME, SEX, AGE\r\nTRACE [main] - <==        Row: 51, WWW, W, 10\r\nDEBUG [main] - <==      Total: 1\r\n[User{id=51, name=\'WWW\', sex=\'W\', age=10}, User{id=45, name=\'WWW\', sex=\'W\', age=10}, User{id=42, name=\'WWW\', sex=\'W\', age=10}, User{id=43, name=\'WWW\', sex=\'W\', age=10}, User{id=44, name=\'WWW\', sex=\'W\', age=10}, User{id=46, name=\'WWW\', sex=\'W\', age=10}, User{id=47, name=\'WWW\', sex=\'W\', age=10}, User{id=48, name=\'WWW\', sex=\'W\', age=10}, User{id=49, name=\'WWW\', sex=\'W\', age=10}, User{id=50, name=\'WWW\', sex=\'W\', age=10}]\r\nUser{id=51, name=\'WWW\', sex=\'W\', age=10}\r\nDEBUG [main] - ==>  Preparing: select mybatis_seq.nextVal from dual\r\nDEBUG [main] - ==> Parameters:\r\nTRACE [main] - <==    Columns: NEXTVAL\r\nTRACE [main] - <==        Row: 179\r\nDEBUG [main] - <==      Total: 1\r\nDEBUG [main] - ==>  Preparing: insert into mybatis_user values (?, ?, ?, ?)\r\nDEBUG [main] - ==> Parameters: 179(Integer), WWW(String), W(String), 10(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\nDEBUG [main] - ==>  Preparing: update mybatis_user SET name=?, sex=?, age=? where id=?\r\nDEBUG [main] - ==> Parameters: xxxpoipioip(String), op(String), 9(Integer), 51(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\nDEBUG [main] - ==>  Preparing: delete from mybatis_user where id = ?\r\nDEBUG [main] - ==> Parameters: 51(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\nDEBUG [main] - ==>  Preparing: delete from mybatis_user where id = ?\r\nDEBUG [main] - ==> Parameters: 45(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\n```\r\n\r\n<div >\r\n\r\nä¸Šé¢çš„æ–‡ä»¶å°†å¯¼è‡´log4Jå¯¹org.mybatis.example.BlogMapperæŠ¥å‘Šè¯¦ç»†çš„æ—¥å¿—ï¼Œè€Œå¯¹æ‚¨åº”ç”¨ç¨‹åºçš„å…¶ä½™ç±»åªæŠ¥å‘Šé”™è¯¯æ—¥å¿—ã€‚\r\n\r\nå¦‚æœæ‚¨æƒ³æ›´ç²¾ç»†åœ°è°ƒæ•´æ—¥å¿—è®°å½•çº§åˆ«ï¼Œå¯ä»¥ä¸ºç‰¹å®šè¯­å¥æ‰“å¼€æ—¥å¿—è®°å½•ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ˜ å°„å™¨æ–‡ä»¶ã€‚ä¾‹å¦‚ä¸‹é¢è¯­å¥åªå¯¹æ›´æ–°æ“ä½œæŠ¥å‘Šæ—¥å¿—ï¼š\r\n\r\n> log4j.logger.com.hyh.mapper.TestDao.update=TRACE\r\n\r\nå¦‚æœæƒ³å¯¹å¤šä¸ªmappersæ‰“å°æ—¥å¿—ï¼Œä½ å¯ä»¥å°†ä»¥ä¸Šæ¡ç›®ä¿®æ”¹ä¸ºå…¶åŒ…æ‰€åœ¨çš„æ ¹ç›®å½•\r\n\r\n> log4j.logger.com.hyh.dao=TRACE\r\n\r\næœ‰ä¸€äº›æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›å¤§é‡çš„ç»“æœé›†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æŸ¥çœ‹SQLè¯­å¥ï¼Œä½†ä¸éœ€è¦çœ‹åˆ°ç»“æœã€‚å‡ºäºè¿™ä¸ªç›®çš„ï¼ŒSQLè¯­å¥è¢«è®°å½•åœ¨DEBUGçº§åˆ«ï¼ˆåœ¨JDKæ—¥å¿—ä¸­æ˜¯FINEçº§åˆ«ï¼‰ï¼Œè€Œç»“æœåˆ™åœ¨TRACEçº§åˆ«ï¼ˆåœ¨JDKæ—¥å¿—ä¸­æ˜¯FINERçº§åˆ«ï¼‰è®°å½•ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³æŸ¥çœ‹è¯­å¥ä½†ä¸éœ€è¦æŸ¥çœ‹ç»“æœï¼Œå°†æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºDEBUGã€‚\r\n\r\n> log4j.logger.com.hyh.dao=DEBUG\r\n\r\n\r\n- debugè¾“å‡ºå†…å®¹\r\n </div>\r\n \r\n```\r\nDEBUG [main] - ==>  Preparing: select * from mybatis_user where id = ?\r\nDEBUG [main] - ==> Parameters: 51(Integer)\r\nDEBUG [main] - <==      Total: 1\r\n[User{id=51, name=\'WWW\', sex=\'W\', age=10}, User{id=45, name=\'WWW\', sex=\'W\', age=10}, User{id=42, name=\'WWW\', sex=\'W\', age=10}, User{id=43, name=\'WWW\', sex=\'W\', age=10}, User{id=44, name=\'WWW\', sex=\'W\', age=10}, User{id=46, name=\'WWW\', sex=\'W\', age=10}, User{id=47, name=\'WWW\', sex=\'W\', age=10}, User{id=48, name=\'WWW\', sex=\'W\', age=10}, User{id=49, name=\'WWW\', sex=\'W\', age=10}, User{id=50, name=\'WWW\', sex=\'W\', age=10}]\r\nUser{id=51, name=\'WWW\', sex=\'W\', age=10}\r\nDEBUG [main] - ==>  Preparing: select mybatis_seq.nextVal from dual\r\nDEBUG [main] - ==> Parameters:\r\nDEBUG [main] - <==      Total: 1\r\nDEBUG [main] - ==>  Preparing: insert into mybatis_user values (?, ?, ?, ?)\r\nDEBUG [main] - ==> Parameters: 188(Integer), WWW(String), W(String), 10(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\nDEBUG [main] - ==>  Preparing: update mybatis_user SET name=?, sex=?, age=? where id=?\r\nDEBUG [main] - ==> Parameters: xxxpoipioip(String), op(String), 9(Integer), 51(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\nDEBUG [main] - ==>  Preparing: delete from mybatis_user where id = ?\r\nDEBUG [main] - ==> Parameters: 51(Integer)\r\nDEBUG [main] - <==    Updates: 1\r\n```\r\n<div >\r\n<pre>\r\nåœ¨å¯¹æ—¥å¿—è®°å½•å¯¹è±¡çš„è®¾ç½®ä¸­å¦‚æœå¢åˆ æŸ¥æ”¹ä½¿ç”¨çš„æ˜¯æ¥å£é‚£ä¹ˆè®¾ç½®çš„å°±æ˜¯åŒ…åï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯xmlé‚£ä¹ˆè®¾ç½®çš„æ˜¯namespaceå’Œsqlè¯­å¥çš„idå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸¤è€…çš„è®¾ç½®å·®åˆ«ä¸å¤§ã€‚\r\n</pre>\r\n<h3>è¿æ¥æ± ï¼šå®ƒæ˜¯ä¸€ç§å¤šç”¨æˆ·é‡Šæ”¾èµ„æºçš„ç­–ç•¥</h3>\r\n<a href=\"https://blog.csdn.net/qq_30257081/article/details/86554585\">\r\n    https://blog.csdn.net/qq_30257081/article/details/86554585\r\n</a>\r\n<pre>\r\nè¿æ¥æ± çš„ä¼˜ç‚¹\r\n    1.èµ„æºé‡ç”¨\r\n    2.æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦\r\n    3.é¿å…æ•°æ®åº“è¿æ¥é—æ¼\r\nå®ƒå®šä¹‰çš„å·¥ä½œåŸç†\r\n    S1. å½“æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œåˆ›å»ºä¸€äº›è¿æ¥æ”¾åœ¨è¿æ¥æ± ä¸­ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ã€‚\r\n    S2. å½“å®¢æˆ·ç«¯å‘æ¥è¯·æ±‚éœ€è¦è¿æ¥æ•°æ®åº“æ—¶ï¼Œå®¹å™¨é¦–å…ˆæŸ¥çœ‹è¿æ¥æ± ä¸­æ˜¯å¦æœ‰å¯ç”¨çš„è¿æ¥ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿”å›å°†è¿æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰åˆ™æŸ¥çœ‹å½“å‰çš„è¿æ¥æ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§çš„å¯ç”¨è¿æ¥æ•°ã€‚å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œåˆ™åˆ›å»ºæ–°çš„é“¾æ¥è¿”å›ï¼›å¦‚æœè¶…è¿‡äº†ï¼Œåˆ™æŠ›å‡ºæ— å¯ç”¨è¿æ¥çš„å¼‚å¸¸ã€‚\r\n    S3. å½“è¿æ¥ä½¿ç”¨å®Œæ¯•åï¼Œè¿æ¥å†æ¬¡è¢«æ”¾å›åˆ°è¿æ¥æ± ä¸­ï¼Œä»è€Œå®ç°è¿æ¥çš„é‡ç”¨ã€‚\r\n</pre>\r\n\r\n1. dbcp<br>\r\n2. c3p0:åŸºäºdbcp<br>\r\n3. DBUtils:åŸºäºdbcpå’Œdbutil<br>\r\n4. druid:å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å›½æœ‰è¿æ¥æ± ï¼Œä¸­æ–‡åå¾·é²ä¼Š<br>\r\n\r\nå¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªè½»é‡çº§çš„è¿æ¥æ± ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨DBCPã€‚å¯¹äºæ›´é«˜çº§çš„è¿æ¥æ± ç®¡ç†åŠŸèƒ½ï¼ŒC3P0å’ŒDruidæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚DBUtilsåˆ™é€‚ç”¨äºéœ€è¦ç®€åŒ–JDBCæ“ä½œçš„åœºæ™¯ï¼Œé€šå¸¸ä¸å…¶å®ƒè¿æ¥æ± åº“(å¦‚DBCPæˆ–C3PO)ä¸€èµ·ä½¿ç”¨ã€‚\r\n- æ€§èƒ½æ¯”è¾ƒï¼š\r\n> druid > DBUtil > dbcp > c3p0\r\n<h4 id=\"dbcp\">1.dbcp</h4>\r\n        Apache DBCPï¼ˆDatabase Connection Poolï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„Javaè¿æ¥æ± åº“ï¼Œç”¨äºç®¡ç†å’Œç»´æŠ¤æ•°æ®åº“è¿æ¥ã€‚å®ƒçš„åº•å±‚å·¥ä½œåŸç†æ¶‰åŠä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶å’Œæ­¥éª¤ï¼š<br>\r\n\r\n1.`æ•°æ®æºï¼ˆDataSourceï¼‰`ï¼šDBCPä½¿ç”¨æ•°æ®æºæ¥åˆ›å»ºå’Œç®¡ç†æ•°æ®åº“è¿æ¥ã€‚æ•°æ®æºé€šå¸¸æ˜¯æ•°æ®åº“é©±åŠ¨ç¨‹åºæä¾›çš„å®ç°ã€‚æ•°æ®æºåŒ…å«æœ‰å…³å¦‚ä½•åˆ›å»ºå’Œé…ç½®è¿æ¥çš„ä¿¡æ¯ã€‚<br>\r\n\r\n2.`è¿æ¥æ± ï¼ˆConnection Poolï¼‰`ï¼šè¿æ¥æ± æ˜¯è¿æ¥çš„ç¼“å­˜ï¼Œå®ƒç»´æŠ¤ä¸€ç»„å¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ•°æ®åº“è¿æ¥ã€‚è¿æ¥æ± çš„å¤§å°å¯ä»¥é…ç½®ï¼Œä»¥ç¡®å®šå¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†é¿å…åå¤å¼€å¯/ç»“æŸå¯¹æ•°æ®åº“çš„è¿æ¥ï¼Œå…·æœ‰å³ç”¨æ€§ã€‚<br>\r\n\r\n3.`è¿æ¥æ± ç®¡ç†å™¨ï¼ˆPool Managerï¼‰`ï¼šè¿æ¥æ± ç®¡ç†å™¨è´Ÿè´£ç»´æŠ¤è¿æ¥æ± çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬åˆ›å»ºã€é‡Šæ”¾ã€å›æ”¶å’Œç®¡ç†è¿æ¥ã€‚å®ƒç¡®ä¿è¿æ¥çš„å¯ç”¨æ€§ï¼Œå¹¶é˜²æ­¢è¿æ¥æ³„æ¼å’Œèµ„æºæµªè´¹ã€‚<br>\r\n\r\n4.`è¿æ¥å·¥å‚ï¼ˆConnection Factoryï¼‰`ï¼šè¿æ¥å·¥å‚æ˜¯è´Ÿè´£åˆ›å»ºæ•°æ®åº“è¿æ¥çš„ç»„ä»¶ã€‚å®ƒä½¿ç”¨æ•°æ®æºé…ç½®ä¿¡æ¯æ¥åˆ›å»ºè¿æ¥ï¼Œå¹¶å°†è¿™äº›è¿æ¥æ·»åŠ åˆ°è¿æ¥æ± ä¸­ã€‚<br>\r\n\r\n5.`è¿æ¥çŠ¶æ€è·Ÿè¸ªï¼ˆConnection State Trackingï¼‰`ï¼šDBCPå¯ä»¥è·Ÿè¸ªè¿æ¥çš„çŠ¶æ€ï¼Œä»¥æ£€æµ‹é—²ç½®è¿æ¥ã€å¤±æ•ˆè¿æ¥å’Œè¶…æ—¶è¿æ¥ã€‚è¿™æœ‰åŠ©äºå›æ”¶å’Œé‡æ–°åˆ©ç”¨è¿æ¥ï¼Œä»¥å‡å°‘è¿æ¥çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€ã€‚<br>\r\n- è¿æ¥æ± é…ç½®ï¼šè¿æ¥æ± çš„é…ç½®å‚æ•°åŒ…æ‹¬æœ€å°è¿æ¥æ•°ã€æœ€å¤§è¿æ¥æ•°ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€é—²ç½®è¿æ¥æ£€æµ‹ç­‰ã€‚è¿™äº›å‚æ•°å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚<br>\r\n- è¿æ¥çš„è·å–å’Œé‡Šæ”¾ï¼šåº”ç”¨ç¨‹åºé€šè¿‡è¯·æ±‚è¿æ¥æ¥ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ï¼Œä½¿ç”¨å®Œåï¼Œå°†è¿æ¥é‡Šæ”¾å›æ± ä¸­ã€‚è¿æ¥æ± ç®¡ç†å™¨ä¼šç¡®ä¿è¿æ¥çš„æœ‰æ•ˆæ€§ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡æ–°åˆ›å»ºè¿æ¥æˆ–å›æ”¶ä¸å†ä½¿ç”¨çš„è¿æ¥ã€‚<br>\r\n<br>\r\n\r\n> æ€»çš„æ¥è¯´ï¼ŒDBCPé€šè¿‡ç»´æŠ¤è¿æ¥æ± ã€è·Ÿè¸ªè¿æ¥çŠ¶æ€å’Œæä¾›è¿æ¥ç®¡ç†åŠŸèƒ½ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥é«˜æ•ˆåœ°ä½¿ç”¨æ•°æ®åº“è¿æ¥ï¼Œå¹¶åœ¨éœ€è¦æ—¶åŠ¨æ€åˆ›å»ºå’Œé”€æ¯è¿æ¥ï¼Œä»è€Œé™ä½äº†æ•°æ®åº“è¿æ¥çš„å¼€é”€ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚<br>\r\n\r\n dbcpå®ç°æ·»åŠ åŒ…:\r\n- commons-dbcp:commons-dbcp\r\n- commons-pool:commons-pool\r\n- commons-collections:commons-collections\r\n\r\n > DBCPDataSourceFactoryç±»\r\n\r\n```\r\nimport org.apache.ibatis.datasource.pooled.PooledDataSourceFactory;\r\nimport org.apache.commons.dbcp.BasicDataSource;\r\n\r\npublic class DBCPDataSourceFactory extends PooledDataSourceFactory {\r\n\r\n    public DBCPDataSourceFactory() {\r\n        this.dataSource = new BasicDataSource();\r\n    }\r\n}\r\n```\r\n<div >\r\n    TransactionImplè‡ªå®šä¹‰ç±»çš„ä¿®æ”¹\r\n</div>\r\n\r\n```\r\n@Override\r\npublic Integer getTimeout() throws SQLException {\r\n    LOGGER.debug(() -> {\r\n        return \"HAMSTER Connection [\" + this.connection + \"] is checking timeout\";\r\n    });\r\n    return this.connection.createStatement().getQueryTimeout(); // å› ä¸ºDBCPæ²¡æœ‰å®ç°è·å–ç½‘ç»œè¶…æ—¶æ—¶é—´ï¼Œå°±åªèƒ½è·å–sqlè¯­å¥æ‰§è¡Œè¶…æ—¶æ—¶é—´\r\n}\r\n```\r\n<div ><h4>dbcp config-mybatis.xmlæ–‡ä»¶åŠå±æ€§å¤§å…¨</h4></div>\r\n\r\n```\r\n<dataSource type=\"com.hyh.dataSourceFactoryImpl.DBCPDataSourceFactory\">\r\n    <property name=\"driverClassName\" value=\"${oracle_driver}\"/>\r\n    <property name=\"url\" value=\"${oracle_url}\"/>\r\n    <property name=\"username\" value=\"${oracle_username}\"/>\r\n    <property name=\"password\" value=\"${oracle_password}\"/>\r\n\r\n    <!--åˆå§‹åŒ–è¿æ¥:è¿æ¥æ± å¯åŠ¨æ—¶åˆ›å»ºçš„åˆå§‹åŒ–è¿æ¥æ•°é‡-->\r\n    <property name=\"initialSize\" value=\"3\"/>\r\n\r\n    <!--æœ€å¤§æ´»è·ƒæ•°-->\r\n    <property name=\"maxActive\" value=\"20\"/>\r\n\r\n    <!--æœ€å¤§ç©ºé—²è¿æ¥:è¿æ¥æ± ä¸­å®¹è®¸ä¿æŒç©ºé—²çŠ¶æ€çš„æœ€å¤§è¿æ¥æ•°é‡,è¶…è¿‡çš„ç©ºé—²è¿æ¥å°†è¢«é‡Šæ”¾,å¦‚æœè®¾ç½®ä¸ºè´Ÿæ•°è¡¨ç¤ºä¸é™åˆ¶-->\r\n    <property name=\"maxIdle\" value=\"10\"/>\r\n\r\n    <!--æœ€å°ç©ºé—²è¿æ¥:è¿æ¥æ± ä¸­å®¹è®¸ä¿æŒç©ºé—²çŠ¶æ€çš„æœ€å°è¿æ¥æ•°é‡,è´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰ç°åœ¨-->\r\n    <!--å¦‚æœç©ºé—²è¿æ¥çš„æ•°é‡è®¾ç½®çš„å¤ªå°‘ä¸”ç³»ç»Ÿè´Ÿè½½é«˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´å®é™…çš„ç©ºé—²è¿æ¥è¶…è¿‡æœ€å¤§ç©ºé—²è¿æ¥çš„é™åˆ¶ï¼Œå› ä¸ºå…³é—­è¿æ¥çš„é€Ÿåº¦æ¯”æ‰“å¼€è¿æ¥çš„é€Ÿåº¦å¿«ï¼Œæ‰€ä»¥æœ‰è®¸å¤šè¢«å…³é—­çš„è¿æ¥ä¿æŒç©ºé—²ç­‰å¾…è¢«æ‰“å¼€çš„è¿æ¥ï¼Œè¿™å°±å¯¼è‡´äº†å®é™…ç©ºé—²è¿æ¥ä¼šå¤§äºæœ€å¤§ç©ºé—²è¿æ¥-->\r\n    <property name=\"minIdle\" value=\"2\"/>\r\n\r\n    <!--æœ€å¤§ç­‰å¾…æ—¶é—´:å½“æ²¡æœ‰å¯ç”¨è¿æ¥æ—¶,è¿æ¥æ± ç­‰å¾…è¿æ¥è¢«å½’è¿˜çš„æœ€å¤§æ—¶é—´(ä»¥æ¯«ç§’è®¡æ•°),è¶…è¿‡æ—¶é—´åˆ™æŠ›å‡ºå¼‚å¸¸,å¦‚æœè®¾ç½®ä¸º-1è¡¨ç¤ºæ— é™ç­‰å¾…-->\r\n    <property name=\"maxWait\" value=\"10000\"/>\r\n\r\n    <!--åœ¨å°†è¿æ¥è¿”å›ç»™è°ƒç”¨è€…ä¹‹å‰ï¼Œä¸€ä¸ªç”¨æ¥éªŒè¯ä»è¿æ¥æ± å–å‡ºè¿æ¥çš„å¯ç”¨æ€§çš„SQLæŸ¥è¯¢ï¼Œå¦‚æœæŒ‡å®š,åˆ™æŸ¥è¯¢å¿…é¡»æ˜¯ä¸€ä¸ªSELECTè¯­å¥å¹¶ä¸”å¿…é¡»è¿”å›è‡³å°‘ä¸€è¡Œè®°å½•-->\r\n    <property name=\"validationQuery\" value=\"select * from mybatis_user where id = 1\"/>\r\n\r\n    <!--æŒ‡æ˜æ˜¯å¦åœ¨ä»æ± ä¸­å–å‡ºè¿æ¥å‰è¿›è¡Œæ£€éªŒ,å¦‚æœæ£€éªŒå¤±è´¥,åˆ™ä»æ± ä¸­å»é™¤è¿æ¥å¹¶å°è¯•å–å‡ºå¦ä¸€ä¸ª.æ³¨æ„:è®¾ç½®ä¸ºtrueåå¦‚æœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸²-->\r\n    <property name=\"testOnBorrow\" value=\"true\"/>\r\n\r\n    <!--æŒ‡æ˜æ˜¯å¦åœ¨å½’è¿˜åˆ°æ± ä¸­å‰è¿›è¡Œæ£€éªŒ-->\r\n    <property name=\"testOnReturn\" value=\"true\"/>\r\n\r\n    <!--æŒ‡æ˜è¿æ¥æ˜¯å¦è¢«ç©ºé—²è¿æ¥æ’é”™å™¨(å¦‚æœæœ‰)è¿›è¡Œæ£€éªŒ.å¦‚æœæ£€æµ‹å¤±è´¥,åˆ™è¿æ¥å°†è¢«ä»æ± ä¸­å»é™¤.æ³¨æ„:è®¾ç½®ä¸ºtrueåå¦‚æœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸²-->\r\n    <property name=\"testWhileIdle\" value=\"true\"/>\r\n\r\n    <!--åœ¨æ¯æ¬¡ç©ºé—²è¿æ¥æ’é”™å™¨çº¿ç¨‹(å¦‚æœæœ‰)è¿è¡Œæ—¶æ£€æŸ¥çš„è¿æ¥æ•°é‡-->\r\n    <property name=\"numTestsPerEvictionRun\" value=\"3\"/>\r\n\r\n    <!--å¼€å¯prepared statementæ±  å¼€å¯éœ€è¦æ·»åŠ åŒ…ï¼šcommons-pool-1.6.jar-->\r\n    <property name=\"poolPreparedStatements\" value=\"true\"/>\r\n\r\n    <!--statementæ± åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿåˆ†é…çš„æ´»è·ƒprepared statementsçš„æœ€å¤§æ•°é‡,å¦‚æœè®¾ç½®ä¸º0è¡¨ç¤ºä¸é™åˆ¶\r\n            ä¸ºäº†é¿å…æœ€å¤§æ´»è·ƒprepared statementsè¶…è¿‡æœ€å¤§å¼€å¯æ¸¸æ ‡æ•°è€Œå¯¼è‡´çš„æ¸¸æ ‡è€—å°½ï¼Œè¯·ä¿è¯æœ€å¤§æ´»è·ƒæ•°å°äºæœ€å¤§å¼€å¯æ¸¸æ ‡æ•°-->\r\n    <property name=\"maxOpenPreparedStatements\" value=\"1000\"/>\r\n\r\n    <!--æ§åˆ¶PoolGuardæ˜¯å¦å®¹è®¸è·å–åº•å±‚è¿æ¥ é»˜è®¤falseä¸å¼€å¯, è¿™æ˜¯ä¸€ä¸ªæœ‰æ½œåœ¨å±é™©çš„åŠŸèƒ½, ä¸é€‚å½“çš„ç¼–ç ä¼šé€ æˆå±é™©.(å¯èƒ½å…³é—­åº•å±‚è¿æ¥æˆ–è€…åœ¨å®ˆæŠ¤è¿æ¥å·²ç»å…³é—­çš„æƒ…å†µä¸‹ç»§ç»­ä½¿ç”¨è¿æ¥).è¯·è°¨æ…ä½¿ç”¨,å¹¶ä¸”ä»…å½“éœ€è¦ç›´æ¥è®¿é—®é©±åŠ¨çš„æ‰©å±•åŠŸèƒ½æ—¶ä½¿ç”¨.æ³¨æ„:ä¸è¦ç›´æ¥å…³é—­åº•å±‚è¿æ¥,åªèƒ½å…³é—­åŸæœ¬çš„è¿æ¥.-->\r\n    <property name=\"accessToUnderlyingConnectionAllowed\" value=\"true\"/>\r\n\r\n    <!--æ ‡è®°æ˜¯å¦åˆ é™¤è¶…è¿‡removeAbandonedTimoutæ—¶é•¿è¿æ¥ï¼Œå¦‚æœè¿æ¥è¶…è¿‡æ—¶é•¿å°±ä¼šè¢«è§†ä½œè¢«æŠ›å¼ƒçš„è¿æ¥ã€‚è®¾ç½®è¯¥é¡¹å¯ä»¥è®©æœåŠ¡å™¨æœ‰ç©ºé—²å»æ¢å¤é…ç½®ç³Ÿç³•çš„åº”ç”¨è¿æ¥-->\r\n        <!--å¦‚æœå¼€å¯åˆ™è¿æ¥åœ¨è¢«æŠ›å¼ƒæ—¶å¯èƒ½è¢«å›æ”¶ï¼Œå½“ç©ºé—²æ•°<2ï¼Œæ´»è·ƒæ•°>æœ€å¤§æ´»è·ƒæ•° - 3æ—¶ä¸”ç©ºé—²æ—¶é—´å¤§äºremoveAbandonedTimeoutï¼Œå°±ä¼šè¢«å›æ”¶ï¼Œä½†å¦‚æœä¸€æ—¦åˆ›å»ºäº†åŠ¨æ€æˆ–è€…é™æ€çš„statementæˆ–è€…æ‰§è¡Œäº†ä»»ä½•ä¸€ä¸ªæŸ¥è¯¢ï¼Œç©ºé—²æ—¶é—´å°±ä¼šæ¸…ç©ºã€‚-->\r\n    <property name=\"removeAbandoned\" value=\"true\"/>\r\n\r\n    <!--å®šä¹‰ä¸ºè¢«æŠ›å¼ƒå¹¶åˆ é™¤çš„è¿æ¥å‰çš„æœ€å¤§æ—¶é•¿-->\r\n    <property name=\"removeAbandonedTimeout\" value=\"500\"/>\r\n\r\n    <!--æ˜¯å¦ä¸ºè¢«æŠ›å¼ƒçš„è¿æ¥æˆ–è€…Statementç”Ÿæˆæ—¥å¿—ï¼Œè¯¥æ—¥å¿—ä¼šåœ¨æ¯ä¸ªè¿æ¥æˆ–è€…Statementå¼€å¯çš„æ—¶å€™ä¸æ–­å åŠ ï¼Œå› ä¸ºæ—¥å¿—çš„ç”Ÿæˆä¾èµ–äºå †æ ˆä¿¡æ¯çš„ç”Ÿæˆã€‚-->\r\n    <property name=\"logAbandoned\" value=\"true\"/>\r\n\r\n</dataSource>\r\n```\r\n<div >\r\n      <h4>2. c3p0</h4>\r\n      åœ¨ <a href=\"#dataSource\">ä¹‹å‰</a> ä½¿ç”¨è¿‡çš„ç±»çš„å›¾è¡¨<br>\r\n<!--        <img src=\"c0p3diagram.png\"/>-->\r\n<img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/c3p02.png\" width=\"100%\"/>\r\n\r\n ##### C3POä¸DBCPçš„åŒºåˆ«\r\n + C3P0æœ‰è‡ªåŠ¨å›æ”¶ç©ºé—²è¿æ¥åŠŸèƒ½ï¼ŒDBCPæ²¡æœ‰ã€‚\r\n     - maxIdleTimeï¼šå®šä¹‰è¿æ¥åœ¨æ± ä¸­ä¿æŒç©ºé—²çš„æœ€é•¿æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸å¯ç”¨ç©ºé—²è¿æ¥çš„å›æ”¶ã€‚\r\n     - maxIdleTimeExcessConnectionsï¼šå®šä¹‰åœ¨è¿æ¥æ± ä¸­ä¿æŒç©ºé—²çš„è¶…å‡ºæœ€å°è¿æ¥æ•°çš„è¿æ¥çš„æœ€é•¿æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ã€‚\r\n     - maxConnectionAgeï¼šå®šä¹‰è¿æ¥åœ¨æ± ä¸­çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬ä½¿ç”¨å’Œç©ºé—²æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶è¿æ¥å¯¿å‘½ã€‚\r\n - C3P0æä¾›æœ€å¤§ç©ºé—²æ—¶é—´ï¼ŒDBCPæä¾›æœ€å¤§è¿æ¥æ•°ã€‚\r\n ä¹Ÿå°±æ˜¯è¯´C3P0åœ¨è¿æ¥å›æ”¶æ–¹ä¾¿æ›´å¤æ‚ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½è¡¨ç°ï¼šDBCP > C3P0\r\n\r\n> è¿æ¥ä»£ç†ç±»ï¼š\r\n\r\n```\r\n    com.mchange.v2.c3p0.impl.NewProxyConnection@d554c5f [wrapping: oracle.jdbc.driver.T4CConnection@48fd1fe4]\r\n```\r\n<div >\r\n    <h4>3. DBUtil</h4>\r\n<pre class=\"preText\">\r\nDBUtilçš„å®šä¹‰ï¼šDBUtil è¿æ¥æ± æ˜¯ä¸€ä¸ªé€šç”¨çš„æ•°æ®åº“è¿æ¥æ± ç®¡ç†å·¥å…·ï¼Œç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥çš„åˆ›å»ºã€ä½¿ç”¨å’Œé‡Šæ”¾ï¼Œç®¡ç†å®ƒçš„ç”Ÿå‘½å‘¨æœŸã€‚è¿æ¥æ± çš„ä¸»è¦ç›®æ ‡æ˜¯æé«˜æ•°æ®åº“è¿æ¥çš„é‡å¤åˆ©ç”¨ç‡å’Œæ€§èƒ½ï¼Œå‡å°‘æ¯æ¬¡æ•°æ®åº“æ“ä½œéƒ½é‡æ–°åˆ›å»ºå’Œå…³é—­è¿æ¥çš„å¼€é”€ã€‚\r\næœ¬è´¨ï¼šåŸºäºDBCP | C3P0 | å¾·é²ä¼Šè¿æ¥æ± ï¼Œå¯¹æ•°æ®åº“å­˜å–çš„æ–¹æ³•ç»è¡Œäº†ç®€å•å°è£…ï¼Œå®ƒå¯¹è¿æ¥æ± ä¸­è¿æ¥çš„æ“ä½œä¸éœ€è¦ä¾é mybatis\r\n    â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n    æ¯”è¾ƒä¸€ä¸‹ JDBC, dbutils, Mybatis å’Œ Hibernate\r\n    JDBC: åŸç”Ÿè®¿é—®æ•°æ®åº“çš„æ–¹å¼, å…¶å®ƒä¸‰ä¸ªéƒ½æ˜¯å¯¹ JDBC ä¸åŒç¨‹åº¦çš„åŒ…è£… è®¿é—®æ•°æ®åº“æ¯”è¾ƒéº»çƒ¦, ä»£ç é‡å¤åº¦æé«˜\r\n    dbutils: æ˜¯å¯¹jdbcè¿›è¡Œäº†ç›¸å¯¹ç®€å•çš„åŒ…è£…, ä¸»è¦å°±æ˜¯èƒ½è‡ªåŠ¨å°è£…æŸ¥è¯¢ç»“æ„ é›†, éœ€è¦åœ¨ä»£ç ä¸­å†™ sql è¯­å¥\r\n    Mybatis: è¿›ä¸€æ­¥å°è£… jdbc, Sql è¯­å¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­, é¢å‘å¯¹è±¡æ“ä½œ, æœ‰ä¸€ äºŒçº§ç¼“å­˜åŠŸèƒ½\r\n    Hibernate: å¯¹ jdbc å°è£…å¾—æœ€å½»åº•çš„æ¡†æ¶, çº¯é¢å‘å¯¹è±¡, å¯ä»¥ä¸ç”¨å†™ SQL\r\n        â€”â€”â€”â€”â€”â€”â€”\r\n        ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œjkljkilã€çš„åŸåˆ›æ–‡ç« ã€‚\r\n        åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/jkljkil/article/details/110723911\r\n    â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\nç”Ÿå‘½å‘¨æœŸï¼š\r\n    åˆå§‹åŒ– -> è·å– -> æ“ä½œ -> é‡Šæ”¾\r\n    è¿æ¥æ± ç®¡ç†ï¼šè¶…æ—¶å¤„ç† -> è¿æ¥éªŒè¯ -> è¿æ¥è‡ªåŠ¨å›æ”¶\r\n    é”€æ¯ï¼šé‡Šæ”¾è¿æ¥ -> é”€æ¯è¿æ¥æ± \r\nDBUtilå’Œ (DBCP | C3P0) ç›¸æ¯”\r\n    1. dbutilæ›´è½»é‡ï¼Œæ¯”å¦å¤–ä¸¤ä¸ªå°ã€‚\r\n    2. DBCPå’ŒC3P0éƒ½ç›¸å¯¹æˆç†Ÿï¼Œæœ‰è¾ƒä¸°å¯Œçš„ç¤¾åŒºæ”¯æŒå’Œæ´»è·ƒåº¦ï¼Œæ›´å®¹æ˜“è·å¾—æ›´æ–°ä¿®å¤BUGã€‚\r\n    3. å®ƒçš„æ€§èƒ½æ›´å¥½ã€‚\r\n</pre>\r\n- æ·»åŠ åŒ…ï¼š\r\n	- commons-dbutils-1.7.jar\r\n	- log4j-apiçš„ç‰ˆæœ¬éœ€è¦ä¸º2.17.1åŠä»¥ä¸‹ï¼Œå¦åˆ™æ‰¾ä¸åˆ°java.util.Stack org.apache.logging.log4j.util.StackLocatorUtil.getCurrentStackTrace()\r\n\r\n> æ³¨æ„ï¼šIDEAé‡Œé¢propertiesæ–‡ä»¶å®¹æ˜“ä¹±ç ï¼Œè¦åŠæ—¶è°ƒæ•´åœ¨ï¼šSettings -> Editor -> File encoding\r\n- æµ‹è¯•æ–‡ä»¶(ä½¿ç”¨äº†ä¹‹å‰æåˆ°è¿‡çš„DataSourceFactoryImplç±»)ï¼š\r\n</div>\r\n\r\n```\r\n@Test\r\npublic void testDBUtil() { //RUN UNDER JAVA 11!! --ADD MODULE JAVA-BASE --Add java-module... == all resolved by alt + enter >><<   ---> close by Settings > Build > Execution, Deployment > Compiler > Java Compiler åˆ é™¤å®šä¹‰çš„é‚£ä¸€æ¡\r\n    DataSourceFactoryImpl dsfi = new DataSourceFactoryImpl(); //ä¸ºDBUtilå°è£…çš„å·¥å…·æä¾›DataSource\r\n    Properties properties = new Properties();\r\n    try {\r\n        FileInputStream fis = new FileInputStream(\"F:\\\\JAVA\\\\20230925\\\\testMybatis\\\\src\\\\c3p0config.properties\");\r\n        properties.load(fis);\r\n    } catch (IOException e) {\r\n        e.printStackTrace();\r\n    }\r\n    dsfi.setProperties(properties);\r\n    QueryRunner qr = new QueryRunner(dsfi.getDataSource());\r\n\r\n    try {\r\n        List<User> li = (List<User>) qr.query(\"select * from mybatis_user\", new BeanListHandler(User.class));\r\n        System.out.println(li);\r\n    } catch (Exception e) {\r\n        e.printStackTrace();\r\n    }\r\n\r\n}\r\n```\r\n<div >c3p0config.propertiesæ–‡ä»¶</div>\r\n\r\n```\r\n#<!-- oracleä»¥åŠåå°„ç±»çš„å±æ€§ -->\r\ndriverClass=oracle.jdbc.driver.OracleDriver\r\njdbcUrl=jdbc:oracle:thin:@localhost:1521:orcl\r\nuser=hyh\r\npassword=123456\r\n```\r\n<div >è¾“å‡ºæ—¥å¿—ä¸ºDBUtilç‰¹æœ‰çš„ï¼Œå¦‚ä¸‹ï¼š</div>\r\n\r\n```\r\nC:\\Users\\AJH41\\.jdks\\corretto-11.0.20.1\\bin\\java.exe -ea -Didea.test.cyclic.buffer.size=1048576 \"-javaagent:F:\\IntelliJ IDEA 2021.2.3\\lib\\idea_rt.jar=7457:F:\\IntelliJ IDEA 2021.2.3\\bin\" -Dfile.encoding=UTF-8 -classpath \"F:\\IntelliJ IDEA 2021.2.3\\lib\\idea_rt.jar;F:\\IntelliJ IDEA 2021.2.3\\plugins\\junit\\lib\\junit5-rt.jar;F:\\IntelliJ IDEA 2021.2.3\\plugins\\junit\\lib\\junit-rt.jar;F:\\JAVA\\20230925\\testMybatis\\out\\production\\testMybatis;F:\\JAVA\\20230925\\testMybatis\\lib\\ojdbc8.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\c3p0-0.9.5.5.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\log4j-1.2.17.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\mybatis-3.5.8.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\aopalliance-1.0.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\commons-dbcp-1.4.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\log4j-api-2.17.1.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\slf4j-api-1.7.32.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-dao-2.0.1.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\log4j-core-2.11.2.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\commons-dbutils-1.7.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\commons-logging-1.2.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\mybatis-spring-2.0.1.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-tx-5.2.3.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-aop-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-orm-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-web-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-core-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-beans-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\mchange-commons-java-0.2.20.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-webmvc-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\commons-collections-20040616.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\commons-pool-20030825.183949.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-context-5.2.5.RELEASE.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\log4j-slf4j-impl-3.0.0-alpha1.jar;F:\\JAVA\\20230925\\testMybatis\\lib\\spring-expression-5.2.5.RELEASE.jar;C:\\Users\\AJH41\\.m2\\repository\\junit\\junit\\4.13.1\\junit-4.13.1.jar;C:\\Users\\AJH41\\.m2\\repository\\org\\hamcrest\\hamcrest-core\\1.3\\hamcrest-core-1.3.jar;C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\lib\\jsp-api.jar;C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\lib\\servlet-api.jar\" com.intellij.rt.junit.JUnitStarter -ideVersion5 -junit4 com.hyh.test.TestUnderJava11,testDBUtil\r\n2023-10-07 13:12:23 INFO  MLog:212 - MLog clients using slf4j logging.\r\n2023-10-07 13:12:23 DEBUG MLog:207 - Reading VM config for path list /com/mchange/v2/log/default-mchange-log.properties, /mchange-commons.properties, /c3p0.properties, hocon:/reference,/application,/c3p0,/, /mchange-log.properties, /\r\n2023-10-07 13:12:23 DEBUG MLog:207 - The configuration file for resource identifier \'/mchange-commons.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MLog:207 - The configuration file for resource identifier \'/c3p0.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MLog:207 - The configuration file for resource identifier \'hocon:/reference,/application,/c3p0,/\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MConfig:207 - The configuration file for resource identifier \'/mchange-commons.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MLog:207 - The configuration file for resource identifier \'/mchange-log.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MConfig:207 - The configuration file for resource identifier \'/mchange-log.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MConfig:207 - The configuration file for resource identifier \'hocon:/reference,/application,/c3p0,/\' could not be found. Skipping.\r\n2023-10-07 13:12:23 DEBUG MConfig:207 - The configuration file for resource identifier \'/c3p0.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:24 INFO  C3P0Registry:212 - Initializing c3p0-0.9.5.5 [built 11-December-2019 22:18:33 -0800; debug? true; trace: 10]\r\n2023-10-07 13:12:24 DEBUG DynamicPooledDataSourceManagerMBean:204 - MBean: com.mchange.v2.c3p0:type=PooledDataSource,identityToken=1hgeby9az2devs5yqoxvu|386f0da3,name=1hgeby9az2devs5yqoxvu|386f0da3 registered.\r\n2023-10-07 13:12:24 DEBUG DynamicPooledDataSourceManagerMBean:204 - MBean: com.mchange.v2.c3p0:type=PooledDataSource,identityToken=1hgeby9az2devs5yqoxvu|386f0da3,name=1hgeby9az2devs5yqoxvu|386f0da3 unregistered, in order to be reregistered after update.\r\n2023-10-07 13:12:24 DEBUG DynamicPooledDataSourceManagerMBean:204 - MBean: com.mchange.v2.c3p0:type=PooledDataSource,identityToken=1hgeby9az2devs5yqoxvu|386f0da3,name=1hgeby9az2devs5yqoxvu|386f0da3 registered.\r\nsetting\r\n2023-10-07 13:12:24 INFO  AbstractPoolBackedDataSource:212 - Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 3, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, contextClassLoaderSource -> caller, dataSourceName -> 1hgeby9az2devs5yqoxvu|386f0da3, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> oracle.jdbc.driver.OracleDriver, extensions -> {}, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, forceSynchronousCheckins -> false, forceUseNamedDriverClass -> false, identityToken -> 1hgeby9az2devs5yqoxvu|386f0da3, idleConnectionTestPeriod -> 0, initialPoolSize -> 3, jdbcUrl -> jdbc:oracle:thin:@localhost:1521:orcl, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 0, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 15, maxStatements -> 0, maxStatementsPerConnection -> 0, minPoolSize -> 3, numHelperThreads -> 3, preferredTestQuery -> null, privilegeSpawnedThreads -> false, properties -> {password=******, user=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]\r\n2023-10-07 13:12:24 DEBUG MConfig:207 - The configuration file for resource identifier \'/mchange-commons.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:24 DEBUG MConfig:207 - The configuration file for resource identifier \'/mchange-log.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:24 DEBUG MConfig:207 - The configuration file for resource identifier \'/c3p0.properties\' could not be found. Skipping.\r\n2023-10-07 13:12:24 DEBUG MConfig:207 - The configuration file for resource identifier \'hocon:/reference,/application,/c3p0,/\' could not be found. Skipping.\r\n2023-10-07 13:12:24 DEBUG BasicResourcePool:204 - com.mchange.v2.resourcepool.BasicResourcePool@74a6a609 config: [start -> 3; min -> 3; max -> 15; inc -> 3; num_acq_attempts -> 30; acq_attempt_delay -> 1000; check_idle_resources_delay -> 0; max_resource_age -> 0; max_idle_time -> 0; excess_max_idle_time -> 0; destroy_unreturned_resc_time -> 0; expiration_enforcement_delay -> 0; break_on_acquisition_failure -> false; debug_store_checkout_exceptions -> false; force_synchronous_checkins -> false]\r\n2023-10-07 13:12:24 DEBUG C3P0PooledConnectionPoolManager:204 - Created new pool for auth, username (masked): \'hy******\'.\r\n2023-10-07 13:12:24 DEBUG BasicResourcePool:204 - acquire test -- pool size: 0; target_pool_size: 3; desired target? 1\r\n2023-10-07 13:12:24 DEBUG BasicResourcePool:204 - awaitAvailable(): [unknown]\r\n[User{id=387, name=\'sss\', sex=\'sdf\', age=80}, User{id=391, name=\'sss\', sex=\'sdf\', age=80}, User{id=395, name=\'sss\', sex=\'sdf\', age=80}, User{id=379, name=\'sss\', sex=\'sdf\', age=80}, User{id=383, name=\'sss\', sex=\'sdf\', age=80}, User{id=2, name=\'xx\', sex=\'pp\', age=100}, User{id=1, name=\'xx\', sex=\'pp\', age=100}, User{id=403, name=\'sss\', sex=\'sdf\', age=80}, User{id=407, name=\'sss\', sex=\'sdf\', age=80}, User{id=411, name=\'sss\', sex=\'sdf\', age=80}, User{id=415, name=\'sss\', sex=\'sdf\', age=80}, User{id=436, name=\'sss\', sex=\'sdf\', age=80}, User{id=399, name=\'sss\', sex=\'sdf\', age=80}, User{id=419, name=\'sss\', sex=\'sdf\', age=80}, User{id=423, name=\'sss\', sex=\'sdf\', age=80}, User{id=397, name=\'sss\', sex=\'sdf\', age=80}, User{id=398, name=\'sss\', sex=\'sdf\', age=80}, User{id=443, name=\'sss\', sex=\'sdf\', age=80}, User{id=447, name=\'sss\', sex=\'sdf\', age=80}, User{id=400, name=\'sss\', sex=\'sdf\', age=80}, User{id=427, name=\'sss\', sex=\'sdf\', age=80}, User{id=431, name=\'sss\', sex=\'sdf\', age=80}, User{id=433, name=\'sss\', sex=\'sdf\', age=80}]\r\n\r\nProcess finished with exit code 0\r\n```\r\n<div >\r\n    <h4>4. druid</h4>\r\n<pre class=\"preText\">\r\nå®šä¹‰ï¼šDruidæ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºè¿æ¥æ± ç»„ä»¶ï¼Œæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¿æ¥æ± ä¹‹ä¸€ã€‚Druidèƒ½å¯¹æ•°æ®åº“è¿æ¥è¿›è¡Œæœ‰æ•ˆç®¡ç†å’Œé‡ç”¨ï¼Œæœ€å¤§åŒ–ç¨‹åºæ‰§è¡Œçš„æ•ˆç‡ã€‚è¿æ¥æ± è´Ÿè´£åˆ›å»ºå’Œç®¡ç†è¿æ¥ï¼Œç¨‹åºåªè´Ÿè´£å–ç”¨ä¸å½’è¿˜ã€‚\r\nä¼˜åŠ¿ï¼šå®ƒæ˜¯Javaè¯­è¨€ä¸­åŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½ä¼˜ç§€çš„æ•°æ®åº“è¿æ¥æ± ä¹‹ä¸€ã€‚Druidè¿æ¥æ± ç»“åˆäº†C3P0ã€DBCPç­‰æ•°æ®åº“è¿æ¥æ± çš„ä¼˜ç‚¹ã€‚\r\n    druidå’Œå‰ä¸¤ä¸ªè¿æ¥æ± çš„å¯¹æ¯”ï¼šdruidåŠŸèƒ½å¼ºå¤§ï¼Œæ€§èƒ½æœ€å¼ºï¼Œå…·æœ‰æå¼ºçš„æ‰©å±•æ€§\r\n        å‚è€ƒæ•°æ®ï¼šhttps://blog.51cto.com/u_15553139/5205148\r\n        æ€»ç»“å¦‚ä¸‹ï¼š\r\n        åœ¨è·å–è¿æ¥çš„æ—¶é—´æ–¹é¢ï¼šdruid > c3p0 > dbcp\r\n        åœ¨åŠŸèƒ½æ‹“å±•æ–¹ä¾¿ï¼šdruid > dbcp > c3p0 ä¹Ÿå°±æ˜¯è¯´druidå¯ä»¥æ‰©å±•å¾ˆå¤šæ’ä»¶\r\nè·å–æ•°æ®æºï¼š\r\n    ä½¿ç”¨com.alibaba.druid.pool.DruidDataSourceç±»æ¥åˆ›å»ºæ–°çš„æ•°æ®æºï¼Œå…·ä½“å±æ€§å¯ä»¥åœ¨ç±»é‡Œé¢æŸ¥çœ‹åˆ°\r\n        ç±»é‡Œé¢ä½¿ç”¨çš„å˜é‡\r\n            protected volatile String username; ---volatile çš„ä¿®æ”¹å’Œè¯»å–éƒ½æ˜¯ç›´æ¥é’ˆå¯¹ä¸»å­˜ï¼Œä¸”æ“ä½œä¸ä¼šè¢«é‡æ–°æ’åºä¼˜åŒ–ï¼Œå¯¹æ‰€æœ‰çº¿ç¨‹éƒ½å…·æœ‰å¯è§æ€§\r\n            protected volatile String password;\r\n            protected volatile String jdbcUrl;\r\n            protected volatile String driverClass;\r\n        ç±»å˜é‡ä½¿ç”¨çš„æ¥å£\r\n            void setDriverClassName(String driverClass)\r\n            void setUrl(String jdbcUrl)\r\n            void setUsername(String username)\r\n            void setPassword(String password)\r\n        å®éªŒç»“è®ºï¼šå¯¹è¿™äº›å±æ€§çš„æ“ä½œè¦åŸºäºå®ƒçš„æ¥å£åç§°\r\næ·»åŠ åŒ…ï¼š\r\n    - druid-1.2.18.jar\r\n</pre>\r\n\r\n- DruidDataSourceç±»\r\n</div>\r\n\r\n```\r\nimport com.alibaba.druid.pool.DruidDataSourceFactory;\r\nimport org.apache.ibatis.datasource.DataSourceFactory;\r\n\r\nimport javax.sql.DataSource;\r\nimport java.util.Properties;\r\n\r\n// https://blog.csdn.net/m0_70031574/article/details/131947655\r\npublic class DruidDataSource implements DataSourceFactory { // java: illegal character: \'\\ufeff\' remove BOM in File Editor and recreate file\r\n\r\n    private DataSource dataSource;\r\n    private Properties properties;\r\n\r\n    public DruidDataSource() {\r\n    }\r\n\r\n    @Override\r\n    public void setProperties(Properties properties) {\r\n        this.properties = properties;\r\n        try {\r\n            this.dataSource = DruidDataSourceFactory.createDataSource(properties);\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public DataSource getDataSource() {\r\n        return this.dataSource;\r\n    }\r\n}\r\n```\r\n- mybatis-config.xmlæ–‡ä»¶\r\n\r\n```\r\n<dataSource type=\"com.hyh.dataSourceFactoryImpl.DruidDataSource\">\r\n            <property name=\"driver\" value=\"${oracle_driver}\"/>\r\n            <property name=\"url\" value=\"${oracle_url}\"/>\r\n            <property name=\"username\" value=\"${oracle_username}\"/>\r\n            <property name=\"password\" value=\"${oracle_password}\"/>\r\n</dataSource>\r\n```\r\n\r\n<div >\r\n    <h3>ssh/ss(h)mï¼šssh/ss(h)m/springå¯¹æ•°æ®åº“äº‹åŠ¡çš„å¤„ç†</h3>\r\n<h4>1. ssh</h4>\r\n<pre class=\"preText\">\r\nsshçš„å®šä¹‰ï¼šStruts + Spring + Hibernate\r\n    Structsï¼šæµç¨‹æ§åˆ¶\r\n    Springï¼šä¸šåŠ¡æµè½¬\r\n    Hibernateï¼šæ•°æ®åº“æ“ä½œçš„å°è£…\r\n        è¿™é‡Œä»‹ç»ä¸€ä¸‹Hibernate:\r\n            é¦–å…ˆï¼Œå®ƒæ˜¯å¯¹ jdbc å°è£…å¾—æœ€å½»åº•çš„æ¡†æ¶, çº¯é¢å‘å¯¹è±¡, å¯ä»¥ä¸ç”¨å†™ SQLã€‚\r\n            å…¶æ¬¡ï¼Œæ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨çš„ormæ¡†æ¶ï¼Œhibernateå¯ä»¥è‡ªåŠ¨ç”ŸæˆSQLè¯­å¥ï¼Œè‡ªåŠ¨æ‰§è¡Œï¼Œä½¿å¾—Javaç¨‹åºå‘˜å¯ä»¥éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨å¯¹è±¡ç¼–ç¨‹æ€ç»´æ¥æ“çºµæ•°æ®åº“ã€‚ Hibernateå¯ä»¥åº”ç”¨åœ¨ä»»ä½•ä½¿ç”¨JDBCçš„åœºåˆï¼Œæ—¢å¯ä»¥åœ¨Javaçš„å®¢æˆ·ç«¯ç¨‹åºä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨Servlet/JSPçš„Webåº”ç”¨ä¸­ä½¿ç”¨ï¼Œæœ€å…·é©å‘½æ„ä¹‰çš„æ˜¯ï¼ŒHibernateå¯ä»¥åœ¨åº”ç”¨EJBçš„JavaEEæ¶æ„ä¸­å–ä»£CMPï¼Œå®Œæˆæ•°æ®æŒä¹…åŒ–çš„é‡ä»»ã€‚\r\n                EJB: Enterprise JavaBeans\r\n                    åˆ†å¸ƒå¼ä¼ä¸šçº§åº”ç”¨ç¨‹åºçš„Javaç»„ä»¶æ¨¡å‹ï¼ŒåŒ…å«Session Beanï¼ŒEntity(å®ä½“) Beanç­‰ç»„ä»¶\r\n                CMP: Container-Managed Persistence(è¢«å®¹å™¨ç®¡ç†çš„æŒä¹…æ€§[æ¨¡å‹])\r\n                    ä¾‹å¦‚ï¼ŒEntity Beanå°±å…·æœ‰æŒä¹…æ€§\r\n                JavaEE: Java Platform, [Enterprise Edition]\r\n                    å®ƒçš„è§„èŒƒåŒ…å«å„ç§æŒä¹…æ€§å’Œé€šä¿¡API\r\n                        é€šä¿¡APIä¾‹å¦‚TCP/UDP\r\nç±»åˆ«ï¼šå±äºMVCè½¯ä»¶å¼€å‘æ¨¡å¼\r\n>> ç¿»è¯‘ï¼ˆåŸºäºCHATGPTï¼‰https://www.codejava.net/frameworks/struts/struts-2-spring-4-hibernate-4-integration-tutorial-part-1-xml-configuration\r\n</pre>\r\n\r\n#### SSHæ•™å­¦ ç¬¬ä¸€éƒ¨åˆ†ï¼ˆXMLé…ç½®ï¼‰\r\n\r\nè¯¥æ•™å­¦é¡¹ç›®çš„ç›®çš„ä¸ºä»æ•°æ®åº“é‡Œæ‰“å°ä¸€å¼ è¡¨é‡Œçš„æ‰€æœ‰äº§å“åˆ°JSPé¡µé¢ï¼Œå®ƒä¼šå¸®åŠ©æˆ‘ä»¬ç†è§£åœ¨è¿™ç§é«˜é›†æˆçš„ç¯å¢ƒä¸‹ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚\r\n\r\nä¸ºä»€ä¹ˆè¦é›†æˆStrutsã€Springå’ŒHibernateï¼Ÿ\r\n    Strutsæ˜¯ä¸€ä¸ªWebåº”ç”¨ç¨‹åºæ¡†æ¶ï¼ŒSpringæ˜¯ä¸€ä¸ªä¼ä¸šåº”ç”¨ç¨‹åºæ¡†æ¶ï¼ŒHibernateæ˜¯ä¸€ä¸ªORMï¼ˆå¯¹è±¡å’Œæ•°æ®åº“çš„æ•°æ®æ˜ å°„å’Œè½¬æ¢ï¼‰æ¡†æ¶ã€‚Hibernateåœ¨æ•°æ®åº“å±‚å·¥ä½œï¼Œè€ŒStrutså’ŒSpringéƒ½å¯ä»¥åœ¨Webå±‚å·¥ä½œã€‚Springæ¯”Strutsæ›´å¼ºå¤§ï¼Œå®ƒå¯ä»¥æ›¿ä»£Strutsã€‚å› æ­¤ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨Springå’ŒHibernateå¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå°±ä¸éœ€è¦å†ä½¿ç”¨Strutsäº†ï¼\r\n    è¿™ç§é›†æˆåªå¯¹ä»¥Strutsæ„å»ºçš„æ—§é¡¹ç›®æ‰æ˜¯å¿…è¦çš„ï¼Œç°åœ¨ä½ å¿…é¡»å°†å®ƒä»¬å‡çº§ä¸ºSpringå’ŒHibernateï¼ŒåŒæ—¶ä¿ç•™Strutsã€‚å› æ­¤ï¼Œåœ¨å®é™…ä¸­å¾ˆå°‘æœ‰Struts-Spring-Hibernateåº”ç”¨ç¨‹åºã€‚\r\n\r\nStrutsã€Springå’ŒHibernateçš„é›†æˆæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\r\n    åœ¨è¿™ç§é›†æˆä¸­ï¼ŒStrutsåº”è¯¥å……å½“è°ƒåº¦è¿‡æ»¤å™¨çš„è§’è‰²ï¼Œæ‹¦æˆªæ‰€æœ‰è¿›å…¥åº”ç”¨ç¨‹åºçš„è¯·æ±‚ã€‚Springåº”è¯¥ä½œä¸ºä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œè¿˜ç®¡ç†Hibernateä¼šè¯å¹¶æä¾›äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚\r\n    æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼ŒStrutsçš„Actionç±»ç”±Springç®¡ç†ã€‚å› æ­¤ï¼ŒStrutsä¸­æ˜ å°„çš„æ“ä½œå¯ä»¥ç»‘å®šä¸€ä¸ªSpring beanã€‚è¿™åªèƒ½é€šè¿‡ä½¿ç”¨Strutsæä¾›çš„Springæ’ä»¶æ¥å®ç°ã€‚\r\n\r\né¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ã€‚\r\n\r\noracleè¡¨ç»“æ„ï¼š\r\n```\r\n1 create table product(\r\n2  id number(11) primary key,\r\n3  name varchar2(128) not null,\r\n4  description varchar2(512) not null,\r\n5  price number(10,2) not null);\r\n```\r\n\r\n> æ³¨æ„strutçš„åå­—å¿µ /strÊŒt/ è€Œä¸æ˜¯ /strÊŒkt/ ï¼Œå®ƒçš„æ„è¯å’Œstructureè¿™äº›æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶å«strut.xmlï¼Œè¿™ä¸ªBUGæˆ‘æ’æŸ¥äº†å°†è¿‘åŠå¤©ï¼Œæœ€è¿‘æ€ä¹ˆè€æ‰“é”™è€Œä¸”è¿˜åŠå¤©æ‰¾ä¸åˆ°ï¼Œçœ‹æ¥è¯¥å›ç‚‰é‡é€ äº†ã€‚\r\n\r\nä¸‹é¢ä¸ºé¡¹ç›®ç»“æ„ï¼š\r\n\r\n<img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/sshProjectStructure.png\" style=\"width: 35%\">\r\n<img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/sshProjectStructure2.png\" style=\"width: 35% ; position : absolute ; margin-left : 2%\">\r\n<pre class=\"preText\">\r\nNOTE: é¡¹ç›®ä¸­çš„log4j.propertiesåªæœ‰åœ¨resourceså†…éƒ¨çš„ç”Ÿæ•ˆäº†ã€‚æˆ‘ä¿®æ”¹åå¿˜è®°åˆ é™¤äº†ã€‚\r\n\r\næ–‡ä»¶åˆ†ç±»ï¼šstrutç›¸å…³(pom.xml or mavenä¾èµ– åœ¨æœ€å)\r\n    - struts.xml  web.xml  ListProductAction.java  ProductList.jsp\r\n</pre>\r\n\r\n```\r\n    + struts.xml\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE struts PUBLIC\r\n        \"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN\"\r\n        \"http://struts.apache.org/dtds/struts-2.0.dtd\">\r\n\r\n<struts>\r\n    <package name=\"demo\" extends=\"struts-default\" namespace=\"/\">\r\n\r\n        <default-action-ref name=\"listProduct\"/> <!--strutè®¾ç½®é¦–é¡µ-->\r\n\r\n<!--        <action name=\"*\">-->  <!--è¯¥é¡¹ç›®æ²¡æœ‰ä½¿ç”¨ä½†è¯¥è®¾ç½®å¯ä»¥ä½¿viewä¸‹é¢çš„jspé€šè¿‡æ–‡ä»¶åè®¿é—®ï¼Œç›¸å½“äºservlet-dispatcher-->\r\n<!--            <result>/WEB-INF/views/{1}.jsp</result>-->\r\n<!--        </action>-->\r\n\r\n        <action name=\"listProduct\" class=\"com.hyh.structAction.ListProductAction\" method=\"execute\">\r\n            <result name=\"success\">/WEB-INF/views/ProductList.jsp</result>\r\n        </action>\r\n\r\n    </package>\r\n</struts>\r\n\r\n    ______________________________________________\r\n\r\n    + web.xml\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\r\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\r\n         version=\"4.0\">\r\n\r\n    <context-param>\r\n        <param-name>contextConfigLocation</param-name>\r\n        <param-value>/WEB-INF/spring/appContext.xml</param-value>\r\n    </context-param>\r\n\r\n    <listener> <!--artifact -> WEB-INF -> <CREATE> file called lib -> <right click> -> add a copy of -> library files-->\r\n        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\r\n    </listener>\r\n\r\n    <filter> <!--å®ƒå–ä»£äº†servlet-->\r\n        <filter-name>DispatcherFilter</filter-name>\r\n        <filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\r\n    </filter>\r\n\r\n    <filter-mapping>\r\n        <filter-name>DispatcherFilter</filter-name>\r\n        <url-pattern>/*</url-pattern>\r\n    </filter-mapping>\r\n</web-app>\r\n\r\n    ----------------------------------------------\r\n\r\n    + ListProductAction.java\r\n\r\n    package com.hyh.structAction;\r\n\r\nimport com.hyh.dao.ProductDAO;\r\nimport com.hyh.pojo.Product;\r\nimport com.opensymphony.xwork2.ActionSupport;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport java.util.List;\r\n\r\n@Service(\"listProductActionBean\")\r\npublic class ListProductAction extends ActionSupport {\r\n    @Autowired\r\n    private ProductDAO productDAO;\r\n    private List<Product> listProduct;\r\n\r\n    @Autowired\r\n    public void setProductDAO(ProductDAO productDAO) { // springé€šè¿‡setteræ³¨å…¥\r\n        this.productDAO = productDAO;\r\n    }\r\n\r\n    @Override\r\n    public String execute() {\r\n        listProduct = productDAO.list();\r\n        return SUCCESS;\r\n    }\r\n\r\n    public List<Product> getListProduct() { // JSPé€šè¿‡getè·å–\r\n        return listProduct;\r\n    }\r\n}\r\n\r\n    -----------------------------------\r\n\r\n    + ProductList.jsp\r\n\r\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\r\n<%--\r\n  Created by IntelliJ IDEA.\r\n  User: AJH41\r\n  Date: 2023-10-08\r\n  Time: 3:29 PM\r\n  To change this template use File | Settings | File Templates.\r\n--%>\r\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\r\n<html>\r\n<head>\r\n    <title>Title</title>\r\n</head>\r\n<body>\r\n<div align=\"center\">\r\n    <table width=\"80%\" border=\"1\" style=\"border-collapse: collapse;\">\r\n        <tr>\r\n            <th>No</th>\r\n            <th>Product Name</th>\r\n            <th>Description</th>\r\n            <th>Price</th>\r\n        </tr>\r\n        <s:iterator value=\"listProduct\" status=\"stat\"> <!--struct-tags-->\r\n            <tr>\r\n                <td><s:property value=\"#stat.count\" /></td>  <%--#stat.countæ˜¯æŒ‡å½“å‰è¡Œæ˜¯ç¬¬å‡ ä¸ªè€Œä¸æ˜¯idå€¼--%>\r\n                <td><s:property value=\"name\" /></td>\r\n                <td><s:property value=\"description\" /></td>\r\n                <td><s:property value=\"price\" /></td>\r\n            </tr>\r\n        </s:iterator>\r\n    </table>\r\n</div>\r\n</body>\r\n</html>\r\n```\r\n<div >\r\n<pre class=\"preText\">\r\nspring\r\n    - appContext.xml daoåŒ…ä¸‹\r\n</pre>\r\n\r\n</div>\r\n\r\n```\r\n    + appContext.xml\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd\">\r\n\r\n    <bean id=\"sessionFactory\"\r\n          class=\"org.springframework.orm.hibernate4.LocalSessionFactoryBean\">\r\n        <property name=\"dataSource\" ref=\"dataSource\" />\r\n        <property name=\"configLocation\" value=\"file:F:\\JAVA\\20230925\\sshMaven\\src\\main\\java\\hibernate.cfg.xml\" /> <!---->\r\n    </bean>\r\n\r\n    <bean id=\"dataSource\" class=\"com.alibaba.druid.pool.DruidDataSource\"\r\n          destroy-method=\"close\">\r\n        <property name=\"driverClassName\" value=\"oracle.jdbc.driver.OracleDriver\" />\r\n        <property name=\"url\" value=\"jdbc:oracle:thin:@localhost:1521:orcl\" />\r\n        <property name=\"username\" value=\"hyh\" />\r\n        <property name=\"password\" value=\"123456\" />\r\n    </bean>\r\n\r\n    <tx:annotation-driven /> <!--åˆ©ç”¨@Transactionalæ³¨è§£æ¥å¤„ç†äº‹åŠ¡-->\r\n\r\n    <bean id=\"transactionManager\"\r\n          class=\"org.springframework.orm.hibernate4.HibernateTransactionManager\">\r\n        <property name=\"sessionFactory\" ref=\"sessionFactory\" />\r\n    </bean>\r\n\r\n    <context:component-scan base-package=\"com.hyh\"/>\r\n\r\n</beans>\r\n\r\n    ----------------------------------------------\r\n\r\n    + daoåŒ…\r\n        + 1\r\n    public interface ProductDAO {\r\n        List<Product> list();\r\n    }\r\n\r\n        + 2\r\n    import com.hyh.dao.ProductDAO;\r\nimport com.hyh.pojo.Product;\r\nimport org.hibernate.Criteria;\r\nimport org.hibernate.SessionFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.stereotype.Repository;\r\nimport org.springframework.transaction.annotation.Transactional;\r\n\r\nimport java.util.List;\r\n\r\n@Repository(\"productDAO\")\r\npublic class ProductDAOImpl implements ProductDAO {\r\n    @Autowired\r\n    private SessionFactory sessionFactory;\r\n\r\n    @Autowired\r\n    public ProductDAOImpl(SessionFactory sessionFactory) {\r\n        this.sessionFactory = sessionFactory;\r\n    }\r\n\r\n    @Override\r\n    @Transactional\r\n    public List<Product> list() {\r\n        @SuppressWarnings(\"unchecked\") //uncheckedæ˜¯å¯¹ç¼–è¯‘å™¨æ¥è¯´ä¸å¯é¢„çŸ¥çš„é”™è¯¯ checkedå¯¹ç¼–è¯‘å™¨æ¥è¯´å¯ä»¥é¢„çŸ¥æ‰€ä»¥ä¼šå¼ºåˆ¶æ•è·\r\n        List<Product> listProduct = (List<Product>)\r\n                sessionFactory.getCurrentSession().createCriteria(Product.class) // hibernateæ•°æ®åº“æ“ä½œä¼šè¯é€šè¿‡å…ƒæ•°æ®äº†è§£è¡¨ç»“æ„åç”Ÿæˆç›¸åº”SQL\r\n                        .setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY) // DISTINCT_ROOT_ENTITYä»£è¡¨äº†æ•°æ®åº“ä¸­çš„DISTINCT\r\n                        .list(); // è¿”å›ç±»å‹\r\n        System.out.println(listProduct);\r\n        return listProduct;\r\n    }\r\n\r\n}\r\n```\r\n\r\n<div >\r\n<pre class=\"preText\">\r\nhibernate\r\n    - hibernate.cfg.xml  Product.hbm.xml\r\n</pre>\r\n</div>\r\n\r\n```\r\n    + .cfg.xml\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE hibernate-mapping PUBLIC\r\n        \"-//Hibernate/Hibernate Mapping DTD 3.0//EN\"\r\n        \"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd\">\r\n<hibernate-mapping package=\"com.hyh.pojo\">\r\n    <class name=\"Product\" table=\"product\"> <!--hibernateæ˜¯é¢å‘å¯¹è±¡çš„-->\r\n        <id name=\"id\" column=\"id\"/>\r\n        <property name=\"name\" />\r\n        <property name=\"description\" />\r\n        <property name=\"price\" />\r\n    </class>\r\n</hibernate-mapping>\r\n\r\n    ====================================\r\n\r\n    + hbm.xml\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE hibernate-mapping PUBLIC\r\n        \"-//Hibernate/Hibernate Mapping DTD 3.0//EN\"\r\n        \"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd\">\r\n<hibernate-mapping package=\"com.hyh.pojo\">\r\n    <class name=\"Product\" table=\"product\"> <!--hibernateæ˜¯é¢å‘å¯¹è±¡çš„-->\r\n        <id name=\"id\" column=\"id\"/>\r\n        <property name=\"name\" />\r\n        <property name=\"description\" />\r\n        <property name=\"price\" />\r\n    </class>\r\n</hibernate-mapping>\r\n```\r\n<div >å…¶å®ƒæ–‡ä»¶ï¼šlog4j.properties  pom.xml</div>\r\n\r\n```\r\n    + properties\r\n# stdout | logå¯¹è±¡ | æ¨¡å¼ æ§åˆ¶å°è¾“å‡ºå¸ƒå±€ æ ·å¼\r\n# å¯ä»¥ç›´æ¥å¤åˆ¶\r\n\r\n# Global logging configuration\r\nlog4j.rootLogger=INFO, stdout\r\n# MyBatis logging configuration...\r\nlog4j.logger.com.hyh=INFO\r\n# Console output...\r\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\r\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\r\n#log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n\r\n\r\n    =================================\r\n    + .xml\r\n\r\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\r\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\r\n    <modelVersion>4.0.0</modelVersion>\r\n\r\n    <groupId>org.example</groupId>\r\n    <artifactId>sshMaven</artifactId>\r\n    <version>1.0-SNAPSHOT</version>\r\n\r\n    <properties>\r\n        <maven.compiler.source>8</maven.compiler.source>\r\n        <maven.compiler.target>8</maven.compiler.target>\r\n        <org.springframework-version>4.1.4.RELEASE</org.springframework-version>\r\n        <org.strutsframework-version>2.3.20</org.strutsframework-version>\r\n        <org.hibernateframework-version>4.3.8.Final</org.hibernateframework-version>\r\n        <org.mysqlconnector-version>5.1.34</org.mysqlconnector-version>\r\n    </properties>\r\n\r\n    <dependencies>\r\n        <!--SPRING-->\r\n        <dependency>\r\n            <groupId>org.springframework</groupId>\r\n            <artifactId>spring-context</artifactId>\r\n            <version>${org.springframework-version}</version>\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.springframework</groupId>\r\n            <artifactId>spring-context-support</artifactId>\r\n            <version>${org.springframework-version}</version>\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.springframework</groupId>\r\n            <artifactId>spring-orm</artifactId>\r\n            <version>${org.springframework-version}</version>\r\n            <type>jar</type>\r\n            <scope>compile</scope>\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.springframework</groupId>\r\n            <artifactId>spring-web</artifactId>\r\n            <version>${org.springframework-version}</version> <!-- Replace with your Spring version -->\r\n        </dependency>\r\n\r\n        <!--STRUCTS-->\r\n        <dependency>\r\n            <groupId>org.apache.struts</groupId>\r\n            <artifactId>struts2-core</artifactId>\r\n            <version>${org.strutsframework-version}</version>\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.apache.struts</groupId>\r\n            <artifactId>struts2-spring-plugin</artifactId>\r\n            <version>${org.strutsframework-version}</version>\r\n        </dependency>\r\n\r\n        <!--ORM-->\r\n        <dependency>\r\n            <groupId>org.hibernate</groupId>\r\n            <artifactId>hibernate-core</artifactId>\r\n            <version>${org.hibernateframework-version}</version>\r\n        </dependency>\r\n\r\n        <!--DRUID-->\r\n        <dependency>\r\n            <groupId>com.alibaba</groupId>\r\n            <artifactId>druid</artifactId>\r\n            <version>1.2.4</version> <!-- æ ¹æ®éœ€è¦æŒ‡å®šDruidçš„ç‰ˆæœ¬ -->\r\n        </dependency>\r\n\r\n        <!-- Oracle 19c JDBCé©±åŠ¨ -->\r\n        <dependency>\r\n            <groupId>com.oracle.database.jdbc</groupId>\r\n            <artifactId>ojdbc8</artifactId>\r\n            <version>19.11.0.0</version> <!-- æ ¹æ®æ‚¨çš„Oracleç‰ˆæœ¬é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ -->\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>junit</groupId>\r\n            <artifactId>junit</artifactId>\r\n            <version>4.12</version>\r\n            <scope>compile</scope>\r\n        </dependency>\r\n\r\n        <!--log4j-->\r\n        <dependency>\r\n            <groupId>org.apache.logging.log4j</groupId>\r\n            <artifactId>log4j-api</artifactId>\r\n            <version>2.14.1</version> <!-- Use the latest version available -->\r\n        </dependency>\r\n\r\n        <dependency>\r\n            <groupId>org.apache.logging.log4j</groupId>\r\n            <artifactId>log4j-core</artifactId>\r\n            <version>2.14.1</version> <!-- Use the same version as log4j-api -->\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>log4j</groupId>\r\n            <artifactId>log4j</artifactId>\r\n            <version>1.2.17</version> <!-- Use a suitable version -->\r\n        </dependency>\r\n\r\n    </dependencies>\r\n\r\n</project>\r\n```\r\n<div >\r\n   <h4>2. ss(h)m</h4>\r\n   \r\n> SS(H)Mä¸æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æœ¯è¯­ï¼Œæ²¡æœ‰æ˜ç¡®çš„å®šä¹‰ã€‚å®ƒå¯èƒ½æ˜¯æŒ‡Struts2 + Spring + Hibernate + MyBatisçš„ç»„åˆï¼Œä½†è¿™ç§ç»„åˆé€šå¸¸ä¸å¸¸è§ï¼Œå› ä¸ºMyBatiså’ŒHibernateéƒ½æ˜¯ç”¨äºæ•°æ®åº“è®¿é—®çš„æŒä¹…åŒ–æ¡†æ¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸ä¼šåŒæ—¶ä½¿ç”¨ã€‚\r\n\r\n- å…³äºaop cannot find methodçš„æŠ¥é”™ï¼šéœ€è¦åˆ é™¤outé‡Œé¢çš„spring-dao å› ä¸ºouté‡Œé¢çš„åŒ…éƒ½æ˜¯æˆ‘è‡ªå·±æ”¾è¿›å»çš„ ã€ä½†æ˜¯ã€‘è¿˜æ˜¯ä¸è¡Œï¼Œåªèƒ½åˆ é™¤artifacté‡æ–°æ„å»ºå°±å¯äº†\r\n\r\n- ç»“åˆä¸Šé¢çš„å†…å®¹å¯ä»¥æ­å»ºå‡ºæ·»åŠ äº†ä½¿ç”¨mybatisè·å–æ•°æ®çš„ç±»å¹¶ç»“åˆçš„sshm\r\n    + ä½¿ç”¨åˆ°çš„æ–‡ä»¶æœ‰(ä¸Šé¢éƒ½æœ‰)\r\n        - DruidDataSource TransactionFactoryImpl\r\n        - éœ€è¦æ³¨æ„Mavenç»“æ„ä¸­çš„ä¸€ä¸‹æ–‡ä»¶éƒ½åœ¨resourcesé‡Œé¢\r\n            - db.properties\r\n            - mybatis-config.xml *é‡Œé¢å¯¹Mapperçš„è·¯å¾„ç›´æ¥æ”¹ä¸ºæ–‡ä»¶åï¼Œå› ä¸ºMapperç°åœ¨ç›´æ¥åœ¨resourcesæ–‡ä»¶å¤¹å†…\r\n            - TestInterfaceMapper.xml *æ¶‰åŠåˆ°çš„æ•°æ®ç±»å‹éƒ½æ”¹ä¸ºäº†Product\r\n\r\n- ProductDaoå’ŒProductDaoImplæ·»åŠ äº†ä»¥ä¸‹å†…å®¹\r\n</div>\r\n\r\n```\r\n+ interface\r\nList<Product> mybatisList();\r\n\r\n+ implementation\r\n@Override\r\n@Transactional\r\npublic List<Product> mybatisList() {\r\n    SqlSessionFactory factory = giveFactory();\r\n    SqlSession sqlSession = factory.openSession();\r\n    List<Product> productList = sqlSession.getMapper(ProductDAO.class).mybatisList();\r\n    return productList;\r\n}\r\n\r\npublic SqlSessionFactory giveFactory() { //å¯ç”¨mybatisé…ç½®æ–‡ä»¶\r\n    SqlSessionFactory factory = null;\r\n    try {\r\n        InputStream inputStream = Resources.getResourceAsStream(\"mybatis-config.xml\"); //ä½¿ç”¨\r\n        factory = new SqlSessionFactoryBuilder().build(inputStream);\r\n        inputStream.close();\r\n    } catch (IOException exception) {\r\n        exception.printStackTrace();\r\n    }\r\n\r\n    factory.getConfiguration().setDatabaseId(\"oracle\"); //set database type\r\n    System.out.println(factory.getConfiguration().getDatabaseId());\r\n\r\n    return factory;\r\n}\r\n```\r\n<div >\r\n\r\n+ åœ¨structActionåŒ…é‡Œæ·»åŠ äº†ä»¥ä¸‹ListProductMybatisActionç±»å¹¶åœ¨struts.xmlé‡Œæ·»åŠ äº†ä»¥ä¸‹dispatcher:\r\n```\r\n<action name=\"mybatis\" class=\"com.hyh.structAction.ListProductMybatisAction\" method=\"execute\">\r\n    <result name=\"success\">/WEB-INF/views/ProductListMybatis.jsp</result>\r\n</action>\r\n```\r\n\r\n</div>\r\n\r\n+ ListProductMybatisAction\r\n```\r\nimport com.hyh.dao.ProductDAO;\r\nimport com.hyh.pojo.Product;\r\nimport com.opensymphony.xwork2.ActionSupport;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport java.util.List;\r\n\r\n@Service(\"listProductMybatisActionBean\")\r\npublic class ListProductMybatisAction extends ActionSupport {\r\n    @Autowired\r\n    private ProductDAO productDAO;\r\n    private List<Product> productList;\r\n\r\n    @Autowired\r\n    public void setProductDAO(ProductDAO productDAO) { // springé€šè¿‡setteræ³¨å…¥\r\n        this.productDAO = productDAO;\r\n    }\r\n\r\n    @Override\r\n    public String execute() {\r\n        productList = productDAO.mybatisList();\r\n        return SUCCESS;\r\n    }\r\n\r\n    public List<Product> getProductList() { // JSPé€šè¿‡getè·å–\r\n        return productList;\r\n    }\r\n}\r\n</textarea>\r\n<div >viewsé‡Œé¢æ·»åŠ äº†ProductListMybatis.jspé¡µé¢</div>\r\n<textarea class=\"code\">\r\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\r\n<%--\r\n  Created by IntelliJ IDEA.\r\n  User: AJH41\r\n  Date: 2023-10-09\r\n  Time: 10:44 AM\r\n  To change this template use File | Settings | File Templates.\r\n--%>\r\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\r\n<html>\r\n<head>\r\n    <title>Title</title>\r\n</head>\r\n<body>\r\n<div align=\"center\">\r\n    <table width=\"80%\" border=\"1\" style=\"border-collapse: collapse;\">\r\n        <tr>\r\n            <th>No</th>\r\n            <th>Product Name</th>\r\n            <th>Description</th>\r\n            <th>Price</th>\r\n        </tr>\r\n        <s:iterator value=\"productList\" status=\"stat\"> <!--struct-tags-->\r\n            <tr>\r\n                <td><s:property value=\"#stat.count\" /></td>  <%--#stat.countæ˜¯æŒ‡å½“å‰è¡Œæ˜¯ç¬¬å‡ ä¸ªè€Œä¸æ˜¯idå€¼--%>\r\n                <td><s:property value=\"name\" /></td>\r\n                <td><s:property value=\"description\" /></td>\r\n                <td><s:property value=\"price\" /></td>\r\n            </tr>\r\n        </s:iterator>\r\n    </table>\r\n</div></body>\r\n</html>\r\n```\r\n<div >\r\n        <h3>äº‹åŠ¡</h3>\r\n        \r\n- åœ¨MyBatisä¸­ï¼ŒMapper.xmlæ–‡ä»¶é€šå¸¸ç”¨äºå®šä¹‰SQLæ˜ å°„å’Œæ•°æ®åº“æ“ä½œã€‚MyBatisä¸å¤„ç†äº‹åŠ¡æœ¬èº«ï¼Œè€Œæ˜¯ä¾èµ–äºå¤–éƒ¨çš„äº‹åŠ¡ç®¡ç†å™¨æ¥å¤„ç†äº‹åŠ¡ã€‚<br>\r\n- å¤–éƒ¨çš„äº‹åŠ¡ç®¡ç†å™¨ä¸€èˆ¬ï¼šä¸º@Transactionalæ³¨é‡Šï¼ŒåŸå› æ˜¯sqlè¯­è¨€å¯¹äº‹åŠ¡çš„å¤„ç†æ— æ³•å•ç‹¬è°ƒç”¨ï¼Œæ‰€ä»¥éœ€è¦å¤–éƒ¨ç¨‹åºç®¡ç†äº‹åŠ¡<br>\r\n@Transactionalæ³¨è§£ï¼šè¿™è¡¨ç¤ºè¯¥æ–¹æ³•åº”è¯¥åœ¨äº‹åŠ¡ç®¡ç†ä¸‹è¿è¡Œï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™äº‹åŠ¡å°†è¢«å›æ»šã€‚<br>\r\n\r\n> å‡è®¾ï¼šæ¯æ¬¡æ‰§è¡Œäº‹åŠ¡ï¼Œæ˜¾ç¤ºå­¦ç”Ÿçš„åå­—å’Œå¹´é¾„ï¼Œå¹¶ä¸”å¹´é¾„+1ã€‚\r\n\r\n- å…¶å®ƒçš„éƒ½å·®ä¸å¤šï¼Œé‡ç‚¹å¦‚ä¸‹\r\n    </div>\r\n\r\n```\r\n    @Override\r\n    @Transactional\r\n    public List<User> updateAge() {\r\n        SqlSessionFactory factory = giveFactory();\r\n        SqlSession sqlSession = factory.openSession();\r\n        List<User> users = sqlSession.getMapper(ProductDAO.class).getAll();\r\n        for (User u : users) {\r\n            boolean re = sqlSession.getMapper(ProductDAO.class).update(u.getId(), u.getName(), u.getSex(), u.getAge() + 1);\r\n            if (!re) {\r\n                LOGGER.warn(() -> {\r\n                    return \"update fail UserId = \" + u.getId();\r\n                });\r\n            }\r\n        }\r\n        sqlSession.commit();\r\n        users = sqlSession.getMapper(ProductDAO.class).getAll();\r\n        return users;\r\n    }\r\n```\r\n<div >\r\n    <h3>3.1.3 åˆ«å</h3>\r\n\r\n> ä»¥ä¸‹ä¸ºåšä¸»ç¿»è¯‘:\r\n> \r\nä¸ºäº†å‡å°‘ä»£ç å†—ä½™ï¼Œå’±ä»¬æ·»åŠ äº†åˆ«åç³»ç»Ÿï¼Œä½ å¯ä»¥ç»™ä½ çš„ç±»å–ä¸ªåˆ«åï¼Œæ˜¯ä¸æ˜¯å¾ˆå‰å®³><\r\n\r\nå½“ç„¶ä½ ä¹Ÿå¯ä»¥è®©mybatisè‡ªå·±æ‰¾åˆ«åï¼Œå’±å°±æ˜¯è¯´ï¼Œmybatisè¿˜æ˜¯å¾ˆæ™ºèƒ½çš„ã€‚ \r\nå•Šå•Šï¼Œå¦‚æœä½ æ²¡æœ‰ç»™å®ƒå–åˆ«åä¹Ÿè¢«å…³ç³»ï¼Œä»–ä¼šè‡ªåŠ¨ç»™å­©å­ä»¬å–ä¸ªåˆ«åï¼Œé¦–å­—æ¯å°å†™å¼€å¤´ã€‚\r\n\r\nå—¨ï¼Œè¿˜æœ‰æ›´å¤šã€‚æˆ‘ä»¬ç»™javaçš„å¸¸ç”¨ç±»éƒ½å–äº†ä¸ªé»˜è®¤åˆ«åï¼Œä½ çœ‹ä½ çœ‹ï¼Œä½†æ˜¯å¤§å°å†™æ•æ„Ÿï¼Œæ•æ„Ÿä¹Ÿæ²¡åŠæ³•å˜›ï¼Œåå­—å¤ªå¤šäº†ã€‚\r\n\r\n<img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/listalias.png\" width=\"100%\"/>\r\n</div>\r\n\r\n```\r\n    <configuration>\r\n    <properties resource=\"db.properties\"/>\r\n    <settings> <!--settingséœ€è¦åœ¨propertiesåé¢ environmentså‰é¢ å¦åˆ™ä¼šæŠ¥çº¢ çŒœæµ‹æ˜¯åŠ è½½é¡ºåºæœ‰è§„å®š-->\r\n        <setting name=\"logImpl\" value=\"LOG4J\"/>\r\n        <!--æœ‰æ•ˆçš„å€¼åŒ…æ‹¬SLF4Jã€LOG4Jã€LOG4J2ã€JDK_LOGGINGã€COMMONS_LOGGINGã€STDOUT_LOGGINGã€NO_LOGGINGï¼Œæˆ–è€…ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åï¼Œè¯¥ç±»å®ç°org.apache.ibatis.logging.Logæ¥å£ï¼Œå¹¶å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ã€‚-->\r\n    </settings>\r\n    <typeAliases>\r\n        <typeAlias alias=\"MANAGER\" type=\"com.hyh.transaction.impl.TransactionFactoryImpl\"/>\r\n        <package name=\"com.hyh.dataSourceFactoryImpl\"/>\r\n    </typeAliases>\r\n    <environments default=\"development\">\r\n        <environment id=\"development\">\r\n            <transactionManager type=\"MANAGER\">\r\n                <property name=\"autoCommit\" value=\"false\"/>\r\n            </transactionManager>\r\n            <dataSource type=\"DRUID\">\r\n                <property name=\"driver\" value=\"${oracle_driver}\"/>\r\n                <property name=\"url\" value=\"${oracle_url}\"/>\r\n                <property name=\"username\" value=\"${oracle_username}\"/>\r\n                <property name=\"password\" value=\"${oracle_password}\"/>\r\n            </dataSource>\r\n        </environment>\r\n    </environments>\r\n    <mappers>\r\n        <mapper resource=\"TestInterfaceMapper.xml\"/> <!--éƒ½åªèƒ½åœ¨resourcesæ–‡ä»¶å¤¹-->\r\n    </mappers>\r\n</configuration>\r\n\r\n@Alias(\"DRUID\")\r\n// https://blog.csdn.net/m0_70031574/article/details/131947655\r\npublic class DruidDataSource implements DataSourceFactory { // java: illegal character: \'\\ufeff\' remove BOM in File Editor and recreate file\r\n```\r\n<div >\r\n    <h3>3.1.4 ç±»å¤„ç†å™¨</h3>\r\n    \r\n> ä»¥ä¸‹ä¸ºåšä¸»ç¿»è¯‘:\r\n> \r\næ¯å½“ä½ åœ¨preparedStatementè®¾ç½®å‚æ•°æˆ–è€…ç»“æœé›†è¿”å›å€¼çš„æ—¶å€™æˆ‘ä»¬éƒ½ä¼šæ´¾å‡ºç±»å¤„ç†å™¨æ¥å¤„ç†æ•°æ®ç±»å‹ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå“¼å“¼ï¼ŒæŠŠå®ƒä»¬å˜æˆjavaå¯ä»¥æ¥å—çš„æ•°æ®ç±»å‹ã€‚\r\n    \r\n> æ³¨æ„ï¼3.4.5æˆ‘ä»¬å°±å¯ä»¥é»˜è®¤æ”¯æŒJSR-310ï¼ˆä¸€ç§æ—¶é—´ä¸æ—¥æœŸçš„æ¥å£ï¼‰\r\n\r\n<h3>3.1.5 å¤„ç†æšä¸¾</h3>\r\n\r\n> ä»¥ä¸‹ä¸ºåšä¸»ç¿»è¯‘:\r\n\r\nä½ å¿…é¡»ä½¿ç”¨æˆ‘ä»¬çš„org.apache.ibatis.type.EnumOrdinalTypeHandler or EnumTypeHandleræ¥è½¬æ¢æšä¸¾ç±»å‹ã€‚\r\n\r\n- å¦‚æœä½ ç”¨ç¬¬ä¸€ä¸ªçš„è¯å°±ä»£è¡¨ä½ æƒ³ä¿ç•™æ•°å­—ï¼Œå°±åœ¨mybatis-config.xmlé‡Œæ·»åŠ \r\n```\r\n<typeHandlers>\r\n        <typeHandler handler=\"org.apache.ibatis.type.EnumOrdinalTypeHandler\"\r\n                     javaType=\"java.math.RoundingMode\"/>\r\n</typeHandlers>\r\n```\r\n- wwç¬¬äºŒä¸ªå°±æ˜¯ä¿ç•™å€¼å•¦\r\n\r\n#### å…¶ä»–\r\n> 3.1.6 ä½ å¯ä»¥ä¿®æ”¹è¿”å›æ•°æ®çš„åº•å±‚é€»è¾‘\r\n> 3.1.7 ä½ å¯ä»¥åœ¨ç‰¹å®šæ–¹æ³•é‡Œä½¿ç”¨æ’ä»¶\r\n> 3.1.9 ä½ å¯ä»¥ç”¨idæ¥åˆå§‹åŒ–å¤šä¸ªæ•°æ®åº“\r\n\r\n#### æ€ç»´å¯¼å›¾\r\n<div>\r\n    <img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/1.png\" width=\"100%\">\r\n    <img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/2.png\" width=\"100%\">\r\n    <img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/3.png\" width=\"100%\">\r\n    <img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/4.png\" width=\"100%\">\r\n    <img src=\"http://mail.hampster.work:9000/online/hampster/java/mybatis-pool/5.png\" width=\"100%\">\r\n    \r\n> working on: <br>\r\n> ssh/sshm <br>\r\n> å±æ€§å¤§å…¨åšåˆ°dbcp removeAbandondè¿˜æœ‰c3p0<br>\r\n> å…³äº1.ä¸­statementtypeä¸ºprepared è¿˜æ˜¯ static çš„è®¾ç½®åŒºåˆ«<br>\r\n> @çš„æƒ…å†µæ˜¯å¦å¯ä»¥è®¾ç½®è‡ªå¢åºåˆ—ä¸ºid?<br>\r\n> å°†logè¾“å‡ºåˆ°æ–‡ä»¶<br>\r\n> mapperå¯¹å­˜å‚¨è¿‡ç¨‹ï¼Œè§†å›¾ï¼Œåºåˆ—ï¼Œè§¦å‘å™¨ç­‰çš„å¤„ç†\r\n</div>\r\n', '2025-01-11 11:43:40'),(10, 2, 'Web', '## Web\r\n#### cycle è¯­å¥\r\n```\r\n{% for item in xx.loop %}\r\n    {% cycle \'1\' \'2\' \'3\' \'4\' as xxxx silent%}\r\n    <li>{{ item }}: {{ xxxx }}</li>\r\n{% endfor %}\r\n```\r\n- silent: æ„æ€æ˜¯é™é»˜å‡†å¤‡ï¼Œå¦åˆ™è¦å¤šè¾“å‡ºä¸€ä¸ªå‡†å¤‡å€¼', '2025-01-11 10:21:44'),(11, 2, 'Pytorch', '## Pytorch\r\n\r\n### æ ¸å¿ƒ\r\n\r\n- ç¼–è§£ç æ¡†æ¶  \r\n        - é€šè¿‡å¯¹hidden stateçš„å¾ªç¯è¾“å…¥è¾“å‡º æ¥è·å–ç»“æœ  \r\n        - ä½†æ˜¯å¾ˆéš¾å¤„ç†é•¿å¥å­  \r\n- æ³¨æ„åŠ›æœºåˆ¶  \r\n        - è§£å†³é•¿å¥çš„å¤„ç†ï¼Œè®©å…¶åªä¸“æ³¨äºå…¶ä¸­å‡ ä¸ªhidden state  \r\n- ä¼ é€’å¼å­¦ä¹   \r\n\r\n### pytorchå¯¹ä¸€èˆ¬å¼ é‡çš„å¤„ç†[è‡ªç„¶è¯­è¨€æ¨¡å‹æœ€ç»ˆç”¨åˆ°çš„æ•°æ®å½¢å¼]\r\n\r\nå‚è€ƒä¹¦ç›®ï¼šNatural Language Processing with Transformers  \r\n\r\n> ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ•°æ®å‘è‡ªå·±é¢„æœŸçš„æ•°æ®æ–¹å‘é è¿‘\r\n\r\n```\r\ndef train(x, y):\r\n    input_size = 784  # Assuming the input size required by the model is 784\r\n\r\n    # Generate random input data within the required range\r\n    X = torch.randn(x, input_size)  # Creating random data with shape (x, 784)\r\n    y = torch.empty(x, dtype=torch.float).random_(y) # æ ‡ç­¾ï¼Œæ¥è‡ªå®˜æ–¹æ–‡æ¡£\r\n\r\n    model = nn.Sequential(\r\n        nn.Linear(input_size, 200),\r\n        nn.ReLU(),\r\n        nn.Linear(200, 10)\r\n    )\r\n    loss_fn = nn.CrossEntropyLoss()\r\n    optimizer = optim.SGD(model.parameters(), lr=0.01)\r\n    \r\n    # Assuming y is a tensor containing the target labels\r\n\r\n    for epoch in range(10):\r\n        for i in range(len(X)):\r\n\r\n            y_pred = model(X[i])\r\n\r\n            loss = loss_fn(y_pred, y) # Ensure y[i] has proper shape for CrossEntropyLoss\r\n            print(\"epoch: {}, i: {}, loss: {}\".format(epoch, i, loss.item())) # print loss\r\n\r\n            # Before the backward pass, use the optimizer object to zero all of the \r\n            # gradients for the variables it will update (which are the learnable weights\r\n            # of the model)\r\n            optimizer.zero_grad()\r\n\r\n            loss.backward() # compute gradient of the loss\r\n            optimizer.step() # let optimizer to update parameter\r\n\r\n```\r\n\r\n### è¯­æ–™åº“ä¸‹è½½\r\nhttps://zhuanlan.zhihu.com/p/163616279  \r\nç¤¾åŒºäº’åŠ¨ï¼š web_zh_2019ï¼Œå¤§å°3Gï¼Œæå–å¯†ç ï¼š2rk6\r\n\r\n### æ ¼å¼å¤„ç†\r\n```\r\n# å‚è€ƒä¹¦ç›®ï¼šè‡ªç„¶è¯­è¨€å¤„ç†\r\nparent_name = \"F:\\\\HUAXINBeforeJob\\\\python_projects\\\\Natural_Language_Processing_with_Transformers\\\\1212\\\\NLPwithPytorch\"\r\ndef printLines(file, n=10):\r\n    with open(file, \'r\', encoding=\"utf-8\") as datafile:\r\n        lines = datafile.readlines()\r\n        for ln in range(len(lines[:n])):\r\n            if lines[ln].strip() == \"\":\r\n                print()\r\n            elif ln + 1 < len(lines[:n]) and lines[ln + 1].strip() != \"\" \\\r\n                and (ln - 1 > 0 and lines[ln - 1].strip() != \"\"):\r\n                pass\r\n            elif lines[ln].strip() != \"\":\r\n                # \", \".join(jieba.cut(line)).strip()\r\n                print(lines[ln].strip(), end=\"\\t\")\r\n\r\nprintLines(os.path.join(parent_name, \"zh_2019_test.txt\"))\r\n```\r\n\r\n### ä¸­æ–‡åˆ†è¯æ¨¡å—\r\nhttps://github.com/fxsjy/jieba\r\n```\r\nå®‰è£…\r\npip install jieba / pip3 install jieba\r\n```\r\n\r\n### åˆ›å»ºè¯å…¸ã€æ•°æ®é¢„å¤„ç†ä¸è¿‡æ»¤ã€‘\r\n\r\n```\r\n# tokenå®šä¹‰\r\nPAD_token = 0 # è¡¨ç¤ºå¡«æ§½ï¼Œä¾‹å¦‚:ä»Šå¤©çš„å¤©æ°”æ˜¯__ ä¸­ _ ä¸ºå¡«æ§½\r\nSOS_token = 1 # å¥å­çš„å¼€å§‹EOStoken=2#å¥å­çš„ç»“æŸ\r\nEOS_token = 2 # end of sentence\r\nclass Voc:\r\n    def __init__(self, name):\r\n        self.name = name\r\n        self.trimmed = False\r\n        self.word2index = {} # è¯ä½\r\n        self.index2word = {PAD_token:\"PAD\", SOS_token:\"SOS\", EOS_token:\"EOS\"}\r\n        self.num_words = 3 # ç›®å‰æœ‰ SOSã€EOSã€PADè¿™3ä¸ªtoken\r\n        self.word2count = {} # è¯é¢‘\r\n    def addSentence(self, sentence):\r\n        for word in jieba.cut(sentence):\r\n            self.addWord(word)\r\n    def addWord(self, word):\r\n        if word not in self.word2index: # å°†å†…å®¹è½¬æ¢ä¸ºæ•°å­—\r\n            self.word2index[word] = self.num_words\r\n            self.word2count[word] = 1\r\n            self.index2word[self.num_words] = word\r\n            self.num_words += 1 \r\n        else:\r\n            self.word2count[word] += 1\r\n    #åˆ é™¤é¢‘æ¬¡å°äºmincountçš„token\r\n    def trim(self, min_count):\r\n        if self.trimmed:\r\n            return\r\n        self.trimmed = True\r\n        keep_words = []\r\n        for k, v in self.word2count.items():\r\n            if v >= min_count:\r\n                keep_words.append(k)\r\n        print(\'keep_words {} / {} = {:.4f}\'.format( # :ä»£è¡¨æ ¼å¼åŒ–å­—ç¬¦çš„å¼€å§‹\r\n                len(keep_words), len(self.word2index), len(keep_words) / len(self.word2index)\r\n        ))\r\n        #é‡æ–°æ„é€ è¯å…¸\r\n        self.word2index = {}\r\n        self.word2count = {}\r\n        self.index2word = {PAD_token: \"PAD\", SOS_token: \"SOS\", EOS_token:\"EOS\"}\r\n        selfnum_words = 3 # Count default tokens#é‡æ–°æ„é€ åè¯é¢‘å°±æ²¡æœ‰æ„ä¹‰äº†(éƒ½æ˜¯1)\r\n        for word in keep_words:\r\n            self.addWord(word)\r\ndef normalizeString(s):\r\n    #å› ä¸ºæŠŠä¸ç”¨çš„å­—ç¬¦éƒ½å˜æˆç©ºæ ¼ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å¤šä¸ªè¿ç»­ç©ºæ ¼\r\n    #ä¸‹é¢çš„æ­£åˆ™æ›¿æ¢æŠŠå¤šä¸ªç©ºæ ¼å˜æˆä¸€ä¸ªç©ºæ ¼ï¼Œæœ€åå»æ‰å‰åç©ºæ ¼\r\n    s = re.sub(r\"s*\", r\"\", s).strip()\r\n    return s\r\n#è¯»å–é—®ç­”å¥å¯¹å¹¶ä¸”è¿”å›Vocè¯å…¸å¯¹è±¡\r\ndef readVocs(datafile, corpus_name):\r\n    print(\"\\nReading lines...\")\r\n    #æ–‡ä»¶æ¯è¡Œè¯»å–åˆ°list linesä¸­\r\n    lines = open(datafile, encoding=\'utf-8\').read().strip().split(\'\\n\')\r\n    #æ¯è¡Œç”¨tabåˆ‡åˆ†æˆé—®ç­”ä¸¤ä¸ªå¥å­ï¼Œç„¶åè°ƒç”¨normalizeStringå‡½æ•°è¿›è¡Œå¤„ç†\r\n    pairs = [[normalizeString(s) for s in l.split(\'\\t\') if normalizeString(s) != \"\"] for l in lines]\r\n    voc = Voc(corpus_name)\r\n    return voc, pairs\r\nvoc, pairs = readVocs(os.path.join(parent_name, \"myfile.txt\"), \"first try\")\r\ndef loadPrepareData(corpus, corpus_name, datafile): # corpus è¯­æ–™\r\n    print(\"Start preparing training data ...\")\r\n    voc.pairs = readVocs(datafile, corpus_name)\r\n    print(\"Read {!s} sentence pairs\".format(len(pairs)))\r\n    print(\"Trimmed to {!s} sentence pairs\".format(len(pairs)))\r\n    print(\"Counting words...\")\r\n    for pair in pairs:\r\n        voc.addSentence(pair[0])\r\n        voc.addSentence(pair[1] if len(pair) > 1 else \"\")\r\n        # print(\"Counted words:\", voc.num_words)\r\n    return voc,pairs\r\n#è£…è½½vocå’Œå¥å­å¯¹\r\nsave_dir = os.path.join(\"data\",\"save\")\r\nvoc, pairs = loadPrepareData(\"???\", \"corpus_name\", os.path.join(parent_name, \"myfile.txt\"))\r\n# è¾“å‡ºä¸€äº›è¯ä½ å’Œ è¯é¢‘\r\nprint(\"word index:\")\r\ncount = 0\r\nfor key, value in voc.word2index.items():\r\n    if count < 10:\r\n        print(key, \':\', value)\r\n        count += 1\r\n    else:\r\n        break\r\nprint(\"word frequency:\")\r\ncount = 0\r\nfor key, value in voc.word2count.items():\r\n    if count < 10:\r\n        print(key, \':\', value)\r\n        count += 1\r\n    else:\r\n        break\r\n\r\n#è¾“å‡ºä¸€äº›å¥å¯¹\r\nprint(\"\\npairs:\")\r\nfor pair in pairs[:10]:\r\n    print(pair)\r\n\r\nMIN_COUNT=3#å€¼ä¸º3\r\ndef trimRareWords(voc, pairs, MIN_OUNT):\r\n    #å» vocä¸­é¢‘æ¬¡å°äº3çš„è¯\r\n    voc.trim(MIN_COUNT)\r\n    #ä¿ç•™çš„å¥å¯¹\r\n    keep_pairs =[]\r\n    for pair in pairs:\r\n        input_sentence = pair[0]\r\n        output_sentence = pair[1] if len(pair) > 1 else \"\"\r\n        keep_input = True\r\n        keep_output = True\r\n        #æ£€æŸ¥é—®é¢˜\r\n        for word in jieba.cut(input_sentence):\r\n            if word not in voc.word2index:\r\n                keep_input = False\r\n                break\r\n        #æ£€æŸ¥ç­”æ¡ˆ\r\n        for word in jieba.cut(output_sentence):\r\n            if word not in voc.word2index:\r\n                keep_output = False\r\n                break\r\n        #å¦‚æœé—®é¢˜å’Œç­”æ¡ˆéƒ½åªåŒ…å«é«˜é¢‘è¯ï¼Œæˆ‘ä»¬æ‰ä¿ç•™è¿™ä¸ªå¥å¯¹\r\n        if keep_input and keep_output:\r\n            keep_pairs.append(pair)\r\n    print(\"Trimmed from {} pairs to {}, {:.4f} of total\".format(len(pairs), len(keep_pairs), len(keep_pairs) / len(pairs)))\r\n    return keep_pairs\r\n#å®é™…è¿›è¡Œå¤„ç†\r\npairs = trimRareWords(voc, pairs, MIN_COUNT)\r\nprint(voc.word2count)\r\nprint(\"\\npairs:\")\r\nfor pair in pairs:\r\n    print(pair)\r\n```\r\n\r\n### è¯­å¥å¼ é‡\r\n\r\n> å°†è¯­å¥è½¬æ¢ä¸ºç´¢å¼•å’Œæ—¶é—´æ­¥æ‰€æ„æˆçš„å¼ é‡ï¼Œè®©å…¶å¯ä»¥åˆ†æ‰¹æ¬¡æˆ–è€…è·¨æ‰¹æ¬¡å¤„ç†\r\n> > ç´¢å¼•ï¼šå°†å•è¯è½¬åŒ–ä¸ºè¯æ±‡è¡¨ä¸­çš„ç´¢å¼•  \r\n> > æ—¶é—´æ­¥ï¼šå°†å¥å­ä¸­çš„å•è¯æŒ‰ç…§é¡ºåºæ’åˆ—ï¼Œæ¯ä¸ªå•è¯éƒ½æœ‰ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œæ—¶é—´æ­¥ä»1å¼€å§‹ï¼Œæœ€åä¸€ä¸ªæ—¶é—´æ­¥ä¸ºå¥å­çš„é•¿åº¦  \r\n> > \r\n> > å¼ é‡ï¼šä¸ºäº†åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œé‡å¤åˆ©ç”¨cpuçš„å¹¶è¡Œèƒ½åŠ›ï¼Œæˆ‘ä»¬æŠŠæ‰¹å¤„ç†çš„é‡å®šä¹‰ä¸ºä¸€ä¸ªå½¢çŠ¶å¼ é‡ï¼ˆmax_length x batch_sizeï¼‰\r\n> > > å½¢çŠ¶å¼ é‡ä¸­çš„æ¯ä¸ªå¥å­é•¿åº¦éƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœå°äºmax_lengthï¼Œåˆ™éœ€è¦åœ¨EOS_tokenåé¢å¡«å……0[PAD_token]ï¼Œä½¿å¾—æ¯ä¸ªæ‰¹æ¬¡çš„å¥å­é•¿åº¦ä¸€æ ·\r\n> > > è€Œéé›¶çš„éƒ¨åˆ†ï¼Œå°±æ˜¯å•è¯çš„ç´¢å¼•\r\n> > æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬ç½®è¯¥å¼ é‡çš„æ–¹å¼æ¥å°†æ¯ä¸€è¡Œä»£è¡¨æ¯ä¸ªå¥å­çš„æ‰€æœ‰ç´¢å¼•ï¼Œå˜ä¸ºæ¯ä¸€è¡Œä»£è¡¨åŒä¸€æ—¶é—´å¤„ç†çš„æ‰€æœ‰ç´¢å¼•ã€æ¯æ‰¹æ•°æ®éƒ½æ˜¯åŒæ—¶å¼€å§‹å¤„ç†çš„ã€‘ï¼Œå¯ä»¥æ›´å¥½åœ°è·¨æ‰¹æ¬¡å¤„ç†  \r\n>   \r\n> åŒæ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªäºŒè¿›åˆ¶æ©ç å¼ é‡æ¥æ–¹ä¾¿è®¡ç®—ï¼ŒPAD_tokençš„ä½ç½®ä¸º0ï¼Œå…¶ä»–ä½ç½®ä¸º1ï¼Œè¿™æ ·åœ¨è®¡ç®—lossæ—¶ï¼Œå°±å¯ä»¥å¿½ç•¥PAD_tokençš„å½±å“  \r\n> å®šä¹‰è¾“å‡ºçš„ç›®æ ‡å¼ é‡ï¼Œå‡†å¤‡è®¡ç®—loss\r\n\r\nå‚è€ƒgithub:å¯¹è‹±è¯­çš„è‡ªç„¶è¯­è¨€å¤„ç†\r\nhttps://github.com/chongzicbo/nlp-ml-dl-notes/blob/4d88ad096ced23393aa94c4bec32a1afb8f58cd0/code/pytorch_tutorials/pytorch_chatbot.ipynb#L708\r\n\r\n```\r\n\r\ndef indexesFromSentence(voc, sentence):\r\n    return [voc.word2index[word] for word in jieba.cut(sentence)] + [EOS_token]\r\n\r\n\r\n# åˆå¹¶æ•°æ®ï¼Œç›¸å½“äºè¡Œåˆ—è½¬ç½® | å°†å¤šä¸ªåˆ—è¡¨ä»¥çºµå‘çš„æ–¹å¼è¿›è¡Œå°è£…ï¼Œè¿”å›åˆ—è¡¨é•¿åº¦ä»¥åŸåˆ—è¡¨æœ€é•¿é•¿åº¦ä¸ºå‡†\r\ndef zeroPadding(l, fillvalue=PAD_token):\r\n    return list(itertools.zip_longest(*l, fillvalue=fillvalue))  # é€šè¿‡è¿”å›åŒ…å«æ‰€æœ‰ç¬¬iä¸ªå…ƒç´ çš„å…ƒç»„çš„è¿­ä»£å™¨æ¥è½¬ç½®æ•°æ®\r\n\r\n\r\n# è®°å½•PADtokençš„ä½ç½®ä¸º0ï¼Œå…¶ä»–çš„ä¸º1\r\ndef binaryMatrix(l, value=PAD_token):\r\n    m = []\r\n    for i, seq in enumerate(l):\r\n        m.append([])\r\n        for token in seq:\r\n            if token == PAD_token:\r\n                m[i].append(0)\r\n            else:\r\n                m[i].append(1)\r\n    return m\r\n\r\n\r\n# è¿”å›å¡«å……å‰(åŠ å…¥ç»“æŸindexEOS tokenåšæ ‡è®°)çš„é•¿åº¦å’Œå¡«å……åçš„è¾“å…¥åºåˆ—å¼ é‡\r\ndef inputVar(l, voc):\r\n    indexes_batch = [indexesFromSentence(voc, sentence) for sentence in l]\r\n    lengths = torch.tensor([len(indexes) for indexes in indexes_batch])\r\n    padList = zeroPadding(indexes_batch)\r\n    padVar = torch.LongTensor(padList)\r\n    return padVar, lengths  # å¥å­é•¿åº¦åˆ—è¡¨\r\n\r\n\r\n# è¿”å›å¡«å……ç›®æ ‡åºåˆ—å¼ é‡ã€å¡«å……æ©ç å’Œæœ€å¤§ç›®æ ‡é•¿éšœdef outputVar(l, voc):\r\n\r\n# è¿”å›å¡«å……å‰(åŠ å…¥ç»“æŸindex EOS_tokenåšæ ‡è®°)æœ€é•¿çš„ä¸€ä¸ªé•¿åº¦å’Œå¡«å……åçš„è¾“å…¥åºåˆ—å¼ é‡å’Œå¡«å……åçš„æ ‡è®°mask\r\ndef outputVar(l, voc):\r\n    indexes_batch = [indexesFromSentence(voc, sentence) for sentence in l]\r\n    max_target_len = max([len(indexes) for indexes in indexes_batch])\r\n    padList = zeroPadding(indexes_batch)\r\n    mask = binaryMatrix(padList)  # è¿”å›äºŒè¿›åˆ¶çš„mask tensor å¤§å°ä¸ç›®æ ‡å¼ é‡ç›¸åŒ,å› ä¸ºæ˜¯æ©ç å¼ é‡ï¼Œæ­¤æ—¶PAD_tokençš„ä½ç½®ä¸º1ï¼Œå…¶ä»–çš„ä¸º0\r\n    mask = torch.ByteTensor(mask)\r\n    padVar = torch.LongTensor(padList)\r\n    return padVar, mask, max_target_len\r\n\r\n\r\ndef batch2TrainData(voc, pair_batch):\r\n    pair_batch.sort(key=lambda x: len(x[0].split(\" \")), reverse=True)\r\n    input_batch, output_batch = [], []\r\n    for pair in pair_batch:\r\n        input_batch.append(pair[0]) # é—®å¥\r\n        output_batch.append(pair[1]) # ç­”å¥\r\n    inp, lengths = inputVar(input_batch, voc)\r\n    output, mask, max_target_len = outputVar(output_batch, voc)\r\n    return inp, lengths, output, mask, max_target_len\r\n\r\n\r\n# è¿”å›ç»™å®š batchå¯¹çš„æ‰€æœ‰é¡¹ç›®\r\ndef batch2TrainData(voc, pair_batch):\r\n    pair_batch.sort(key=lambda x: len(jieba.lcut(x[0])), reverse=True) # ä»¥è¯è¯­æ•°é‡æ’åº\r\n    input_batch, output_batch = [], []\r\n    for pair in pair_batch:\r\n        input_batch.append(pair[0])\r\n        output_batch.append(pair[1])\r\n    inp, lengths = inputVar(input_batch, voc)\r\n    output, mask, max_target_len = outputVar(output_batch, voc)\r\n    return inp, lengths, output, mask, max_target_len\r\n\r\n\r\n# éªŒè¯ä¾‹å­\r\nsmall_batch_size = 5\r\nbatches = batch2TrainData(voc, [random.choice(pairs) for _ in range(small_batch_size)])\r\ninput_variable, lengths, target_variable, mask, max_target_len = batches\r\nprint(\"input_variable:\", input_variable)\r\nprint(\"lengths:\", lengths)\r\nprint(\"target_variable:\", target_variable)\r\nprint(\"mask:\", mask)\r\n\r\n```\r\n\r\n### å®šä¹‰æ¨¡å‹\r\n    </mark>\r\n    <img src=\"Encoder_decoder_with_pair_of_RNNS.jpg\">\r\n    <mark class=\"markdown\">\r\n> è¿™é‡Œä½¿ç”¨äº†åºåˆ—åˆ°åºåˆ—çš„æ¨¡å‹\r\n> > 1. ç¼–ç å™¨ï¼šå°†è¾“å…¥åºåˆ—è½¬æ¢ä¸ºä¸Šä¸‹æ–‡å‘é‡\r\n> > 2. è§£ç å™¨ï¼šå°†ä¸Šä¸‹æ–‡å‘é‡è½¬æ¢ä¸ºè¾“å‡ºåºåˆ—, è¿”å›ä¸‹ä¸€ä¸ªå•è¯çš„æ¦‚ç‡ï¼Œä¸‹ä¸€æ¬¡è¿­ä»£ä½¿ç”¨çš„state\r\n\r\n> ä½¿ç”¨äº†å¤šå±‚é—¨å¾ªç¯å•å…ƒGRU(RUNå˜ä½“)\r\n> > å…·æœ‰ä¸¤ä¸ªè¾“å…¥é¡ºåºç›¸åçš„ç‹¬ç«‹RUNï¼Œæä¾›è¿‡å»å’Œæœªæ¥ä¸Šä¸‹æ–‡çš„ä¼˜åŠ¿\r\n\r\n> embedding\r\n> > ä½œç”¨ï¼šå°†æ¯ä¸ªå•è¯æ˜ å°„åˆ°ç‰¹å¾ç©ºé—´\r\n> > ç›®çš„ï¼šç‰¹å¾ç©ºé—´ä¸­çš„å€¼ä¼šè¢«è®­ç»ƒä¸ºå’Œå®ƒä»¬æœ‰ç›¸ä¼¼æ„ä¹‰çš„è¯è¯­\r\n\r\n> Attn\r\n> > ä»¥ä¸Šä¸€ä¸ªè§£ç å™¨è¿”å›çš„stateä¸ºåŸºç¡€ï¼Œè®¡ç®—å‡ºæ³¨æ„åŠ›æƒé‡ï¼Œç”Ÿæˆæƒé‡å¼ é‡\r\n</mark>\r\n<img src=\"Encoder_decoder_with_attention.jpg\">\r\n<mark class=\"markdown\">\r\n ```\r\n class EncoderRNN(nn.Module):\r\n    def __init__(self, hidden_size, embedding, n_layers=1, dropout=0):\r\n        super(EncoderRNN, self).__init__()\r\n        self.n_layers = n_layers\r\n        self.hidden_size = hidden_size\r\n        self.embedding = embedding\r\n\r\n        # Initialize GRU; the input_size and hidden_size params are both set to \'hidden_size\'\r\n        #   because our input size is a word embedding with number of features == hidden_size\r\n        self.gru = nn.GRU(hidden_size, hidden_size, n_layers, dropout=(0 if n_layers == 1 else dropout),\r\n                          bidirectional=True)\r\n\r\n    def forward(self, input_seq, input_lengths, hidden=None):\r\n        # å°†è¾“å…¥çš„è¯ç´¢å¼•è½¬ä¸ºword embedding\r\n        embedded = self.embedding(input_seq)\r\n        # pack padded batch of sequences for RNN module\r\n        packed = torch.nn.utils.rnn.pack_padded_sequence(embedded, input_lengths)\r\n        # å°†packåçš„è¾“å…¥é€è¿›gru\r\n        outputs, hidden = self.gru(packed, hidden)\r\n        # unpack padding\r\n        outputs, _ = torch.nn.utils.rnn.pad_packed_sequence(outputs)\r\n        # ä¸¤ä¸ªæ–¹å‘ç›¸åŠ \r\n        outputs = outputs[:, :, :self.hidden_size] + outputs[:, :, self.hidden_size:]\r\n        return outputs, hidden\r\n\r\n\r\nclass Attn(torch.nn.Module):\r\n    def __init__(self, method, hidden_size):\r\n        super(Attn, self).__init__()\r\n        self.method = method\r\n        if self.method not in [\"dot\", \"general\", \"concat\"]:\r\n            raise ValueError(self.method, \"is not an appropriate attention method\")\r\n\r\n        self.hidden_size = hidden_size\r\n        if self.method == \"general\":\r\n            self.attn = torch.nn.Linear(self.hidden_size, hidden_size)\r\n        elif self.method == \"concat\":\r\n            self.attn = torch.nn.Linear(self.hidden_size * 2, hidden_size)\r\n            self.v = torch.nn.Parameter(torch.FloatTensor(hidden_size))  # å¯è®­ç»ƒå‚æ•°\r\n\r\n    def dot_score(self, hidden, encoder_output):\r\n        return torch.sum(hidden * encoder_output, dim=2)\r\n\r\n    def general_score(self, hidden, encoder_output):\r\n        energy = self.attn(encoder_output)\r\n        return torch.sum(hidden * energy, dim=2)\r\n\r\n    def concat_score(self, hidden, encoder_output):\r\n        energy = self.attn(torch.cat((hidden.expand(encoder_output.size(0), -1, -1), encoder_output), 2)).tanh()\r\n        return torch.sum(self.v * energy, dim=2)\r\n\r\n    def forward(self, hidden, encoder_outputs):\r\n        # è®¡ç®—æƒé‡\r\n        if self.method == \"general\":\r\n            attn_energies = self.general_score(hidden, encoder_outputs)\r\n        elif self.method == \"concat\":\r\n            attn_energies = self.concat_score(hidden, encoder_outputs)\r\n        elif self.method == \"dot\":\r\n            attn_energies = self.dot_score(hidden, encoder_outputs)\r\n\r\n        # è½¬ç½® max_lengthå’Œbatch_sizeç»´\r\n        attn_energies = attn_energies.t()\r\n\r\n        # è¿”å›å½’ä¸€åŒ–çš„æ¦‚ç‡å¾—åˆ†\r\n        return F.softmax(attn_energies, dim=1).unsqueeze(1)\r\n\r\n\r\nclass LuongAttnDecoderRNN(nn.Module):\r\n    def __init__(self, attn_model, embedding, hidden_size, output_size, n_layers=1, dropout=0.1):\r\n        super(LuongAttnDecoderRNN, self).__init__()\r\n\r\n        self.attn_model = attn_model\r\n        self.hidden_size = hidden_size\r\n        self.output_size = output_size\r\n        self.n_layers = n_layers\r\n        self.dropout = dropout\r\n\r\n        self.embedding = embedding\r\n        self.embedding_dropout = nn.Dropout(dropout)\r\n        self.gru = nn.GRU(hidden_size, hidden_size, n_layers, dropout=(0 if n_layers == 1 else dropout))\r\n        self.concat = nn.Linear(hidden_size * 2, hidden_size)\r\n        self.out = nn.Linear(hidden_size, output_size)\r\n        self.attn = Attn(attn_model, hidden_size)\r\n\r\n    def forward(self, input_step, last_hidden, encoder_outputs):\r\n        embedded = self.embedding(input_step)  # è¾“å…¥ä¸€ä¸ªå•è¯ï¼Œè·å–Embeddingå‘é‡\r\n        embedded = self.embedding_dropout(embedded)  # å¯¹Embeddingå‘é‡è¿›è¡ŒDropout\r\n        rnn_output, hidden = self.gru(embedded, last_hidden)  # å°†Dropoutåçš„embeddingå‘é‡è¾“å…¥GRUæ¨¡å—\r\n        # è®¡ç®—æ³¨æ„åŠ›æƒé‡\r\n        attn_weights = self.attn(rnn_output, encoder_outputs)  # ä½¿ç”¨è§£ç å™¨ä¸­å½“å‰æ—¶é—´æ­¥GRUçš„outputä¸encoder_outputsè®¡ç®—æ³¨æ„åŠ›\r\n        context = attn_weights.bmm(\r\n            encoder_outputs.transpose(0, 1))  # bmm:batchçš„çŸ©é˜µä¹˜æ³• ï¼Œæ³¨æ„åŠ›çŸ©é˜µå’Œencoder_outputsè¿›è¡Œè®¡ç®—è·å–context\r\n        rnn_output = rnn_output.squeeze(0)\r\n        context = context.squeeze(1)\r\n        concat_input = torch.cat((rnn_output, context), 1)\r\n        concat_output = torch.tanh(self.concat(concat_input))\r\n        # é¢„æµ‹ä¸‹ä¸€ä¸ªè¯\r\n        output = self.out(concat_output)\r\n        output = F.softmax(output, dim=1)\r\n        return output, hidden\r\n ```\r\n\r\n ### è®¡ç®—æŸå¤±\r\n > è¯¥æŸå¤±å‡½æ•°è®¡ç®—ä¸æ©ç å¼ é‡ä¸­1å¯¹åº”çš„ä½ç½®çš„å¹³å‡è´Ÿå¯¹æ•°ä¼¼ç„¶\r\n\r\n > å¹³å‡è´Ÿå¯¹æ•°ä¼¼ç„¶\r\n \r\n > ä¼¼ç„¶\r\n > > æ•°å­¦ä¸Šçš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ˜¯æŒ‡ï¼Œé€šè¿‡å·²çŸ¥çš„éšæœºæ ·æœ¬ï¼ˆçš„æ¦‚ç‡ï¼‰è®¡ç®—åŸæ¨¡å‹ï¼ˆå‘ç”Ÿï¼‰çš„æ¦‚ç‡\r\n\r\n > è´Ÿå¯¹æ•°\r\n > > å°†å®¹æ˜“ä¸ç¨³å®šæˆ–æº¢å‡ºçš„å°æ¦‚ç‡è½¬æ¢ä¸ºç›¸å¯¹åº”çš„å®¹æ˜“è®¡ç®—çš„å¤§æ¦‚ç‡\r\n\r\n ```\r\ndef maskNLLLoss(inp,target,mask):\r\nnTotal=mask.sum()\r\ncrossEntropy=-torch.log(torch.gather(inp,1,target.view(-1,1)).squeeze(1))\r\nloss=crossEntropy.masked_select(mask.bool()).mean()\r\nloss=loss.to(device)\r\nreturn loss,nTotal.item()\r\n```\r\n\r\n### è®­ç»ƒè¿­ä»£\r\n\r\n> é›¶åŒ–æ¢¯åº¦\r\n> > æ¢¯åº¦æ˜¯æŸå¤±å‡½æ•°å¯¹äºæ¨¡å‹å‚æ•°çš„å˜åŒ–ç‡ï¼Œå½’é›¶æ˜¯ä¸ºäº†é¿å…ä¸Šæ¬¡å‚æ•°å½±å“è¿™æ¬¡è®¡ç®—å‡ºçš„æ¢¯åº¦\r\n\r\n```\r\nMAX_LENGTH = 10\r\nteacher_forcing_ratio = 0.3\r\n\r\ndef train(input_variable, lengths, target_variable, mask, max_target_len, encoder, decoder, embedding, encoder_optimizer, decoder_optimizer, batch_size, clip, max_length=MAX_LENGTH):\r\n    # æ¢¯åº¦å½’é›¶\r\n    encoder_optimizer.zero_grad()\r\n    decoder_optimizer.zero_grad()\r\n\r\n    # è®¾ç½®è®¾å¤‡é€‰é¡¹\r\n    input_variable = input_variable.to(device)\r\n    lengths = lengths.to(device)\r\n    target_variable = target_variable.to(device)\r\n    mask = mask.to(device)\r\n\r\n    # åˆå§‹åŒ–å˜é‡\r\n    loss = 0\r\n    print_losses = []\r\n    n_totals = 0\r\n\r\n    encoder_outputs, encoder_hidden = encoder(input_variable, lengths)\r\n\r\n    decoder_input = torch.LongTensor([[SOS_token for _ in range(batch_size)]])\r\n    decoder_input = decoder_input.to(device)\r\n\r\n    # encoderæœ€åçš„éšè—çŠ¶æ€ä½œä¸ºdecoderçš„åˆå§‹éšè—çŠ¶æ€\r\n    decoder_hidden = encoder_hidden[:decoder.n_layers]\r\n\r\n    # æ˜¯å¦ä½¿ç”¨teacher forcing\r\n    use_teacher_forcing = True if random.random() < teacher_forcing_ratio else False\r\n\r\n    if use_teacher_forcing:\r\n        for t in range(max_target_len):\r\n            decoder_output, decoder_hidden = decoder(decoder_input, decoder_hidden, encoder_outputs)\r\n            # Teacher forcing: next input is current target\r\n            decoder_input = target_variable[t].view(1, -1)\r\n\r\n            # è®¡ç®—æŸå¤±\r\n            mask_loss, nTotal = maskNLLLoss(decoder_output, target_variable[t], mask[t])\r\n            loss += mask_loss\r\n            print_losses.append(mask_loss.item() * nTotal)\r\n            n_totals += nTotal\r\n\r\n    else:\r\n        for t in range(max_target_len):\r\n            decoder_output, decoder_hidden = decoder(decoder_input, decoder_hidden, encoder_outputs)\r\n            _, topi = decoder_output.topk(1)\r\n            decoder_input = torch.LongTensor([[topi[i][0] for i in range(batch_size)]])\r\n            decoder_input = decoder_input.to(device)\r\n\r\n            # è®¡ç®—æŸå¤±\r\n            mask_loss, nTotal = maskNLLLoss(decoder_output, target_variable[t], mask[t])\r\n            loss += mask_loss\r\n            print_losses.append(mask_loss.item() * nTotal)\r\n            n_totals += n_totals\r\n\r\n    # åå‘ä¼ æ’­\r\n    loss.backward()\r\n    # æ¢¯åº¦è£å‰ª\r\n    _ = torch.nn.utils.clip_grad_norm_(encoder.parameters(), clip)\r\n    _ = torch.nn.utils.clip_grad_norm_(decoder.parameters(), clip)\r\n\r\n    # æƒé‡æ›´æ–°\r\n    encoder_optimizer.step()\r\n    decoder_optimizer.step()\r\n\r\n    return sum(print_losses) / n_totals\r\n\r\n# è¿­ä»£è¿è¡Œ\r\ndef trainIters(model_name, voc, pairs, encoder, decoder, encoder_optimizer, decoder_optimizer, embedding,\r\n               encoder_n_layers, decoder_n_layers, save_dir, n_iteration, batch_size, print_every, save_every, clip,\r\n               corpus_name, loadFilename):\r\n    training_batches = [batch2TrainData(voc, [random.choice(pairs) for _ in range(batch_size)]) for _ in\r\n                        range(n_iteration)]\r\n    print(\"åˆå§‹åŒ–...\")\r\n    start_iteration = 1\r\n    print_loss = 0\r\n    if loadFilename:\r\n        start_iteration = checkpoint[\'iteration\'] + 1\r\n    print(\"Training...\")\r\n    for iteration in range(start_iteration, n_iteration + 1):\r\n        training_batch = training_batches[iteration - 1]\r\n        # æå–è®­ç»ƒæ‰€éœ€æ•°æ®\r\n        input_variable, lengths, target_variable, mask, max_target_len = training_batch\r\n        loss = train(input_variable, lengths, target_variable, mask, max_target_len, encoder, decoder, embedding,\r\n                     encoder_optimizer, decoder_optimizer, batch_size, clip)\r\n        print_loss += loss\r\n\r\n        if iteration % print_every == 0:\r\n            print_loss_avg = print_loss / print_every\r\n            print(\"Iteration: {}; Percent complete: {:.1f}%; Average loss: {:.4f}\".format(iteration,\r\n                                                                                          iteration / n_iteration * 100,\r\n                                                                                          print_loss_avg))\r\n            print_loss = 0\r\n\r\n        # save checkpoint\r\n        if (iteration % save_every == 0):\r\n            directory = os.path.join(save_dir, model_name, corpus_name,\r\n                                     \"{}-{}-{}\".format(encoder_n_layers, decoder_n_layers, hidden_size))\r\n            if not os.path.exists(directory):\r\n                os.makedirs(directory)\r\n            torch.save({\"iteration\": iteration, \"en\": encoder.state_dict(), \"de\": decoder.state_dict(),\r\n                        \"en_opt\": encoder_optimizer.state_dict(),\r\n                        \"de_opt\": decoder_optimizer.state_dict(), \"loss\": loss, \"voc_dict\": voc.__dict__,\r\n                        \"embedding\": embedding.state_dict()\r\n                        }, os.path.join(directory, \"{}_{}.tar\".format(iteration, \"checkpoint\")))\r\n\r\n\r\n```\r\n\r\n### è¯„ä¼°\r\n\r\n> è¯„ä¼°å•è¯å’Œå¥å­ï¼Œè®©å®ƒä»¬åœ¨æ²¡æœ‰è¾“å‡ºè¿”å›æ•°æ®çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æ ¹æ®æ¦‚ç‡åˆ†å¸ƒæƒ…å†µé€‰æ‹©ä¸‹ä¸€ä¸ªå•è¯\r\n\r\n> æ ‡å‡†åŒ–\r\n> > å°†è¾“å…¥è½¬åŒ–ä¸ºç¬¦åˆå¤„ç†æ ‡å‡†çš„å­—ç¬¦ä¸²\r\n\r\n```\r\nclass GreedySearchDecoder(nn.Module):\r\n    def __init__(self, encoder, decoder):\r\n        super(GreedySearchDecoder, self).__init__()\r\n        self.encoder = encoder\r\n        self.decoder = decoder\r\n\r\n    def forward(self, input_seq, input_length, max_length):\r\n        # Forward input through encoder model\r\n        encoder_outputs, encoder_hidden = self.encoder(input_seq, input_length)\r\n        # Prepare encoder\'s final hidden layer to be first hidden input to the decoder\r\n        decoder_hidden = encoder_hidden[:decoder.n_layers]\r\n        # Initialize decoder input with SOS_token\r\n        decoder_input = torch.ones(1, 1, device=device, dtype=torch.long) * SOS_token\r\n        # Initialize tensors to append decoded words to\r\n        all_tokens = torch.zeros([0], device=device, dtype=torch.long)\r\n        all_scores = torch.zeros([0], device=device)\r\n        # Iteratively decode one word token at a time\r\n        for _ in range(max_length):\r\n            # Forward pass through decoder\r\n            decoder_output, decoder_hidden = self.decoder(decoder_input, decoder_hidden, encoder_outputs)\r\n            # Obtain most likely word token and its softmax score\r\n            decoder_scores, decoder_input = torch.max(decoder_output, dim=1)\r\n            # Record token and score\r\n            all_tokens = torch.cat((all_tokens, decoder_input), dim=0)\r\n            all_scores = torch.cat((all_scores, decoder_scores), dim=0)\r\n            # Prepare current token to be next decoder input (add a dimension)\r\n            decoder_input = torch.unsqueeze(decoder_input, 0)\r\n        # Return collections of word tokens and scores\r\n        return all_tokens, all_scores\r\n    \r\ndef evaluate(encoder, decoder, searcher, voc, sentence, max_length=MAX_LENGTH):\r\n    ### Format input sentence as a batch\r\n    # words -> indexes\r\n    indexes_batch = [indexesFromSentence(voc, sentence)]\r\n    # Create lengths tensor\r\n    lengths = torch.tensor([len(indexes) for indexes in indexes_batch])\r\n    # Transpose dimensions of batch to match models\' expectations\r\n    input_batch = torch.LongTensor(indexes_batch).transpose(0, 1)\r\n    # Use appropriate device\r\n    input_batch = input_batch.to(device)\r\n    lengths = lengths.to(device)\r\n    # Decode sentence with searcher\r\n    tokens, scores = searcher(input_batch, lengths, max_length)\r\n    # indexes -> words\r\n    decoded_words = [voc.index2word[token.item()] for token in tokens]\r\n    return decoded_words\r\n\r\ndef evaluateInput(encoder, decoder, searcher, voc):\r\n    input_sentence = \'\'\r\n    while(1):\r\n        try:\r\n            # Get input sentence\r\n            input_sentence = input(\'> \')\r\n            # Check if it is quit case\r\n            if input_sentence == \'q\' or input_sentence == \'quit\': break\r\n            # Normalize sentence\r\n            input_sentence = normalizeString(input_sentence) # å˜æˆç¬¦åˆæ ‡å‡†çš„è¾“å…¥\r\n            # Evaluate sentence\r\n            output_words = evaluate(encoder, decoder, searcher, voc, input_sentence)\r\n            # Format and print response sentence\r\n            output_words[:] = [x for x in output_words if not (x == \'EOS\' or x == \'PAD\')]\r\n            print(\'Bot:\', \' \'.join(output_words))\r\n\r\n        except KeyError:\r\n            print(\"Error: Encountered unknown word.\")\r\n```\r\n\r\n### è¿è¡ŒåŠè®­ç»ƒæ¨¡å‹\r\n\r\n```\r\n# Configure models\r\nmodel_name = \'cb_model\'\r\nattn_model = \'dot\'\r\n#attn_model = \'general\'\r\n#attn_model = \'concat\'\r\nhidden_size = 500\r\nencoder_n_layers = 2\r\ndecoder_n_layers = 2\r\ndropout = 0.1\r\nbatch_size = 64\r\n\r\n# Set checkpoint to load from; set to None if starting from scratch\r\nloadFilename = None\r\ncheckpoint_iter = 200 # 4000\r\n#loadFilename = os.path.join(save_dir, model_name, \"corpus_name\",\r\n#                            \'{}-{}-{}\'.format(encoder_n_layers, decoder_n_layers, hidden_size),\r\n#                            \'{}_checkpoint.tar\'.format(checkpoint_iter))\r\n\r\n# Load model if a loadFilename is provided\r\nif loadFilename:\r\n    # If loading on same machine the model was trained on\r\n    checkpoint = torch.load(loadFilename)\r\n    # If loading a model trained on GPU to CPU\r\n    #checkpoint = torch.load(loadFilename, map_location=torch.device(\'cpu\'))\r\n    encoder_sd = checkpoint[\'en\']\r\n    decoder_sd = checkpoint[\'de\']\r\n    encoder_optimizer_sd = checkpoint[\'en_opt\']\r\n    decoder_optimizer_sd = checkpoint[\'de_opt\']\r\n    embedding_sd = checkpoint[\'embedding\']\r\n    voc.__dict__ = checkpoint[\'voc_dict\']\r\n\r\nprint(\'Building encoder and decoder ...\')\r\n# Initialize word embeddings\r\nembedding = nn.Embedding(voc.num_words, hidden_size)\r\nif loadFilename:\r\n    embedding.load_state_dict(embedding_sd)\r\n# Initialize encoder & decoder models\r\nencoder = EncoderRNN(hidden_size, embedding, encoder_n_layers, dropout)\r\ndecoder = LuongAttnDecoderRNN(attn_model, embedding, hidden_size, voc.num_words, decoder_n_layers, dropout)\r\nif loadFilename:\r\n    encoder.load_state_dict(encoder_sd)\r\n    decoder.load_state_dict(decoder_sd)\r\n# Use appropriate device\r\nencoder = encoder.to(device)\r\ndecoder = decoder.to(device)\r\nprint(\'Models built and ready to go!\')\r\n\r\n\r\n# Configure training/optimization\r\nclip = 50.0\r\nteacher_forcing_ratio = 1.0\r\nlearning_rate = 0.0001\r\ndecoder_learning_ratio = 5.0\r\nn_iteration = 200 # 4000 # 0\r\nprint_every = 1\r\nsave_every = 100 # 500\r\n\r\n# Ensure dropout layers are in train mode\r\nencoder.train()\r\ndecoder.train()\r\n\r\n# Initialize optimizers\r\nprint(\'Building optimizers ...\')\r\nencoder_optimizer = optim.Adam(encoder.parameters(), lr=learning_rate)\r\ndecoder_optimizer = optim.Adam(decoder.parameters(), lr=learning_rate * decoder_learning_ratio)\r\nif loadFilename:\r\n    encoder_optimizer.load_state_dict(encoder_optimizer_sd)\r\n    decoder_optimizer.load_state_dict(decoder_optimizer_sd)\r\n\r\n# Run training iterations\r\nprint(\"Starting Training!\")\r\ntrainIters(model_name, voc, pairs, encoder, decoder, encoder_optimizer, decoder_optimizer,\r\n           embedding, encoder_n_layers, decoder_n_layers, save_dir, n_iteration, batch_size,\r\n           print_every, save_every, clip, \"corpus_name\", loadFilename)\r\n```\r\n\r\n### å¯åŠ¨\r\n> å¯ä»¥å°†ä¹‹å‰çš„è¿­ä»£æ¬¡æ•°è®¾ç½®ä¸º0ä»¥å¿«é€Ÿå¯åŠ¨\r\n```\r\n# Set dropout layers to eval mode\r\nencoder.eval()\r\ndecoder.eval()\r\n\r\n# Initialize search module\r\nsearcher = GreedySearchDecoder(encoder, decoder)\r\n\r\n# Begin chatting (uncomment and run the following line to begin)\r\nevaluateInput(encoder, decoder, searcher, voc)\r\n```\r\n', '2025-01-11 10:25:42'),(12, 2, 'BS4', '## BS4\r\n### çˆ¬å–ç‰¹å®šæ–‡æœ¬å’Œå±æ€§\r\n```\r\nfrom bs4 import BeautifulSoup\r\n\r\nhtml_doc = \"\"\"\r\n<html>\r\n  <body>\r\n    <div class=\"content\">Content 1</div>\r\n    <div id=\"main\" class=\"content\">Content 2</div>\r\n    <div class=\"content\" data-type=\"important\">Important Content</div>\r\n  </body>\r\n</html>\r\n\"\"\"\r\n\r\n# å‡è®¾html_docæ˜¯ç½‘é¡µæºä»£ç ï¼Œä½¿ç”¨Beautiful Soupè§£æ\r\nsoup = BeautifulSoup(html_doc, \'html.parser\')\r\n\r\n# æŸ¥æ‰¾æ‰€æœ‰å¸¦æœ‰ç‰¹å®šå±æ€§data-typeçš„<div>æ ‡ç­¾\r\ndivs_with_attr = soup.find_all(\'div\', {\'data-type\': \'important\'})\r\n\r\n# æ‰“å°ç»“æœ\r\nfor div in divs_with_attr:\r\n    print(div.text)\r\n\r\n\r\nhtml_doc = \"\"\"\r\n<html>\r\n  <body>\r\n    <p>This is a paragraph with some text.</p>\r\n    <p>Another paragraph with different text.</p>\r\n    <p>One more paragraph here.</p>\r\n  </body>\r\n</html>\r\n\"\"\"\r\n\r\n# å‡è®¾html_docæ˜¯ç½‘é¡µæºä»£ç ï¼Œä½¿ç”¨Beautiful Soupè§£æ\r\nsoup = BeautifulSoup(html_doc, \'html.parser\')\r\n\r\n# æŸ¥æ‰¾åŒ…å«ç‰¹å®šæ–‡å­—å†…å®¹çš„<p>æ ‡ç­¾\r\ntarget_text = \'different text\'\r\nparagraphs_with_text = soup.find_all(\'p\', string=lambda string: string and target_text in string)\r\n\r\n# æ‰“å°ç»“æœ\r\nfor p in paragraphs_with_text:\r\n    print(p.text)\r\n```\r\n', '2025-01-11 10:30:18'),(13, 2, 'LeetCode106', '## LeetCode106\r\n```python\r\n# Definition for a binary tree node.\r\nfrom typing import List, Optional\r\n\r\n\r\nclass TreeNode(object):\r\n    def __init__(self, val=0, left=None, right=None):\r\n        self.val = val\r\n        self.left = left\r\n        self.right = right\r\n\r\ndef inorder(root):\r\n    if root is None:\r\n        return\r\n    inorder(root.left)\r\n    print(root.val)\r\n    inorder(root.right)\r\n\r\ndef postorder(root):\r\n    if root is None:\r\n        return\r\n    postorder(root.left)\r\n    postorder(root.right)\r\n    print(root.val)\r\n\r\ndef preorder(root):\r\n    if root is None:\r\n        return\r\n    print(root.val)\r\n    preorder(root.left)\r\n    preorder(root.right)\r\n\r\ntr27 = TreeNode(27); tr55 = TreeNode(55)\r\n\r\n# first\r\ntree = TreeNode(67)\r\n# second & third\r\ntree.left = TreeNode(30, TreeNode(34), tr27)\r\ntree.right = TreeNode(70, TreeNode(66), tr55)\r\n# forth\r\ntr27.left = TreeNode(12)\r\ntr55.left = TreeNode(41)\r\n\r\ninorder(tree)\r\nprint(\"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\")\r\npreorder(tree)\r\n\r\ninorder = [9, 3, 15, 20, 7]\r\npostorder = [9, 15, 7, 20, 3]\r\n\r\n```\r\n> å¯¹äºä¸åŒé¡ºåºçš„éå†æ¨å¯¼ä¸»è¦ä¸ºï¼šæŸ¥çœ‹æºä»£ç æ‰§è¡Œï¼Œè¿”å›ä¸Šä¸€å±‚æˆ–è€…å·²ç»éå†è¿‡éƒ½ä¸ä¼šæ‰“å°\r\n\r\n> 1.æŠ“ä½å³åºéå†æ ¹èŠ‚ç‚¹æ°¸è¿œåœ¨æœ€å³è¾¹çš„è§„å¾‹  \r\n> 2.é€šè¿‡å³åºéå†å¾—åˆ°çš„æ ¹èŠ‚ç‚¹ï¼Œåœ¨ä¸­åºéå†ä¸­é€’å½’å¯»æ‰¾æ•´é¢—æ•°  \r\n> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”  \r\n> 3.é€šè¿‡å¯¹å³åºéå†åˆ—è¡¨çš„æ“ä½œ, ä¿ç•™é€’å½’å±‚æ•°ä½ç½®çš„æ•°æ®  \r\n> é€€å‡ºæ¡ä»¶ï¼šæ²¡æœ‰å¤šçš„æ•°å­—ç»™æ‰¾åˆ°çš„æ ¹èŠ‚ç‚¹åšå­æ ‘  \r\n\r\n> è‰ç¨¿ï¼š  \r\n> å…ˆæ‰“å°é€€å‡ºæ¡ä»¶çš„æ•°ä¸ºï¼š  \r\n\r\n> å‚è€ƒä¸€: https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/solutions/426738/cong-zhong-xu-yu-hou-xu-bian-li-xu-lie-gou-zao-14/?envType=daily-question&envId=2024-02-21\r\n\r\n```python\r\ndef printTree(root, level=0, prefix=\"Root:\"):\r\n    if root is not None:\r\n        print(\" \" * (level * 4) + prefix, root.val)\r\n        printTree(root.left, level + 1, \"L:\")\r\n        printTree(root.right, level + 1, \"R:\")\r\n\r\nclass Solution:\r\n    def buildTree(self, inorder, postorder) -> TreeNode:\r\n        def helper(in_left, in_right, flag=\"right\"):\r\n            # å¦‚æœè¿™é‡Œæ²¡æœ‰èŠ‚ç‚¹æ„é€ äºŒå‰æ ‘äº†ï¼Œå°±ç»“æŸ\r\n            if in_left > in_right:\r\n                return None\r\n\r\n            # é€‰æ‹© post_idx ä½ç½®çš„å…ƒç´ ä½œä¸ºå½“å‰å­æ ‘æ ¹èŠ‚ç‚¹\r\n            val = postorder.pop()\r\n            root = TreeNode(val)\r\n\r\n            # æ ¹æ® root æ‰€åœ¨ä½ç½®åˆ†æˆå·¦å³ä¸¤æ£µå­æ ‘\r\n            index = idx_map[val]\r\n            print(index)\r\n            print(root.val, in_left, in_right, flag)\r\n\r\n            # æ„é€ å³å­æ ‘\r\n            root.right = helper(index + 1, in_right, \"right\")\r\n            # æ„é€ å·¦å­æ ‘\r\n            root.left = helper(in_left, index - 1, \"left\")\r\n            return root\r\n\r\n        # å»ºç«‹ï¼ˆå…ƒç´ ï¼Œä¸‹æ ‡ï¼‰é”®å€¼å¯¹çš„å“ˆå¸Œè¡¨\r\n        idx_map = {val: idx for idx, val in enumerate(inorder)}\r\n        return helper(0, len(inorder) - 1)\r\n\r\n\r\ninorder = [-4,-10,3,-1,7,11,-8,2]\r\npostorder = [-4,-1,3,-10,11,-8,2,7]\r\n# inorder = [9, 3, 15, 20, 7]\r\n# postorder = [9, 15, 7, 20, 3]\r\nprintTree(Solution().buildTree(inorder, postorder))\r\n\r\nprint(\"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\")\r\n\r\nclass Solution(object):\r\n    def buildTree(self, inorder, postorder):\r\n        def hRecursion(before, after, postorder, depth, flag=\"right\") -> TreeNode:\r\n            if (len(before) == 0 and len(after) == 0) or len(postorder) == 0:\r\n                return\r\n            root = postorder[-1] \r\n            out = TreeNode(root)\r\n\r\n            rootIndex = inorder.index(root)\r\n            print(root, inorder, rootIndex, postorder)\r\n	      # åç»­éå†çš„æœ€åä¸€ä¸ªå€¼åœ¨ä¸­åºéå†ä¸­çš„ç´¢å¼•å¸¦å…¥åç»­éå†ä¸­å°±æ˜¯ä¸‹ä¸€ä¸ªæ ¹èŠ‚ç‚¹çš„å€¼\r\n\r\n            after = inorder[rootIndex + 1:]\r\n            before = inorder[0:rootIndex]\r\n\r\n            if root in inorder: inorder.remove(root)\r\n\r\n            out.left = hRecursion(before, [], postorder[:rootIndex], depth, \"left\")\r\n            out.right = hRecursion([], after, postorder[rootIndex : -1], depth + 1, \"right\")\r\n\r\n            return out\r\n        return hRecursion([], inorder, postorder, 0)\r\n\r\n# inorder = [1, 2]\r\n# postorder = [2, 1]\r\n# inorder = [9, 3, 15, 20, 7]\r\n# postorder = [9, 15, 7, 20, 3]\r\n# inorder = [-1]\r\n# postorder = [-1]\r\n# inorder = [1,2,3,4]\r\n# postorder = [1,4,3,2]\r\ninorder = [-4,-10,3,-1,7,11,-8,2]\r\npostorder = [-4,-1,3,-10,11,-8,2,7]\r\nprintTree(Solution().buildTree(inorder, postorder))\r\n\r\nprint(\"â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”è¾“å‡ºâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\")\r\n\r\n7 [-4, -10, 3, -1, 7, 11, -8, 2] 4 [-4, -1, 3, -10, 11, -8, 2, 7]\r\n-10 [-4, -10, 3, -1, 11, -8, 2] 1 [-4, -1, 3, -10]\r\n-4 [-4, 3, -1, 11, -8, 2] 0 [-4]\r\n3 [3, -1, 11, -8, 2] 0 [-1, 3]\r\n-1 [-1, 11, -8, 2] 0 [-1]\r\n2 [11, -8, 2] 2 [11, -8, 2]\r\n-8 [11, -8] 1 [11, -8]\r\n11 [11] 0 [11]\r\nRoot: 7\r\n    L: -10\r\n        L: -4\r\n        R: 3\r\n            R: -1\r\n    R: 2\r\n        L: -8\r\n            L: 11\r\n```\r\n\r\n> ä¹‹å‰ä¸Šé¢çš„æ–¹æ³•æ— æ³•åœ¨é€’å½’çš„æ—¶å€™æ­£ç¡®å›åˆ°ç›¸åº”çš„å±‚æ•°ï¼Œå› ä¸ºé€’å½’çš„æ—¶å€™å±‚æ•°æ²¡æœ‰ä¿ç•™ï¼Œæ‰€ä»¥åœ¨é€’å½’çš„æ—¶å€™æ— æ³•æ­£ç¡®å›åˆ°ç›¸åº”çš„å±‚æ•°  \r\n> é€šè¿‡å‚è€ƒè¯¥æ–¹æ³•,åˆ©ç”¨å¯¹å³åºé€’å½’çš„æ“ä½œä¿ç•™å±‚æ•°æ•°æ®:é€šè¿‡ä¸­åºå’Œååºéå†çš„è§„å¾‹æ¥æ‰¾åˆ°æ­£ç¡®çš„ä¸‹ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä»¥ä¿ç•™å±‚æ•°æ•°æ®    \r\n> æŠ“ä½ä¸è®ºä¸­åºè¿˜æ˜¯ååºå·¦èŠ‚ç‚¹æ°¸è¿œå…ˆéå†çš„ç‰¹ç‚¹  \r\n> å‚è€ƒäºŒ: https://leetcode.cn/problems/construct-binary-tree-from-inorder-and-postorder-traversal/solutions/2647794/tu-jie-cong-on2-dao-onpythonjavacgojsrus-w8ny/\r\n\r\n```python\r\nclass Solution:\r\n    def buildTree(self, inorder: List[int], postorder: List[int], depth) -> Optional[TreeNode]:\r\n        if not postorder:  # ç©ºèŠ‚ç‚¹\r\n            return None\r\n        left_size = inorder.index(postorder[-1])  # å·¦å­æ ‘çš„å¤§å°\r\n        print(depth)\r\n        left = self.buildTree(inorder[:left_size], postorder[:left_size], depth + 1)\r\n        right = self.buildTree(inorder[left_size + 1:], postorder[left_size: -1], depth + 1)\r\n        return TreeNode(postorder[-1], left, right)\r\n\r\ninorder = [-4,-10,3,-1,7,11,-8,2]\r\npostorder = [-4,-1,3,-10,11,-8,2,7]\r\nprintTree(Solution().buildTree(inorder, postorder, 0))\r\n```\r\n', '2025-01-11 11:25:43'),(14, 2, 'LeetCode2312', '## LeetCode2312\r\nå›¾ç‰‡å‚è€ƒï¼šhttps://leetcode.cn/problems/selling-pieces-of-wood/solutions/2689164/javapython3cdong-tai-gui-hua-mei-ju-mei-l9bl8/  \r\nä»£ç å‚è€ƒï¼šhttps://leetcode.cn/problems/selling-pieces-of-wood/solutions/1611240/by-endlesscheng-mrmd/\r\n#### æ€è·¯\r\n> 1.ä»ç¬¬ä¸€æ­¥å¼€å§‹æ¨å¯¼ï¼šåˆ‡ç¬¬ä¸€åˆ€çš„æœ€å¤§ç»“æœå€¼å¯èƒ½ä¸º 1.æœ¬èº«å°±æœ‰x * yçš„ä»·æ ¼ 2.æ¨ªåˆ‡ä¸€åˆ€åæœ€å¤§çš„ä»·æ ¼ 3.ç«–åˆ‡ä¸€åˆ€æœ€å¤§çš„ä»·æ ¼  \r\n> 2.é€šè¿‡ç´¯åŠ ï¼Œä»å°åˆ°å¤§è®¡ç®—å‡ºæœ€å¤§ç»“æœå€¼ã€‚\r\n```python\r\n# è®°å¿†åŒ–æœç´¢ï¼šä½¿ç”¨å¤‡å¿˜å½•é¿å…é‡å¤è®¡ç®—æ¥è·³è¿‡é‡å å­é—®é¢˜çš„è®¡ç®—æ–¹å¼\r\nclass Solution:\r\n    def sellingWood(self, m: int, n: int, prices: List[List[int]]) -> int:\r\n        pr = {(x - 1, y - 1): p for x, y, p in prices}\r\n        print(pr)\r\n        f = [[0] * n for _ in range(m)]\r\n        for i in range(m):  # ä»å°åˆ°å¤§è®¡ç®—å‡ºæœ€å¤§è§£ï¼Œå½•å…¥fæ•°ç»„ï¼ˆå¤‡å¿˜å½•ï¼‰\r\n            for j in range(n):\r\n                f[i][j] = max(pr.get((i, j), 0), \r\n                          max((f[k][j] + f[i - 1 - k][j] for k in range(math.ceil((i - 1) / 2) + 1)), \r\n                              default=0),\r\n                          max((f[i][q] + f[i][j - 1 - q] for q in range(math.ceil((j - 1) / 2) + 1)), \r\n                              default=0))\r\n        return f[m - 1][n - 1]\r\n```\r\n', '2025-01-11 11:40:01'),(15, 3, 'Mailserver', '## Mailserver\r\n### é€šè¿‡dockeræ­å»ºè‡ªå·±çš„mailserveréœ€è¦ä»¥ä¸‹ç½‘å€\r\nğŸ”¥ åå‘ptrè®°å½•éœ€è¦å‘ipåœ°å€æ‹¥æœ‰è€…ç”³è¯·ï¼Œå› ä¸ºåå‘è®°å½•å±äº xx.xx.xx.in-addr.arpa åŸŸåï¼Œé˜¿é‡Œäº‘IPç›´æ¥å¼€å·¥å•æ‰¾å¯¹è¯å®¢æœï¼Œå¾ˆå¿«å¯ä»¥ç”³è¯·  \r\n- docker-mailæ­å»ºç¤ºä¾‹ï¼šhttps://docker-mailserver.github.io/docker-mailserver/latest/examples  \r\n> å¦‚æœæ²¡æœ‰å¯¹åŸŸåå¤‡æ¡ˆå¯ä»¥ä½¿ç”¨ç½‘ç«™ä¸­çš„cloudflare-dnsæ¥ç”³è¯·è¯ä¹¦\r\n- dnsè®°å½•éªŒè¯ï¼šhttps://ifthenel.se/self-hosted-mail-server/ # å…¶ä¸­DKIMçš„éªŒè¯ä¸ä¸€å®šå‡†ç¡®ï¼Œå¯ä»¥åœ¨https://dmarcly.com/tools/dkim-record-checker ä¸ŠæŸ¥çœ‹  \r\n> å¦‚æœ25ç«¯å£æ— æ³•è§£å°å¯ä»¥è€ƒè™‘é‡‡å–  \r\n> > ä¸ºpostfixè®¾ç½®relayhostï¼Œæµ‹è¯•åŠå¯ç”¨ç¬¬ä¸‰æ–¹ä¸ºï¼šhttps://docs.sendgrid.com/for-developers/sending-email/getting-started-smtp  \r\n> > è®¾ç½®relayhoståŠéªŒè¯æ–¹å¼ä¸ºï¼šhttps://www.lunanode.com/guides/postfix_smtp_secure  \r\n- å¦‚æœè¦ä½¿ç”¨apiçš„æ–¹å¼æ·»åŠ sender, æŸ¥çœ‹ï¼š \r\n> https://docs.sendgrid.com/api-reference/sender-verification/create-verified-sender-request\r\n#### docker-composeç¤ºä¾‹\r\n```\r\nmailserver:\r\n	image: ghcr.io/docker-mailserver/docker-mailserver:latest\r\n	container_name: mailserver\r\n	# Provide the FQDN of your mail server here (Your DNS MX record should point to this value)\r\n	hostname: mail.hampster.work\r\n	ports:\r\n		- \"25:25\"\r\n		- \"143:143\"\r\n		- \"110:110\"\r\n		- \"465:465\"\r\n		- \"587:587\"\r\n		- \"993:993\"\r\n	volumes:\r\n		- ./docker-data/dms/config/postfix-main.cf:/etc/postfix/main.cf\r\n		- ./docker-data/dms/config/sasl_passwd:/etc/postfix/sasl_passwd\r\n		- ./docker-data/dms/mail-data/:/var/mail/\r\n		- ./docker-data/dms/mail-state/:/var/mail-state/\r\n		- ./docker-data/dms/mail-logs/:/var/log/mail/\r\n		- ./docker-data/dms/config/:/tmp/docker-mailserver/\r\n		- /etc/localtime:/etc/localtime:ro\r\n		- ./docker-data/certbot/certs/:/etc/letsencrypt/:ro\r\n	environment:\r\n		- ENABLE_RSPAMD=1\r\n		- ENABLE_CLAMAV=1\r\n		- ENABLE_FAIL2BAN=1\r\n		- SSL_TYPE=letsencrypt\r\n	cap_add:\r\n		- NET_ADMIN # For Fail2Ban to work\r\n	command: /bin/bash -c \"supervisord -c /etc/supervisor/supervisord.conf & sleep 30 && chmod 600 /etc/postfix/sasl_passwd && postmap /etc/postfix/sasl_passwd && service postfix reload && tail -f /dev/null\"\r\n	# restart: always\r\n	networks:\r\n	- abc\r\n```\r\n#### æ³¨æ„\r\nå¦‚æœè¦é€šè¿‡ä¸‹ä¸€æ­¥éªŒè¯éœ€è¦æ‰“å¼€25ç«¯å£çš„æ˜ å°„ï¼Œæ·»åŠ \r\n```\r\nports:\r\n- \"30:25\" # 25ç«¯å£å—åˆ°é™åˆ¶ï¼Œä¸”æ£€éªŒå¯¹è±¡ä¸ºéSSLç«¯å£\r\n- \"143:143\" # +SSL : 993 # IMAP\r\n- \"110:110\" # +SSL : 465 # POP3\r\n```\r\n\r\n### æµ‹è¯•è¿‡ç¨‹ï¼ˆæ²¡æœ‰ç”³è¯·SSLå’ŒåŸŸåå¤‡æ¡ˆçš„æƒ…å†µä¸‹ï¼‰\r\n#### smtpæµ‹è¯•\r\nhttps://www.cnblogs.com/taoshihan/p/6732039.html\r\n```\r\n[root@hampster config]# telnet localhost 30\r\n...\r\n220 mail.hampster.work ESMTP\r\nHELO mail.hampster.work\r\n250 mail.hampster.work\r\nauth login\r\n334 VXNlcm5hbWU6\r\nXXXXXXXXXXXXXXXXXXXXXX # è´¦å·çš„base64ç¼–ç \r\n334 UGFzc3dvcmQ6\r\nXXXXXXXXXXXXXXXXXXXXXX # å¯†ç çš„base64ç¼–ç \r\n235 2.7.0 Authentication successful\r\nmail from:<hampster@hampster.work>\r\n250 2.1.0 Ok\r\nrcpt to:<ajh415@hotmail.com>\r\n250 2.1.5 Ok\r\ndata\r\n354 End data with <CR><LF>.<CR><LF>\r\nFrom:<hampster@hampster.work>\r\nTo:<ajh415@hotmail.com>\r\nSubject:ning\r\n\r\nawefawefawef,juisdfo,wfaweyfihgh.awefjaweijf?jwefoiuvbhhsr!!!!\r\nawefjiowefowaif------!!!!!\r\n.\r\n250 2.0.0 Ok: queued as D790522CA3\r\n```\r\n> å¦‚æœéªŒè¯æ—¶æ²¡æœ‰å‘é€å‡ºå»ï¼Œå¯ä»¥ä½¿ç”¨é‚®ä»¶å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚163é‚®ç®±å¤§å¸ˆï¼‰ç™»å½•å†å‘é€ï¼Œå°±å¯ä»¥æˆåŠŸ\r\n\r\n#### imapæµ‹è¯•\r\n```\r\n[root@hampster ~]# telnet mail.hampster.work 143\r\nTrying 47.94.167.22...\r\nConnected to mail.hampster.work.\r\nEscape character is \'^]\'.\r\n* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ AUTH=PLAIN AUTH=LO\r\na login hampster@hampster.work PASSWORD\r\na OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED ICH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE SNIPPET=FUZZY PREVIEW=FUZZY AL+ NOTIFY SPECIAL-USE QUOTA] Logged in\r\na LIST \"\" \"*\"\r\n* LIST (\\HasNoChildren \\Trash) \".\" Trash\r\n* LIST (\\HasNoChildren \\Sent) \".\" Sent\r\n* LIST (\\HasNoChildren \\Junk) \".\" Junk\r\n* LIST (\\HasNoChildren \\Drafts) \".\" Drafts\r\n* LIST (\\HasNoChildren) \".\" INBOX\r\na OK List completed (0.002 + 0.000 + 0.001 secs).\r\na EXAMINE INBOX\r\n* FLAGS (\\Answered \\Flagged \\Deleted \\Seen \\Draft)\r\n* OK [PERMANENTFLAGS ()] Read-only mailbox.\r\n* 0 EXISTS\r\n* 0 RECENT\r\n* OK [UIDVALIDITY 1709077637] UIDs valid\r\n* OK [UIDNEXT 1] Predicted next UID\r\na OK [READ-ONLY] Examine completed (0.001 + 0.000 secs).\r\n```\r\n', '2025-01-11 11:50:27'),(16, 3, 'Service Discovery', '\r\n## Service Discovery\r\n### Consul\r\n##### yamlé…ç½®\r\n```\r\n  consul:\r\n    container_name: consul\r\n    image: hashicorp/consul\r\n    restart: always\r\n    ports:\r\n      - \"31008:8500\"\r\n      - \"31006:8600\"\r\n    volumes:\r\n      - \"./consul/data:/data:rw\"\r\n      - \"./consul/conf:/etc/consul/conf\"\r\n      - \"./consul/values:/etc/consul/values\"\r\n    command: consul agent -server -ui -node server-1 -client \"0.0.0.0\" -data-dir \"/data\" -bind \"127.0.0.1\" -bootstrap-expect 1 -config-file \"/etc/consul/conf/config.json\"\r\n```\r\nhttps://blog.csdn.net/LaoRenYuHai_/article/details/140097560\r\n### Nacos\r\n#### nacosé…ç½®ä¸­å¿ƒ\r\n##### yamlé…ç½®\r\n> official-example: https://github.com/nacos-group/nacos-docker/blob/master/example/standalone-derby.yaml <br/>\r\n> official-description: https://nacos.io/docs/latest/quickstart/quick-start-docker/?spm=5238cd80.c984973.0.0.6be14023CJebBn#nacos--grafana--prometheus\r\n```\r\nnacos:\r\n  image: nacos/nacos-server:latest\r\n  container_name: nacos-standalone\r\n  restart: always\r\n  environment:\r\n    - PREFER_HOST_MODE=HOST\r\n    - MODE=standalone\r\n    - NACOS_AUTH_IDENTITY_KEY=IDENTITY_KEY\r\n    - NACOS_AUTH_IDENTITY_VALUE=IDENTITY_VALUE\r\n    - NACOS_AUTH_TOKEN=TOKEN\r\n#	 - NACOS_AUTH_ENABLE=true\r\n  volumes:\r\n    - ./standalone-logs/:/home/nacos/logs\r\n  ports:\r\n    - \"8848:8848\"\r\n    - \"9848:9848\"\r\nprometheus:\r\n  container_name: prometheus\r\n  image: prom/prometheus:latest\r\n  volumes:\r\n    - ./prometheus/prometheus-standalone.yaml:/etc/prometheus/prometheus.yml\r\n  ports:\r\n    - \"9090:9090\"\r\n  depends_on:\r\n    - nacos\r\n  restart: always\r\ngrafana:\r\n  container_name: grafana\r\n  image: grafana/grafana:latest\r\n  ports:\r\n    - 3000:3000\r\n  restart: always\r\n```\r\n- visit-linkï¼š[http://127.0.0.1:8848/nacos/](http://127.0.0.1:8848/nacos/)\r\n\r\n##### postè¯·æ±‚æ·»åŠ é…ç½®\r\n```\r\nhttp://HOST:8848/nacos/v1/cs/configs?dataId=name-prod.yaml&group=DEFAULT_GROUP&content=useLocalCache: true&type=yaml\r\n```\r\n> æ·»åŠ åå¯ä»¥åœ¨visit-linké‡Œé¢çš„Configuration-Management -> Configurationsä¸­çœ‹åˆ°\r\n\r\n##### bootstrapé…ç½®\r\n```\r\nserver:  \r\n  port: PORT\r\nspring:  \r\n  application:  \r\n    name: name\r\n  cloud:  \r\n      nacos:  \r\n          config:  \r\n            server-addr: host:8848  \r\n            file-extension: yaml  \r\n            group: DEFAULT_GROUP  \r\n#            shared-configs:  \r\n#              - ${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}\r\n  profiles:  \r\n    active: prod  \r\n  config:  \r\n    import: nacos:${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}\r\n```\r\n##### SpringCloudæµ‹è¯•æ¥å£\r\n```\r\nimport org.springframework.beans.factory.annotation.Value;  \r\nimport org.springframework.cloud.context.config.annotation.RefreshScope;  \r\nimport org.springframework.web.bind.annotation.RequestMapping;  \r\nimport org.springframework.web.bind.annotation.RestController;  \r\n  \r\n@RestController  \r\n@RequestMapping(\"/config\")  \r\n@RefreshScope  \r\npublic class ConfigController {  \r\n  \r\n    @Value(\"${useLocalCache:false}\")  \r\n//    @NacosConfig(dataId = \"blog-prod.yaml\", group = \"DEFAULT_GROUP\", key = \"config.useLocalCache\", defaultValue = \"false\")  \r\n  private boolean useLocalCache;  \r\n  \r\n    @RequestMapping(\"/useLocalCache\")  \r\n    public boolean getUseLocalCache() {  \r\n        return useLocalCache;  \r\n    }  \r\n}\r\n```\r\n#### æ·»åŠ é‰´æƒ\r\n> æ”¾å…¥å†…ç½‘åå†æ·»åŠ é‰´æƒä¼šè®©è®¿é—®æ›´å®‰å…¨\r\n```\r\n# å–æ¶ˆæ³¨é‡Šyamlæ–‡ä»¶envé‡Œé¢çš„\r\n#	 - NACOS_AUTH_ENABLE=true\r\n```\r\n> æ­¤å¤–è¿˜å¯ä»¥å¯¹è®¿é—®ipè¿›è¡Œé™åˆ¶\r\n```\r\n# å¦‚æœç»è¿‡NATè½¬å‘æ·»åŠ åˆ°FORWARD,æ²¡æœ‰ç›´æ¥æ·»åŠ åˆ°INPUT\r\niptables -I FORWARD -p tcp --dport 8848 -j DROP        \r\niptables -I FORWARD -p tcp --dport 8848 -s IPALLOW -j ACCEPT\r\n```\r\n> å¦‚æœipä¼šå˜åŒ–åˆ™ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„è„šæœ¬\r\n```\r\n#!/bin/bash\r\n\r\n# ç¯å¢ƒå˜é‡\r\nexport PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\r\n\r\n# é…ç½®åŸŸå\r\nDOMAIN=\"example.com\"\r\n\r\n# è§£æåŸŸååˆ° IP\r\nRESOLVED_IP=$(dig +short $DOMAIN | head -n 1)\r\n\r\nif [ -z \"$RESOLVED_IP\" ]; then\r\n    echo \"Failed to resolve domain: $DOMAIN\"\r\n    exit 1\r\nfi\r\n\r\n# æ¸…é™¤æ—§è§„åˆ™ï¼ˆå¦‚æœå·²å­˜åœ¨ï¼‰\r\niptables -D FORWARD $(iptables -L FORWARD --line-numbers | awk \'$2 == \"ACCEPT\" && $5 ~ /.*compute.amazonaws.com/ && $7 == \"tcp\" && $8 == \"dpt:8848\" {print $1}\')\r\n\r\n# æ·»åŠ æ–°è§„åˆ™\r\niptables -I FORWARD -p tcp --dport 8848 -s $RESOLVED_IP -j ACCEPT\r\n\r\necho \"Updated iptables rule: Allowed $DOMAIN ($RESOLVED_IP) on port 8848\"\r\n```\r\n\r\n##### é‰´æƒåçš„ç½‘ç»œè¯·æ±‚è®¿é—®æ ¼å¼\r\n> https://nacos.io/docs/next/manual/user/auth/?spm=5238cd80.23f13fa2.0.0.30a87e148NOIJQ\r\n```\r\n# é¦–å…ˆéœ€è¦ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»é™†nacosã€‚(ç›´æ¥å¤åˆ¶åˆ°POSTMANå¯çŸ¥-dæ¥è‡ªwww-formæ•°æ®)\r\n# æ³¨ï¼šwww-formç”¨äºæ™®é€šè¡¨å•æ•°æ®,data-formç”¨äºå›¾ç‰‡è§†é¢‘ï¼ˆä¸€èˆ¬è¡¨ç°ä¸ºmultipart/form-dataï¼‰\r\ncurl -X POST \'127.0.0.1:8848/nacos/v1/auth/login\' -d \'username=nacos&password=nacos\'\r\n# è‹¥ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®,è¿”å›ä¿¡æ¯access-token,è¿”å›åæ·»åŠ åˆ°ä¹‹å‰çš„è¯·æ±‚åé¢:\r\nhttp://HOST:8848/nacos/v1/cs/configs?dataId=name-prod.yaml&group=DEFAULT_GROUP&content=useLocalCache: true&type=yaml&access-token=xxxxxxxxxxxxxxxxxx\r\n```\r\n\r\n#### æœåŠ¡å‘ç°ä¸ç®¡ç†\r\n> to be continued', '2025-01-21 14:31:06');
UNLOCK TABLES;
COMMIT;
BEGIN;
LOCK TABLES `hampster`.`blog_type` WRITE;
DELETE FROM `hampster`.`blog_type`;
INSERT INTO `hampster`.`blog_type` (`bt_id`,`bt_name`) VALUES (1, 'JAVA'),(2, 'PYTHON'),(3, 'CONTAINER');
UNLOCK TABLES;
COMMIT;
BEGIN;
LOCK TABLES `hampster`.`user` WRITE;
DELETE FROM `hampster`.`user`;
INSERT INTO `hampster`.`user` (`u_id`,`u_name`,`u_pass`,`u_mail`,`u_phone`,`u_token`) VALUES (1, 'AbHamster', '$2a$10$eO6TGS6WzWd/MjJygL2VZ.ua52Bbj/sRNyFq.ccGJgyGePu7dDjVK', 'ajh415@hotmail.com', NULL, 'geMZyxvnN8cuthUm'),(2, 'Registered Hamster', '$2a$10$azvhCPgEelnOQgWIco92uOAx3vCaXkFOuv4WP4bu/6CFV1P8ZGxom', 'test', NULL, 'i6TL41yRB0JnwQPM'),(4, 'Registered Hamster', '$2a$10$OedsxBTd4EvruV0vt9ru6e/lwhuVtz/LvwnzBJnzX2iwRZKTF5YXi', '0', NULL, 'kCL4Gu6JRIMXZ0b4'),(5, 'Registered Hamster', '$2a$10$sLMkSabtAW6AK1vjL47Ky.KzgXtNp/O8Dvq.GXHym.TpOZQyUALd6', '1', NULL, '1kXXy9ab3MFBgr9s'),(6, 'Registered Hamster', '$2a$10$FU1RDepo6pBoqeFwcITmYuzNuCby7AZa5YJHq71uJ8gQc0RCsmILO', '2', NULL, 'ECREBptNEPpAesDs'),(7, 'Registered Hamster', '$2a$10$JdWKLkZ3X8bqxgdbtYbSb..pov6/XrPwvmNhqBQq35Kdjo.CHo5s2', '3', NULL, 'jhfUdoHGFw0W2eb4'),(8, 'Registered Hamster', '$2a$10$gOIKoUXFFIAl6MbD3F96RumAMtAKOmplInVIqZOZRZxgWfHdfGU/K', '45', NULL, 'hkajLX7qHZc07XJH'),(9, 'Registered Hamster', '$2a$10$9RBca/Vk5E5nIexzeEBDCuv5dW.PrtkkHpg27vySjWsV2hcVrIdjW', '65', NULL, 'AIkV92uCVqf72dUK'),(10, 'Registered Hamster', '$2a$10$21ps/1//Ai1v0ggMCajl1uRQ/wPXM737eCKyGohdNx6HHFzzPRaFu', '78', NULL, 'hVMwhI6BUAOmJnHt'),(11, 'Registered Hamster', '$2a$10$rtJLZ0euteiEB8bMh/3ZO.fkkfkZPpzn3hnIuvRPrk78oON18tu5.', '99', NULL, 'TIyDX2KCA3XlNhpy'),(12, 'Registered Hamster', '$2a$10$DrA/OKjcJEGJt8bAbpZXDOm0WK7.0q5KizReZBUupx00aGmpAhqlm', '0980', NULL, 'osrBn4jswK72S58n'),(13, 'Registered Hamster', '$2a$10$Ms5fLkc/4wqI.CpYT8uAZO07K4jASZvk1HiNbdmkzzmBCPIY9h7BO', '1000', NULL, 'Wknrje1EqDy8WgSv'),(14, 'uoiuy', '$2a$10$wyXWnkjCnYzx5HD.4Bp2I.8bEuztRbLIeiJUxCf9Geg1N3oUDoDVm', '1001', NULL, 'mM9yDQP8cFxsoJXQ'),(15, 'poipo', '$2a$10$.2pRvpGT367HMojxVlyoI.CDHgBniE9hww8Re9TLKGmPyAVJJ00bq', 'a1270898097@163.com', NULL, 'RTbhjHl2JjXsmMT7');
UNLOCK TABLES;
COMMIT;
